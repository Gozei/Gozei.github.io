<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Sql从0到1 | Gozei's Blog</title><meta name="author" content="Gozei"><meta name="copyright" content="Gozei"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="MySQL数据库简介 什么是数据库  数据库(DataBase)就是存储和管理数据的仓库。 数据按照一定的格式进行存储，用户可以对数据库中的数据进行增加、修改、删除、查询等操作。 (CURD) → CREATE、UPDATE、READ、DELETE  数据库有哪些分类？  根据数据库存储数据形式的不同，数据库可以分为两类：  关系型数据库(SQL数据库) → RDBMS  数据库、数据表 数据存储">
<meta property="og:type" content="article">
<meta property="og:title" content="Sql从0到1">
<meta property="og:url" content="https://gozei-blog.vercel.app/year/04/02/Sql%E4%BB%8E0%E5%88%B01/index.html">
<meta property="og:site_name" content="Gozei&#39;s Blog">
<meta property="og:description" content="MySQL数据库简介 什么是数据库  数据库(DataBase)就是存储和管理数据的仓库。 数据按照一定的格式进行存储，用户可以对数据库中的数据进行增加、修改、删除、查询等操作。 (CURD) → CREATE、UPDATE、READ、DELETE  数据库有哪些分类？  根据数据库存储数据形式的不同，数据库可以分为两类：  关系型数据库(SQL数据库) → RDBMS  数据库、数据表 数据存储">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/toki.jpg">
<meta property="article:published_time" content="2024-04-02T05:23:12.000Z">
<meta property="article:modified_time" content="2024-04-02T14:04:26.964Z">
<meta property="article:author" content="Gozei">
<meta property="article:tag" content="数据库">
<meta property="article:tag" content="mysql">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/toki.jpg"><link rel="shortcut icon" href="/img/fa.png"><link rel="canonical" href="https://gozei-blog.vercel.app/year/04/02/Sql%E4%BB%8E0%E5%88%B01/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Sql从0到1',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-04-02 22:04:26'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/assert/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/toki.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Gozei's Blog"><span class="site-name">Gozei's Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Sql从0到1</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-04-02T05:23:12.000Z" title="发表于 2024-04-02 13:23:12">2024-04-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-04-02T14:04:26.964Z" title="更新于 2024-04-02 22:04:26">2024-04-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%99%E7%A8%8B/">教程</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%99%E7%A8%8B/%E4%BB%8E0%E5%88%B01/">从0到1</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">11.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>43分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Sql从0到1"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="MySQL数据库简介"><a href="#MySQL数据库简介" class="headerlink" title="MySQL数据库简介"></a>MySQL数据库简介</h1><ol>
<li><strong>什么是数据库</strong></li>
</ol>
<p>数据库(DataBase)就是<strong>存储和管理数据的仓库</strong>。</p>
<p>数据按照一定的格式进行存储，用户可以对数据库中的数据进行增加、修改、删除、查询等操作。</p>
<p>(CURD) → CREATE、UPDATE、READ、DELETE</p>
<ol start="2">
<li><strong>数据库有哪些分类？</strong></li>
</ol>
<p>根据数据库存储数据形式的不同，数据库可以分为两类：</p>
<ul>
<li><p>关系型数据库(SQL数据库) → RDBMS</p>
<ul>
<li>数据库、数据表</li>
<li>数据存储形式：数据以行列表格的形式进行存储</li>
<li>常见产品：MySQL、Oracle、DB2、SQL Server等</li>
</ul>
</li>
<li><p>非关系型数据库(NoSQL数据库)</p>
<ul>
<li>数据存储形式：键值对存储、文档存储、列式存储、图式存储</li>
<li>常见产品：MongoDB、Redis、Hbase、Neo4j</li>
</ul>
</li>
</ul>
<ol start="3">
<li><strong>MySQL数据库</strong></li>
</ol>
<p>安装教程：<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/2093568">MySQL安装配置教程（超级详细、保姆级）-腾讯云开发者社区-腾讯云 (tencent.com)</a> 。by：<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/user/8223537">全栈程序员站长</a>（不是博主，我懒得写）</p>
<p>MySQL 是目前最流行的关系型数据库管理系统（RDBMS）之一。</p>
<p>它最早由瑞典MySQL AB公司开发，后被SUN公司收购，目前属于 Oracle 甲骨文公司旗下产品。Oracle</p>
<img src="C:\Users\Gozei\AppData\Roaming\Typora\typora-user-images\image-20240325084737916.png" alt="image-20240325084737916" style="zoom:67%;" />

<p>MySQL 数据库是 C/S 软件：客户端和服务器。</p>
<img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240325084841990.png" alt="image-20240325084841990" style="zoom:67%;" />

<p><strong>特点：</strong></p>
<ol>
<li>免费开源，不需要支付额外的费用（MySQL5以上企业版开始收费，提供技术支持）。</li>
<li>支持大型的数据库，可以处理拥有上千万条数据。</li>
<li>使用标准的SQL数据语言形式（增、删、改、查）。</li>
<li>支持不同的操作系统，并提供多种编程语言的操作接口。包括C、C++、Python、Java等等。</li>
<li>支持多种存储引擎。</li>
</ol>
<h1 id="MySQL客户端连接服务端"><a href="#MySQL客户端连接服务端" class="headerlink" title="MySQL客户端连接服务端"></a>MySQL客户端连接服务端</h1><p>通过 MySQL 客户端连接到 MySQL 服务器，即可以对 MySQL 服务器上存储的数据进行操作。</p>
<ol>
<li>命令行连接</li>
</ol>
<p>命令格式：mysql -h数据库服务端IP -P数据库服务端端口 -u用户名 -p密码</p>
<img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240325101143754.png" alt="image-20240325101143754" style="zoom:67%;" />

<ol start="2">
<li>可视化界面客户端连接（DataGrip）</li>
</ol>
<img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240325101018320.png" alt="image-20240325101018320" style="zoom: 33%;" />

<p>DataGrip是JetBrains公司推出的管理数据库的产品（数据库客户端软件），功能非常强大，可以兼容各种数据库，另外，JetBrains公司还有一款知名的IDE开发工具IDEA，用户体验非常不错。</p>
<p>它的设计符合数据库管理员、开发人员需要。</p>
<p><strong>新建一个数据库连接</strong></p>
<img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240325104838996.png" alt="image-20240325104838996" style="zoom:50%;" />

<img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240325105517223.png" alt="image-20240325105517223" style="zoom: 50%;" />

<p>最后测试连接，成功后应用。</p>
<h1 id="SQL语句"><a href="#SQL语句" class="headerlink" title="SQL语句"></a>SQL语句</h1><h2 id="什么是sql语句"><a href="#什么是sql语句" class="headerlink" title="什么是sql语句"></a>什么是sql语句</h2><p>SQL全称是结构化查询语言(Structured Query Language)，是<strong>关系型数据库管理系统都需要遵循的规范</strong>，是操作关系型数据库的语言，只要是关系型数据库，都支持SQL。</p>
<p>虽然所有的关系型数据库都支持SQL，但是不同的关系型数据库都会有一些特殊的东西(特有的函数或语法)。</p>
<img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240325105857759.png" alt="image-20240325105857759" style="zoom:67%;" />

<h2 id="SQL语句的分类"><a href="#SQL语句的分类" class="headerlink" title="SQL语句的分类"></a>SQL语句的分类</h2><ul>
<li>DDL(Data Definition Language)：数据定义语言，用来定义数据库对象：数据库，表，列等。</li>
<li>DML (Data Manipulation Language)：数据操作语言，用来对数据库中表的记录进行增、删、改。</li>
<li>**DQL (Data Query Language)**：数据查询语言，用来查询数据库中表的记录。</li>
<li>DCL (Data Control Language)：数据控制语言，用来定义数据库的访问权限和安全级别，及创建用户。</li>
</ul>
<h3 id="DDL数据定义语言-数据库操作"><a href="#DDL数据定义语言-数据库操作" class="headerlink" title="DDL数据定义语言-数据库操作"></a>DDL数据定义语言-数据库操作</h3><ol>
<li>创建数据库</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 创建数据库</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE 数据库名称;</span><br><span class="line"></span><br><span class="line"># 当数据库不存在时，创建数据库</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> 数据库名称;</span><br><span class="line"></span><br><span class="line"># 创建数据库并指定utf8编码</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE 数据库名称 CHARSET<span class="operator">=</span><span class="string">&#x27;utf8&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>查看数据库</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 显示已有的数据库</span><br><span class="line"><span class="keyword">SHOW</span> DATABASES;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>使用数据库</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 显示已有的数据库</span><br><span class="line"><span class="keyword">SHOW</span> DATABASES;</span><br><span class="line"></span><br><span class="line"># 使用指定数据库</span><br><span class="line">USE 数据库名称;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>删除数据库</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 删除指定数据库</span><br><span class="line"># 注意：实际工作不要删除数据库！！！</span><br><span class="line"># 注意：实际工作不要删除数据库！！！</span><br><span class="line"># 注意：实际工作不要删除数据库！！！</span><br><span class="line"><span class="keyword">DROP</span> DATABASE 数据库名;</span><br></pre></td></tr></table></figure>

<h3 id="DDL数据定义语言-数据表操作"><a href="#DDL数据定义语言-数据表操作" class="headerlink" title="DDL数据定义语言-数据表操作"></a>DDL数据定义语言-数据表操作</h3><ol>
<li>创建数据表</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表名(</span><br><span class="line">    字段名<span class="number">1</span> 数据类型(长度) 约束,</span><br><span class="line">    字段名<span class="number">2</span> 数据类型(长度) 约束,</span><br><span class="line">    字段名<span class="number">3</span> 数据类型(长度) 约束</span><br><span class="line">    ...</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 创建表举例</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> category(</span><br><span class="line">    # 字段<span class="number">1</span>名称为cid，数据类型为整型，添加主键约束及非空约束</span><br><span class="line">    cid <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    # 字段<span class="number">2</span>名称为cname，数据类型为<span class="type">varchar</span>，最大长度为<span class="number">100</span></span><br><span class="line">    cname <span class="type">VARCHAR</span>(<span class="number">100</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>字段名：数据表中每一列的名称（列头）</p>
</li>
<li><p>数据类型：数据的存储形式（结构）</p>
</li>
<li><p>约束：数据存储遵循的规则</p>
</li>
</ul>
<ol start="2">
<li>查看数据表和表结构</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 查看当前数据库中已有的数据表</span><br><span class="line"><span class="keyword">SHOW</span> TABLES;</span><br><span class="line"></span><br><span class="line"># 查看指定数据表的结构</span><br><span class="line"><span class="keyword">DESC</span> 表名;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>修改表名</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 修改指定表的名称</span><br><span class="line">RENAME <span class="keyword">TABLE</span> 表名 <span class="keyword">TO</span> 新表名;删除数据表</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>删除数据表</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 修改指定表的名称</span><br><span class="line">RENAME <span class="keyword">TABLE</span> 表名 <span class="keyword">TO</span> 新表名;</span><br><span class="line"></span><br><span class="line"># 删除指定的数据表</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> 表名;</span><br></pre></td></tr></table></figure>

<h3 id="DDL数据定义语言-数据类型和约束"><a href="#DDL数据定义语言-数据类型和约束" class="headerlink" title="DDL数据定义语言-数据类型和约束"></a>DDL数据定义语言-数据类型和约束</h3><p>可以在创建表的时候，为表添加一些强制性的验证，比如：<strong>数据类型和约束</strong>。</p>
<p><strong>数据类型</strong>是指在创建表的时候为表中字段指定数据类型，只有数据符合类型要求才能存储起来，使用数据类型的原则是：够用就行，尽量使用取值范围小的，而不用大的，这样可以更多的节省存储空间。</p>
<p>常用数据类型如下：</p>
<ul>
<li><p>整数：int，bit(存0或1)</p>
</li>
<li><p>小数：decimal，double</p>
</li>
<li><p>字符串：varchar，char，text</p>
</li>
<li><p>日期时间：date， time， datetime</p>
</li>
<li><p>枚举类型(enum)：比如表中有一列存性别：男、女</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> person (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">  name <span class="type">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  gender ENUM(<span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>数据类型说明：</p>
<ul>
<li>decimal表示浮点数，如 decimal(5，2) 表示共存5位数，小数占 2 位。</li>
<li>char表示固定长度的字符串，如char(3)，如果填充’ab’时会补一个空格为’ab ‘，3表示字符数</li>
<li>varchar表示可变长度的字符串，如varchar(3)，填充’ab’时就会存储’ab’，3表示字符数</li>
<li><strong>对于图片、音频、视频等文件，不存储在数据库中，而是上传到某个服务器上，然后在表中存储这个文件的保存路径。</strong></li>
<li>字符串 text 表示存储大文本，当字符大于 4000 时推荐使用， 比如技术博客。</li>
</ul>
<p><strong>数据约束</strong>是指数据在数据类型限定的基础上额外增加的要求。</p>
<p>常见的约束如下：</p>
<ul>
<li><strong>主键 primary key</strong>：物理上存储的顺序。 MySQL 建议所有表的主键字段都叫 id， 类型为 int unsigned。</li>
<li><strong>非空 not null</strong>：此字段不允许填写空值。NULL表示空</li>
<li><strong>惟一 unique</strong>：此字段的值不允许重复。</li>
<li><strong>默认 default</strong>：当不填写字段对应的值会使用默认值，如果填写时以填写为准。</li>
<li><strong>外键 foreign key</strong>：对关系字段进行约束， 当为关系字段填写值时， 会到关联的表中查询此值是否存在， 如果存在则填写成功， 如果不存在则填写失败并抛出异常。</li>
</ul>
<h3 id="DDL数据定义语言-数据约束进阶"><a href="#DDL数据定义语言-数据约束进阶" class="headerlink" title="DDL数据定义语言-数据约束进阶"></a>DDL数据定义语言-数据约束进阶</h3><p><strong>主键约束</strong>：</p>
<p>什么是主键？</p>
<ul>
<li>PRIMARY KEY 约束唯一标识数据库表中的每条记录。</li>
<li>主键必须包含唯一的值。</li>
<li>主键列不能包含 NULL 值。</li>
<li>每个表都应该有一个主键，并且每个表只能有一个主键。</li>
</ul>
<p>主键约束操作：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"># 添加主键</span><br><span class="line"># 在创建数据表时添加</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> person(</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    last_name <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    first_name <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    address <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    city <span class="type">VARCHAR</span>(<span class="number">100</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> person(</span><br><span class="line">    id <span class="type">INT</span>,</span><br><span class="line">    last_name <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    first_name <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    address <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    city <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">  	<span class="comment">-- 将 id 设置为表的主键</span></span><br><span class="line">   	<span class="keyword">PRIMARY</span> KEY(id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 在创建后添加约束(了解)</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> person1(</span><br><span class="line">    id <span class="type">INT</span>,</span><br><span class="line">    last_name <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    first_name <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    address <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    city <span class="type">VARCHAR</span>(<span class="number">100</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 创建表后，使用<span class="keyword">ALTER</span> <span class="keyword">TABLE</span>关键字添加主键</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> person1 <span class="keyword">ADD</span> <span class="keyword">PRIMARY</span> KEY (id);</span><br><span class="line"></span><br><span class="line"># 删除主键约束</span><br><span class="line"># 格式：<span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">DROP</span> <span class="keyword">PRIMARY</span> KEY;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> person1 <span class="keyword">DROP</span> <span class="keyword">PRIMARY</span> KEY;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 在创建表时添加主键自动增长</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> person2(</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">    last_name <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">    first_name <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">    address <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">    city <span class="type">VARCHAR</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 在创建表之后添加自动增长(了解)</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> person2 CHANGE id id <span class="type">INT</span> AUTO_INCREMENT;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：</p>
<p>1）主键的值必须是唯一的。</p>
<p>2）在没设置主键自增之前，insert数据时，主键不能为NULL；在设置主键自增之后，insert数据时，主键位置可以为NULL，数据库会自动维护主键的值。</p>
</blockquote>
<p><strong>非空约束</strong>：</p>
<p>NOT NULL，非空约束，即对应列不接受空NULL值。</p>
<p>非空约束操作：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 非空约束 <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line"># 创建表时添加非空约束</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> person3(</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    last_name <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    first_name <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    address <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    city <span class="type">VARCHAR</span>(<span class="number">100</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>唯一约束</strong>：</p>
<p>UNIQUE，唯一约束，即对应列的值必须唯一。</p>
<p>唯一约束操作：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 唯一约束</span><br><span class="line"># 在创建表时添加唯一约束</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> person4 (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    last_name <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">UNIQUE</span>,</span><br><span class="line">    first_name <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    address <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    city <span class="type">VARCHAR</span>(<span class="number">100</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>默认值</strong>：</p>
<p>DEFAULT，默认值，插入数据时当不填写字段对应的值会使用默认值，如果填写时以填写为准。</p>
<p>默认值操作：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 默认值</span><br><span class="line"># 在创建表时添加默认值</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> person5 (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    last_name <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    first_name <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    address <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    city <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;北京&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="DDL数据定义语言-数据表字段操作"><a href="#DDL数据定义语言-数据表字段操作" class="headerlink" title="DDL数据定义语言-数据表字段操作"></a>DDL数据定义语言-数据表字段操作</h3><p>在实际开发中，我们创建的数据库一般只满足第一版需求，随着日后的需求不断增加，数据维度不断扩展，还有更多的需求需要添加进来，此时，数据存储的结构就需要随之变化。</p>
<ol>
<li>添加表字段</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 注意：</span><br><span class="line"># <span class="number">1.</span> 约束按需求选择添加，可以没有约束，类型必须填写，并只能填写一个类型</span><br><span class="line"># <span class="number">2.</span> 表字段名称不能重复，否则会出现 Duplicate <span class="keyword">column</span> 错误</span><br><span class="line"># <span class="number">3.</span> 如果列名和关键字相同，需要在列名两边加 ``</span><br><span class="line"><span class="keyword">ALTER</span>  <span class="keyword">TABLE</span>  表名  <span class="keyword">ADD</span>  列名  类型(长度)  [约束];</span><br><span class="line"></span><br><span class="line"># 示例<span class="number">1</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> category <span class="keyword">ADD</span> num <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br><span class="line"># 示例<span class="number">2</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> category <span class="keyword">ADD</span> `<span class="keyword">desc</span>` <span class="type">VARCHAR</span>(<span class="number">100</span>);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>修改表字段</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 CHANGE 旧列名 新列名 类型(长度) 约束;</span><br><span class="line"></span><br><span class="line"># 示例<span class="number">1</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> category CHANGE `<span class="keyword">desc</span>` description <span class="type">VARCHAR</span>(<span class="number">100</span>);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>删除表字段</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">DROP</span> 列名;</span><br><span class="line"></span><br><span class="line"># 示例<span class="number">1</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> category <span class="keyword">DROP</span> num;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>删除和添加主键</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> user_info <span class="keyword">DROP</span> <span class="keyword">PRIMARY</span> KEY;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> user_info <span class="keyword">ADD</span> <span class="keyword">PRIMARY</span> KEY (id,username);</span><br></pre></td></tr></table></figure>

<h3 id="DML数据操作语言-表记录增、改、删"><a href="#DML数据操作语言-表记录增、改、删" class="headerlink" title="DML数据操作语言-表记录增、改、删"></a>DML数据操作语言-表记录增、改、删</h3><p><strong>增加表记录</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 不指定字段插入：一次性插入一行，并且指定所有列</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表 <span class="keyword">VALUES</span>(值<span class="number">1</span>, 值<span class="number">2</span>, 值<span class="number">3.</span>..);</span><br><span class="line"></span><br><span class="line"># 指定字段插入：一次性插入一行，并且指定插入列</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表 (字段<span class="number">1</span>, 字段<span class="number">2</span>, 字段<span class="number">3.</span>..) <span class="keyword">VALUES</span>(值<span class="number">1</span>, 值<span class="number">2</span>, 值<span class="number">3.</span>..);</span><br><span class="line"></span><br><span class="line"># 不指定字段插入：一次性添加多条记录</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表 <span class="keyword">VALUES</span>(值<span class="number">1</span>, 值<span class="number">2</span>, 值<span class="number">3.</span>..), (值<span class="number">1</span>, 值<span class="number">2</span>, 值<span class="number">3.</span>..), ...;</span><br><span class="line"></span><br><span class="line"># 指定字段插入：一次性添加多条记录</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表 (字段<span class="number">1</span>, 字段<span class="number">2</span>, 字段<span class="number">3.</span>..) <span class="keyword">VALUES</span>(值<span class="number">1</span>, 值<span class="number">2</span>, 值<span class="number">3.</span>..), (值<span class="number">1</span>, 值<span class="number">2</span>, 值<span class="number">3.</span>..)...;</span><br></pre></td></tr></table></figure>

<p><strong>更新表记录</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 更新所有行</span><br><span class="line"><span class="keyword">UPDATE</span> 表名 <span class="keyword">SET</span> 字段名<span class="operator">=</span>值, 字段名<span class="operator">=</span>值, ...;</span><br><span class="line"></span><br><span class="line"># 更新满足条件的行</span><br><span class="line"><span class="keyword">UPDATE</span> 表名 <span class="keyword">SET</span> 字段名<span class="operator">=</span>值, 字段名<span class="operator">=</span>值, ... <span class="keyword">WHERE</span> 条件;</span><br></pre></td></tr></table></figure>

<p><strong>删除表记录：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 删除表中的所有数据：主键自增序列不清零</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> 表名;</span><br><span class="line"></span><br><span class="line"># 清空表数据：主键自增序列清零</span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> 表名;# <span class="keyword">truncate</span></span><br><span class="line"></span><br><span class="line"># 删除表中满足条件的数据</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> 表名 <span class="keyword">WHERE</span> 条件</span><br></pre></td></tr></table></figure>

<p><strong>补充</strong>：</p>
<p><strong>物理删除</strong>：DELETE FROM 就是物理删除，真的将表数据删除。</p>
<p><strong>逻辑删除</strong>：数据并没有真的从表中删除，而是将数据添加了一个删除标记。</p>
<img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/%E7%89%A9%E7%90%86%E5%88%A0%E9%99%A4vs%E9%80%BB%E8%BE%91%E5%88%A0%E9%99%A4.png" alt="物理删除vs逻辑删除" style="zoom:80%;" />

<h3 id="DQL数据查询语言-简单查询"><a href="#DQL数据查询语言-简单查询" class="headerlink" title="DQL数据查询语言-简单查询"></a>DQL数据查询语言-简单查询</h3><p><strong>SQL条件查询</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> 表名 <span class="keyword">WHERE</span> 条件;</span><br></pre></td></tr></table></figure>

<p>WHERE支持的条件运算符：</p>
<p>1）比较运算符 </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">=</span>：判断是否相等</span><br><span class="line"><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&gt;=</span></span><br><span class="line"><span class="operator">&lt;</span></span><br><span class="line"><span class="operator">&lt;=</span></span><br><span class="line"><span class="operator">!=</span>：不等于</span><br><span class="line"><span class="operator">&lt;&gt;</span>：不等于</span><br><span class="line"></span><br><span class="line"># 示例</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> product <span class="keyword">WHERE</span> price <span class="operator">=</span> <span class="number">800</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> product <span class="keyword">WHERE</span> price <span class="operator">&gt;</span> <span class="number">600</span>;</span><br></pre></td></tr></table></figure>

<p>2）逻辑运算符</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">AND</span>：与</span><br><span class="line"><span class="keyword">OR</span>：或</span><br><span class="line"><span class="keyword">NOT</span>：非</span><br><span class="line"></span><br><span class="line"># 示例</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> product <span class="keyword">WHERE</span> price <span class="operator">&gt;=</span> <span class="number">200</span> <span class="keyword">AND</span> price <span class="operator">&lt;=</span> <span class="number">2000</span>;</span><br></pre></td></tr></table></figure>

<p>3）LIKE模糊查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">%</span>：表示任意多个任意字符</span><br><span class="line">_：表示任意一个字符</span><br><span class="line"></span><br><span class="line"># 示例</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> product <span class="keyword">WHERE</span> pname <span class="keyword">LIKE</span> <span class="string">&#x27;%斯&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> product <span class="keyword">WHERE</span> pname <span class="keyword">LIKE</span> <span class="string">&#x27;__斯&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>4）范围查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BETWEEN</span> ... <span class="keyword">AND</span> ... 表示在一个连续的范围内查询</span><br><span class="line"># 示例</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> product <span class="keyword">WHERE</span> price <span class="keyword">BETWEEN</span> <span class="number">800</span> <span class="keyword">AND</span> <span class="number">2000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">IN</span> 表示在一个非连续的范围内查询</span><br><span class="line"># 示例</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> product <span class="keyword">WHERE</span> price <span class="keyword">IN</span> (<span class="number">600</span>, <span class="number">800</span>, <span class="number">2000</span>);</span><br></pre></td></tr></table></figure>

<p>5）空判断</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">IS</span> <span class="keyword">NULL</span>：判断为空</span><br><span class="line"># 示例</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> product <span class="keyword">WHERE</span> category_id <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>：判断不为空</span><br><span class="line"># 示例</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> product <span class="keyword">WHERE</span> category_id <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<h3 id="DQL数据查询语言-排序查询"><a href="#DQL数据查询语言-排序查询" class="headerlink" title="DQL数据查询语言-排序查询"></a>DQL数据查询语言-排序查询</h3><p><strong>SQL排序查询</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">	<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> 表名</span><br><span class="line"># 按照指定的列对查询的结果进行排序，默认排序方式是<span class="keyword">ASC</span></span><br><span class="line"># <span class="keyword">ASC</span>：ascending，表示升序</span><br><span class="line"># <span class="keyword">DESC</span>：descending，表示降序</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> 列<span class="number">1</span> <span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>, 列<span class="number">2</span> <span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>, ...;</span><br></pre></td></tr></table></figure>

<h3 id="DQL数据查询语言-聚合函数"><a href="#DQL数据查询语言-聚合函数" class="headerlink" title="DQL数据查询语言-聚合函数"></a>DQL数据查询语言-聚合函数</h3><p>成绩表，计算学生成绩平均分？计算学生成绩最大值？计算学生成绩最小值？</p>
<p>聚合函数又叫组函数、统计函数，通常是对表中的数据进行统计和计算，一般结合分组(GROUP BY)来使用，用于统计和计算分组数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	聚合函数(列名),</span><br><span class="line">	...</span><br><span class="line"><span class="keyword">FROM</span> 表名;</span><br></pre></td></tr></table></figure>

<p><strong>常用的聚合函数</strong>：</p>
<ul>
<li>COUNT(col)：表示求指定列的总记录数</li>
<li>MAX(col)：表示求指定列的最大值</li>
<li>MIN(col)：表示求指定列的最小值</li>
<li>SUM(col)：表示求指定列的和</li>
<li>AVG(col)：表示求指定列的平均值</li>
</ul>
<p>注意：</p>
<ul>
<li><strong>聚合函数的计算会忽略 NULL 值</strong>。</li>
<li>例如：求四个产品的价格平均值，如果有一个价格是NULL，则忽略，求其他三个商品的平均值。</li>
</ul>
<h3 id="DQL数据查询语言-分组查询"><a href="#DQL数据查询语言-分组查询" class="headerlink" title="DQL数据查询语言-分组查询"></a>DQL数据查询语言-分组查询</h3><p>成绩表，分别计算男生和女生的平均成绩？计算不同班级的学生成绩的平均分？</p>
<p>分组查询就是将查询结果按照指定字段进行分组，指定字段数据值相同的分为一组。</p>
<p><strong>分组查询语法</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    分组字段...,</span><br><span class="line">    聚合函数(字段)...</span><br><span class="line"><span class="keyword">FROM</span> 表名</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> 分组字段<span class="number">1</span>, 分组字段<span class="number">2.</span>..;</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    分组字段...,</span><br><span class="line">    聚合函数(字段)...</span><br><span class="line"><span class="keyword">FROM</span> 表名</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> 分组字段<span class="number">1</span>, 分组字段<span class="number">2.</span>..</span><br><span class="line"><span class="keyword">HAVING</span> 条件表达式;</span><br></pre></td></tr></table></figure>

<ul>
<li>GROUP BY 分组字段：是指按照指定列的值对表数据进行分组，列值相同的数据行分为一组。</li>
<li>分组之后，可以查询每一组的分组字段，或对每一组的指定列的数据进行聚合操作。</li>
<li>HAVING 条件表达式：用来对分组聚合的结果进行过滤。</li>
</ul>
<p><strong>HAVING 与 WHERE 的区别：</strong></p>
<ul>
<li><p>HAVING 是对分组聚合之后的结果进行过滤，WHERE 是在分组前对表数据进行过滤。</p>
<ul>
<li>WHERE -&gt; GROUP BY -&gt; 聚合 -&gt; HAVING</li>
</ul>
</li>
<li><p>HAVING 后面可以使用聚合函数(统计函数)，WHERE后面不可以使用聚合函数。</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 注意：分组聚合操作时，SELECT之后，除了分组字段和聚合函数可以查询，其他的不能查询（会报错）</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    category_id,</span><br><span class="line">    pname, <span class="comment">-- SQL认为这是查每一组的pname，但是每一组的pname可能有多个，所以不允许查询</span></span><br><span class="line">    <span class="built_in">MAX</span>(price)</span><br><span class="line"><span class="keyword">FROM</span> product</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> category_id;</span><br></pre></td></tr></table></figure>

<p>如果出现上面的 sql 语句不报错，执行下面的sql，关闭mysql的测试模式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> @<span class="variable">@global</span>.sql_mode <span class="operator">=</span> <span class="string">&#x27;ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="DQL数据查询语言-去重查询"><a href="#DQL数据查询语言-去重查询" class="headerlink" title="DQL数据查询语言-去重查询"></a>DQL数据查询语言-去重查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="keyword">DISTINCT</span> 字段<span class="number">1</span>, 字段<span class="number">2</span>, ...</span><br><span class="line"><span class="keyword">FROM</span> 表;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>DISTINCT只能写在查询字段的第一个位置</p>
</blockquote>
<h3 id="DQL数据查询语言-分页查询"><a href="#DQL数据查询语言-分页查询" class="headerlink" title="DQL数据查询语言-分页查询"></a>DQL数据查询语言-分页查询</h3><p><strong>分页查询语法</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">	字段列表 </span><br><span class="line"><span class="keyword">FROM</span> 表名</span><br><span class="line">LIMIT M, N;</span><br></pre></td></tr></table></figure>

<ul>
<li>M表示开始行索引，默认是0，代表从下标M的位置开始分页</li>
<li>N表示查询条数，即提取多少条数据</li>
</ul>
<p><strong>示例</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 示例1：获取 product 表中的第一条记录</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> product LIMIT <span class="number">0</span>, <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 示例2：获取 product 表中下标为2记录开始的2条记录</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> product LIMIT <span class="number">2</span>, <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 示例4：当分页展示的数据不存在时，不报错，只不过查询不到任何数据</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> product</span><br><span class="line"><span class="keyword">WHERE</span> category_id <span class="operator">=</span> <span class="string">&#x27;c002&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> price</span><br><span class="line">LIMIT <span class="number">25</span>, <span class="number">2</span>; <span class="comment">-- 没有第26行，但是结果不会报错，只是没有查询结果</span></span><br></pre></td></tr></table></figure>

<p><strong>SQL语句的执行顺序</strong>：</p>
<ol>
<li>FROM：<br>首先处理 FROM 子句，构建基础数据集。如果有多个表通过 JOIN 进行关联，则首先计算笛卡尔积，然后应用 JOIN 条件。<br>如果有表别名，此时也会解析并绑定到相应的表上。</li>
<li>JOINs：<br>根据 JOIN 条件（包括 INNER JOIN, LEFT JOIN, RIGHT JOIN, FULL JOIN 等）连接来自 FROM 子句中各个表的数据行。</li>
<li>ON：<br>应用 ON 子句的条件来筛选出满足连接条件的数据行，将其加入到虚拟表中。</li>
<li>WHERE：<br>接下来执行 WHERE 子句，对已连接的基础数据集进行行级别的过滤，剔除不符合给定条件的行。</li>
<li>GROUP BY：<br>如果存在 GROUP BY 子句，则按照指定的列进行分组操作，形成新的分组集合，并对每个分组计算聚合函数值（如 SUM, COUNT, AVG, MIN, MAX 等）。</li>
<li>HAVING：<br>对分组后的结果集进一步应用 HAVING 子句的条件，这是针对分组后的聚合值的过滤。</li>
<li>SELECT：<br>执行 SELECT 子句，根据其定义的列表选择列，并按照是否使用了聚合函数决定是否返回每组的汇总值。</li>
<li>DISTINCT：<br>如果 SELECT 中包含了 DISTINCT 关键字，则在此阶段去除重复的行。</li>
<li>ORDER BY：<br>最后，对最终的结果集按 ORDER BY 子句指定的列进行排序。</li>
<li>LIMIT/OFFSET（可选）：<br>如果查询中有 LIMIT 或 OFFSET 子句，最后将结果集按照指定的数量和偏移量进行截断，用于实现分页或者其他类型的行数限制。</li>
</ol>
<h2 id="SQL复杂语句查询"><a href="#SQL复杂语句查询" class="headerlink" title="SQL复杂语句查询"></a>SQL复杂语句查询</h2><h3 id="多表关联查询-表之间的3种关联关系】"><a href="#多表关联查询-表之间的3种关联关系】" class="headerlink" title="多表关联查询-表之间的3种关联关系】"></a>多表关联查询-表之间的3种关联关系】</h3><p>实际开发中，一个项目通常需要很多张表才能完成，而这些表之间存在着某些联系。</p>
<p>表之间的关系可以分为如下 3 种：</p>
<blockquote>
<p>假设有 A 和 B 两张表</p>
</blockquote>
<p><strong>一对多关系</strong>：A表的一行记录对应B表的多行记录，反过来B表的一行记录只对应A表的一行记录</p>
<ul>
<li>举例：商品分类和商品表</li>
</ul>
<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/%E4%B8%80%E5%AF%B9%E5%A4%9A.png" alt="一对多"></p>
<p><strong>多对多关系</strong>：A表的一行记录对应B表的多行记录，反过来B表的一行记录也对应A表的多行记录</p>
<ul>
<li>举例：学生表和课程表(选课关系)</li>
</ul>
<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/%25E4%25B8%2580%25E5%25AF%25B9%25E5%25A4%259A.png"></p>
<p><strong>一对一关系</strong>：A表的一行记录只对应B表的一行记录，反过来B表的一行记录也只对应A表的一行记录</p>
<ul>
<li>举例：员工基础信息表、员工详细信息表</li>
</ul>
<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/%E4%B8%80%E5%AF%B9%E4%B8%80.png" alt="一对一"></p>
<h3 id="多表关联查询-外键约束"><a href="#多表关联查询-外键约束" class="headerlink" title="多表关联查询-外键约束"></a>多表关联查询-外键约束</h3><p>假设有两张表A和B，B表的某列的值引用了A表的主键列的值，则B表的这一列称为B表的<strong>外键列</strong>(Foreign Key)，其中A表称为<strong>主表</strong>，B表称为<strong>从表</strong>。</p>
<blockquote>
<p>在一对多关联关系建表时，在从表(多方)创建一个字段，字段作为外键指向主表(一方)的主键</p>
</blockquote>
<p><strong>外键约束语法</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CONSTRAINT</span> <span class="keyword">FOREIGN</span> KEY (外键字段) <span class="keyword">REFERENCES</span> 主表名(主键)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 示例1：新建分类表 category 和 商品表 product</span></span><br><span class="line"># 创建分类表</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> category (</span><br><span class="line">    cid   <span class="type">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">PRIMARY</span> KEY, # 分类id</span><br><span class="line">    cname <span class="type">VARCHAR</span>(<span class="number">100</span>) # 分类名称</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">DESC</span> category;</span><br><span class="line"></span><br><span class="line"># 商品表</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> products (</span><br><span class="line">    pid         <span class="type">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    pname       <span class="type">VARCHAR</span>(<span class="number">40</span>),</span><br><span class="line">    price       <span class="keyword">DOUBLE</span>,</span><br><span class="line">    category_id <span class="type">VARCHAR</span>(<span class="number">32</span>), <span class="comment">-- 商品分类id，外键</span></span><br><span class="line">    # <span class="keyword">CONSTRAINT</span> 约束</span><br><span class="line">    # <span class="keyword">REFERENCES</span> 引用</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> <span class="keyword">FOREIGN</span> KEY (category_id) <span class="keyword">REFERENCES</span> category (cid) # 添加外键约束</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>外键约束的作用</strong>：</p>
<ul>
<li><p>保证插入数据的准确性：从表中外键的值在主表主键中必须有对应的值</p>
</li>
<li><p>保证删除数据的完整性：主表的主键值被从表外键引用之后，主表中对应的记录不能被删除</p>
</li>
</ul>
<p><strong>外键约束的缺点</strong>：</p>
<ul>
<li>过分强调或者说使用主键／外键会平添开发难度</li>
<li>添加外键，也会降低数据增删改的性能</li>
<li><strong>注意：实际开发，很少使用外键约束，而是从代码层面保持表之间的关系</strong></li>
</ul>
<p><strong>外键其他操作</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看表的约束</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表名;</span><br><span class="line"><span class="comment">-- 删除外键约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> KEY 外键约束名;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 示例：</span></span><br><span class="line"><span class="comment">-- 查看表的约束</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> products;</span><br><span class="line"><span class="comment">-- 删除外键约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> products <span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> KEY products_ibfk_1;</span><br></pre></td></tr></table></figure>

<h3 id="多表关联查询-关联查询操作"><a href="#多表关联查询-关联查询操作" class="headerlink" title="多表关联查询-关联查询操作"></a>多表关联查询-关联查询操作</h3><p>笛卡尔积(交叉连接)：将左表的每一行数据和右表的每一行数据分别进行关联，组成新的数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> 表<span class="number">1</span> <span class="comment">--左表</span></span><br><span class="line"><span class="keyword">JOIN</span> 表<span class="number">2</span> <span class="comment">--右表; -- CROSS JOIN</span></span><br><span class="line"></span><br><span class="line">或</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> 表<span class="number">1</span>, 表<span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<p>有条件连接：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> 表<span class="number">1</span> <span class="comment">--左表</span></span><br><span class="line"><span class="keyword">JOIN</span> 表<span class="number">2</span> <span class="comment">--右表</span></span><br><span class="line"><span class="keyword">ON</span> 连接条件; <span class="comment">-- 比如：ON 表1.字段=表2.字段;</span></span><br></pre></td></tr></table></figure>

<p><strong>关联查询的语法</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> 左表</span><br><span class="line"><span class="keyword">INNER</span><span class="operator">|</span><span class="keyword">LEFT</span><span class="operator">|</span><span class="keyword">RIGHT</span><span class="operator">|</span><span class="keyword">FULL</span> <span class="keyword">JOIN</span> 右表</span><br><span class="line"><span class="keyword">ON</span> 连接条件; <span class="comment">-- 比如：ON 左表.列名 = 右表.列名</span></span><br></pre></td></tr></table></figure>

<p><strong>关联查询的 4 种分类</strong>：</p>
<p>1）<strong>内连接：INNER JOIN，简写为 JOIN</strong></p>
<ul>
<li><p>返回两张表都满足连接条件的部分(交集)</p>
</li>
<li><p>左右两表关联时，满足关联条件的数据，才会出现在最终的关联结果中</p>
</li>
</ul>
<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/%E5%86%85%E8%BF%9E%E6%8E%A5.png" alt="内连接"></p>
<p>2）<strong>左外连接：LEFT OUTER JOIN，简写为 LEFT JOIN</strong></p>
<ul>
<li><p>左侧+交集部分</p>
</li>
<li><p>左右两表关联时，除满足关联条件的数据会出现在最终的关联结果中，左表中不能和右边表联的数据也会出现，右表侧自动填充为NULL</p>
</li>
</ul>
<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/%E5%B7%A6%E8%BF%9E%E6%8E%A5.png" alt="左连接"></p>
<p>3）<strong>右外连接：RIGHT OUTER JOIN，简写为 RIGHT JOIN</strong></p>
<ul>
<li><p>右侧+交集部分</p>
</li>
<li><p>左右两表关联时，除满足关联条件的数据会出现在最终的关联结果中，右表中不能和左表关联的数据也会出现，左表侧自动填充为NULL</p>
</li>
</ul>
<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/%25E5%258F%25B3%25E8%25BF%259E%25E6%258E%25A5.png" alt="右连接"></p>
<p>4）<strong>全外连接：FULL OUTER JOIN，简写为 FULL JOIN</strong></p>
<blockquote>
<p>注意：MySQL数据库不支持全连接，需要将左连接和右连接的结果利用 UNION 关键字组合实现全连接的效果。</p>
</blockquote>
<ul>
<li><p>左侧 + 交集部分 + 右则</p>
</li>
<li><p>左右两表关联时，除满足关联条件的数据会出现在最终的关联结果中，左右两表不能相互关联的数据也都会出现，对应侧自动填充为NULL</p>
</li>
</ul>
<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/%E5%85%A8%E8%BF%9E%E6%8E%A5.png" alt="全连接"></p>
<h3 id="SQL查询时使用AS关键字起别名"><a href="#SQL查询时使用AS关键字起别名" class="headerlink" title="SQL查询时使用AS关键字起别名"></a>SQL查询时使用AS关键字起别名</h3><p>在SQL查询时，可以使用 AS 给表或者字段起别名，AS可以省略</p>
<p>1）给查询字段和表起别名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 示例1：每个所有分类的所有商品，没有商品的分类和没有分类的商品都不显示</span></span><br><span class="line"><span class="comment">-- 查询字段：分类id、分类名称、商品id、商品名称</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    category.id <span class="keyword">AS</span> cid, <span class="comment">-- 类别id</span></span><br><span class="line">    category.name <span class="keyword">AS</span> cname, <span class="comment">-- 类别名称</span></span><br><span class="line">    products.id <span class="keyword">AS</span> pid, <span class="comment">-- 商品id</span></span><br><span class="line">    products.name <span class="keyword">AS</span> pname <span class="comment">-- 商品名称</span></span><br><span class="line"><span class="keyword">FROM</span> category c <span class="comment">-- 左表</span></span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> products p <span class="comment">-- 右表</span></span><br><span class="line"><span class="keyword">ON</span> category.id <span class="operator">=</span> products.category_id;</span><br></pre></td></tr></table></figure>

<h3 id="多表关联查询-自关联查询"><a href="#多表关联查询-自关联查询" class="headerlink" title="多表关联查询-自关联查询"></a>多表关联查询-自关联查询</h3><p>进行关联时，左表和右表是同一个表，这样的连接叫自关联。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建一个地区表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> areas(</span><br><span class="line">    id <span class="type">VARCHAR</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    title <span class="type">VARCHAR</span>(<span class="number">30</span>),</span><br><span class="line">    pid <span class="type">VARCHAR</span>(<span class="number">30</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `areas` <span class="keyword">VALUES</span> (<span class="string">&#x27;110000&#x27;</span>, <span class="string">&#x27;北京市&#x27;</span>, <span class="keyword">NULL</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `areas` <span class="keyword">VALUES</span> (<span class="string">&#x27;110100&#x27;</span>, <span class="string">&#x27;北京市&#x27;</span>, <span class="string">&#x27;110000&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `areas` <span class="keyword">VALUES</span> (<span class="string">&#x27;110101&#x27;</span>, <span class="string">&#x27;东城区&#x27;</span>, <span class="string">&#x27;110100&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `areas` <span class="keyword">VALUES</span> (<span class="string">&#x27;110102&#x27;</span>, <span class="string">&#x27;西城区&#x27;</span>, <span class="string">&#x27;110100&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `areas` <span class="keyword">VALUES</span> (<span class="string">&#x27;110105&#x27;</span>, <span class="string">&#x27;朝阳区&#x27;</span>, <span class="string">&#x27;110100&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `areas` <span class="keyword">VALUES</span> (<span class="string">&#x27;110106&#x27;</span>, <span class="string">&#x27;丰台区&#x27;</span>, <span class="string">&#x27;110100&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `areas` <span class="keyword">VALUES</span> (<span class="string">&#x27;110107&#x27;</span>, <span class="string">&#x27;石景山区&#x27;</span>, <span class="string">&#x27;110100&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `areas` <span class="keyword">VALUES</span> (<span class="string">&#x27;110108&#x27;</span>, <span class="string">&#x27;海淀区&#x27;</span>, <span class="string">&#x27;110100&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `areas` <span class="keyword">VALUES</span> (<span class="string">&#x27;110109&#x27;</span>, <span class="string">&#x27;门头沟区&#x27;</span>, <span class="string">&#x27;110100&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `areas` <span class="keyword">VALUES</span> (<span class="string">&#x27;110111&#x27;</span>, <span class="string">&#x27;房山区&#x27;</span>, <span class="string">&#x27;110100&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `areas` <span class="keyword">VALUES</span> (<span class="string">&#x27;110112&#x27;</span>, <span class="string">&#x27;通州区&#x27;</span>, <span class="string">&#x27;110100&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `areas` <span class="keyword">VALUES</span> (<span class="string">&#x27;110113&#x27;</span>, <span class="string">&#x27;顺义区&#x27;</span>, <span class="string">&#x27;110100&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `areas` <span class="keyword">VALUES</span> (<span class="string">&#x27;110114&#x27;</span>, <span class="string">&#x27;昌平区&#x27;</span>, <span class="string">&#x27;110100&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `areas` <span class="keyword">VALUES</span> (<span class="string">&#x27;110115&#x27;</span>, <span class="string">&#x27;大兴区&#x27;</span>, <span class="string">&#x27;110100&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `areas` <span class="keyword">VALUES</span> (<span class="string">&#x27;110116&#x27;</span>, <span class="string">&#x27;怀柔区&#x27;</span>, <span class="string">&#x27;110100&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `areas` <span class="keyword">VALUES</span> (<span class="string">&#x27;110117&#x27;</span>, <span class="string">&#x27;平谷区&#x27;</span>, <span class="string">&#x27;110100&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `areas` <span class="keyword">VALUES</span> (<span class="string">&#x27;110118&#x27;</span>, <span class="string">&#x27;密云区&#x27;</span>, <span class="string">&#x27;110100&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `areas` <span class="keyword">VALUES</span> (<span class="string">&#x27;110119&#x27;</span>, <span class="string">&#x27;延庆区&#x27;</span>, <span class="string">&#x27;110100&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 示例1：查询&#x27;山西省&#x27;下的所有市的信息</span></span><br><span class="line"><span class="comment">-- 查询结果字段：</span></span><br><span class="line"><span class="comment">--   市级地区id、市级地区名称、父级地区id、父级地区名称</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    c.id,</span><br><span class="line">    c.title,</span><br><span class="line">    c.pid,</span><br><span class="line">    p.title</span><br><span class="line"><span class="keyword">FROM</span> areas c <span class="comment">-- 理解为市表</span></span><br><span class="line"><span class="keyword">JOIN</span> areas p <span class="comment">-- 理解为省表</span></span><br><span class="line"><span class="keyword">ON</span> c.pid <span class="operator">=</span> p.id</span><br><span class="line"><span class="keyword">WHERE</span> p.title <span class="operator">=</span> <span class="string">&#x27;山西省&#x27;</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：自关联时，需要给表起别名。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 自关联的妙用</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> sales (</span><br><span class="line">    <span class="keyword">month</span> <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>, <span class="comment">-- 月份</span></span><br><span class="line">    revenue <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="comment">-- 销售额</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> sales</span><br><span class="line"><span class="keyword">VALUES</span></span><br><span class="line">    (<span class="number">1</span>, <span class="number">1000</span>),</span><br><span class="line">    (<span class="number">2</span>, <span class="number">800</span>),</span><br><span class="line">    (<span class="number">3</span>, <span class="number">1200</span>),</span><br><span class="line">    (<span class="number">4</span>, <span class="number">2000</span>),</span><br><span class="line">    (<span class="number">5</span>, <span class="number">1800</span>),</span><br><span class="line">    (<span class="number">6</span>, <span class="number">5000</span>),</span><br><span class="line">    (<span class="number">7</span>, <span class="number">3000</span>),</span><br><span class="line">    (<span class="number">8</span>, <span class="number">2500</span>),</span><br><span class="line">    (<span class="number">9</span>, <span class="number">1600</span>),</span><br><span class="line">    (<span class="number">10</span>, <span class="number">2200</span>),</span><br><span class="line">    (<span class="number">11</span>, <span class="number">900</span>),</span><br><span class="line">    (<span class="number">12</span>, <span class="number">4600</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 示例：查询每个月的销售额和前一个月的销售额的差值</span></span><br><span class="line"><span class="comment">-- 查询结果字段：</span></span><br><span class="line"><span class="comment">--  月份、当前月销售额、前一个月销售额，当前月销售额和前一个月销售额的差</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    a.month,</span><br><span class="line">    a.revenue, <span class="comment">-- 当前月销售额</span></span><br><span class="line">    b.revenue, <span class="comment">-- 上个月销售额</span></span><br><span class="line">    a.revenue <span class="operator">-</span> b.revenue <span class="comment">-- 当前月销售额 和 上个月销售额 的差值</span></span><br><span class="line"><span class="keyword">FROM</span> sales a</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> sales b</span><br><span class="line"><span class="keyword">ON</span> a.month <span class="operator">=</span> b.month <span class="operator">+</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> a.month;</span><br></pre></td></tr></table></figure>

<h3 id="SQL子查询操作"><a href="#SQL子查询操作" class="headerlink" title="SQL子查询操作"></a>SQL子查询操作</h3><blockquote>
<p>在一个 SELECT 语句中，嵌入了另外一个 SELECT 语句，那么被嵌入的 SELECT 语句称之为子查询语句，外部那个SELECT 语句则称为主查询。</p>
</blockquote>
<p><strong>主查询和子查询的关系</strong>：</p>
<p>1）子查询是嵌入到主查询中</p>
<p>2）<strong>子查询是辅助主查询的，要么充当条件，要么充当数据源，要么充当查询字段</strong></p>
<p>3）子查询是可以独立存在的语句，是一条完整的 SELECT 语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 示例1：查询当前商品大于平均价格的商品</span></span><br><span class="line"><span class="comment">-- ① 查询商品的平均价格</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(price) <span class="keyword">FROM</span> products;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ② 查询所有商品</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> products;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ③ 将第①步的结果作为第②步的查询条件</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> products</span><br><span class="line"><span class="keyword">WHERE</span> price <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(price) <span class="keyword">FROM</span> products);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 示例4：查询不同类型商品的平均价格</span></span><br><span class="line"><span class="comment">-- 查询结果字段：</span></span><br><span class="line"><span class="comment">--  id(分类id)、cname(分类名称)、avg(分类商品平均价格)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    category_id,</span><br><span class="line">    cname,</span><br><span class="line">    avg</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span></span><br><span class="line">        category_id,</span><br><span class="line">        <span class="built_in">AVG</span>(price) <span class="keyword">AS</span> `avg`</span><br><span class="line">    <span class="keyword">FROM</span> products</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> category_id</span><br><span class="line">) a <span class="comment">-- 子查询作用数据源时，必须起别名</span></span><br><span class="line"><span class="keyword">JOIN</span> category b</span><br><span class="line"><span class="keyword">ON</span> a.category_id <span class="operator">=</span> b.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 示例5：针对 students 表的数据，计算每个同学的Score分数和整体平均分数的差值</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="operator">*</span>,</span><br><span class="line">    (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(Score) <span class="keyword">FROM</span> students) <span class="keyword">AS</span> `avg`,</span><br><span class="line">    Score <span class="operator">-</span> (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(Score) <span class="keyword">FROM</span> students) <span class="keyword">AS</span> `difference`</span><br><span class="line"><span class="keyword">FROM</span> students;</span><br></pre></td></tr></table></figure>

<h3 id="SQL窗口函数简介"><a href="#SQL窗口函数简介" class="headerlink" title="SQL窗口函数简介"></a>SQL窗口函数简介</h3><p>窗口函数是 MySQL8.0 以后加入的功能，之前需要通过定义临时变量和大量的子查询才能完成的工作，使用窗口函数实现起来更加简洁高效。<strong>同时窗口函数也是面试的高频考点</strong>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 示例1：针对 students 表的数据，计算每个同学的Score分数和整体平均分数的差值</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="operator">*</span>,</span><br><span class="line">    <span class="built_in">AVG</span>(Score) <span class="keyword">OVER</span>() <span class="keyword">AS</span> `avg`,</span><br><span class="line">    Score <span class="operator">-</span> <span class="built_in">AVG</span>(Score) <span class="keyword">OVER</span>() <span class="keyword">AS</span> `difference`</span><br><span class="line"><span class="keyword">FROM</span> students;</span><br></pre></td></tr></table></figure>

<p><strong>窗口函数的优点</strong>：</p>
<p>1）<strong>简单</strong></p>
<ul>
<li>窗口函数更易于使用。在上面的示例中，与使用聚合函数然后合并结果相比，使用窗口函数的 SQL 语句更加简单。</li>
</ul>
<p>2）<strong>快速</strong></p>
<ul>
<li>这一点与上一点相关，使用窗口函数比使用替代方法要快得多。当你处理成百上千个千兆字节的数据时，这非常有用。</li>
</ul>
<p>3）<strong>多功能性</strong></p>
<ul>
<li>最重要的是，窗口函数具有多种功能，比如：添加移动平均线、添加行号和滞后数据等等。</li>
</ul>
<h3 id="窗口函数-基本用法"><a href="#窗口函数-基本用法" class="headerlink" title="窗口函数-基本用法"></a>窗口函数-基本用法</h3><p><strong>OVER()关键字</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    字段,</span><br><span class="line">    ...,</span><br><span class="line">    <span class="operator">&lt;</span><span class="keyword">window</span> <span class="keyword">function</span><span class="operator">&gt;</span> <span class="keyword">OVER</span>(...)</span><br><span class="line"><span class="keyword">FROM</span> 表名;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>&lt;window function&gt;</code> 表示使用的窗口函数，窗口函数可以使用之前已经学过的聚合函数，比如<code>COUNT()</code>、<code>SUM()</code>、<code>AVG()</code>等，也可以是其他函数，比如 ranking 排序函数等，后面的课程中会介绍</li>
<li><code>OVER(...)</code>的作用就是设置每行数据关联的一组数据范围，<code>OVER()</code>时，每行关联的数据范围都是整张表的数据。</li>
</ul>
<p>SQL举例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="operator">*</span>,</span><br><span class="line">    <span class="built_in">AVG</span>(Score) <span class="keyword">OVER</span>() <span class="keyword">AS</span> `avg`,</span><br><span class="line">    Score <span class="operator">-</span> <span class="built_in">AVG</span>(Score) <span class="keyword">OVER</span>() <span class="keyword">AS</span> `difference`</span><br><span class="line"><span class="keyword">FROM</span> students;</span><br></pre></td></tr></table></figure>

<p><strong>典型应用场景</strong>：</p>
<p>1）场景1：<strong>计算每个值和整体平均值的差值</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 需求：计算每个学生的 Score 分数和所有学生整体平均分的差值。</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    ID,</span><br><span class="line">    Name,</span><br><span class="line">    Gender,</span><br><span class="line">    Score,</span><br><span class="line">    <span class="built_in">AVG</span>(Score) <span class="keyword">OVER</span>() <span class="keyword">AS</span> `AVG_Score`,</span><br><span class="line">    Score <span class="operator">-</span> <span class="built_in">AVG</span>(Score) <span class="keyword">OVER</span>() <span class="keyword">AS</span> `difference`</span><br><span class="line"><span class="keyword">FROM</span> students;</span><br></pre></td></tr></table></figure>

<p>2）场景2：<strong>计算每个值占整体之和的占比</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 需求：计算每个学生的Score分数占所有学生分数之和的百分比</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    ID,</span><br><span class="line">    Name,</span><br><span class="line">    Gender,</span><br><span class="line">    Score,</span><br><span class="line">    <span class="built_in">SUM</span>(Score) <span class="keyword">OVER</span>() <span class="keyword">AS</span> `sum`,</span><br><span class="line">    <span class="comment">-- 计算百分比：要把 Score / SUM(Score) OVER() 的结果再乘 100</span></span><br><span class="line">    Score <span class="operator">/</span> <span class="built_in">SUM</span>(Score) <span class="keyword">OVER</span>() <span class="operator">*</span> <span class="number">100</span> <span class="keyword">AS</span> `ratio`</span><br><span class="line"><span class="keyword">FROM</span> students;</span><br></pre></td></tr></table></figure>

<h3 id="窗口函数-PARTITION-BY分区"><a href="#窗口函数-PARTITION-BY分区" class="headerlink" title="窗口函数-PARTITION BY分区"></a>窗口函数-PARTITION BY分区</h3><p>如何计算每个学生的 Score 分数和同性别学生平均分的差值？</p>
<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/1.png" alt="1"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ID, name,Gender,Score<span class="operator">-</span><span class="built_in">AVG</span>(Score) <span class="keyword">OVER</span> (),Score,<span class="built_in">AVG</span>(Score) <span class="keyword">OVER</span>()学生平均分 <span class="keyword">FROM</span> students;</span><br></pre></td></tr></table></figure>

<p><strong>PARTITION BY分区</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 基础语法</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    字段,</span><br><span class="line">    ...,</span><br><span class="line">    <span class="operator">&lt;</span><span class="keyword">window</span> <span class="keyword">function</span><span class="operator">&gt;</span> <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> 字段, ...)</span><br><span class="line"><span class="keyword">FROM</span> 表名;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>PARTITION BY 列名, ...</code>的作用是按照指定列的值对整张表的数据进行分区，OVER()中没有PARTITION BY时，整张表就是一个分区。</li>
<li>分区之后，在处理每行数据时，<code>&lt;window function&gt;</code>是作用在该行数据关联的分区上，不再是整张表上</li>
</ul>
<p>SQL举例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    ID,</span><br><span class="line">    Name,</span><br><span class="line">    Gender,</span><br><span class="line">    Score,</span><br><span class="line">    <span class="comment">-- PARTITION BY Gender：按照性别对整张表的数据进行分区，此处会分成2个区</span></span><br><span class="line">    <span class="comment">-- AVG(Score)：处理每行数据时，应用 AVG 对该行关联分区数据中的 Score 求平均</span></span><br><span class="line">    <span class="built_in">AVG</span>(Score) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> Gender) <span class="keyword">AS</span> `Avg`</span><br><span class="line"><span class="keyword">FROM</span> students;</span><br></pre></td></tr></table></figure>

<p><strong>应用示例</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 需求：计算每个学生的 Score 分数和同性别学生平均分的差值</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    ID,</span><br><span class="line">    Name,</span><br><span class="line">    Gender,</span><br><span class="line">    Score,</span><br><span class="line">    <span class="comment">-- PARTITION BY Gender：按照性别对整张表的数据进行分区，此处会分成2个区</span></span><br><span class="line">    <span class="comment">-- AVG(Score)：处理每行数据时，应用 AVG 对该行关联分区数据中的 Score 求平均</span></span><br><span class="line">    <span class="built_in">AVG</span>(Score) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> Gender) <span class="keyword">AS</span> `Avg`,</span><br><span class="line">    Score <span class="operator">-</span> <span class="built_in">AVG</span>(Score) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> Gender) <span class="keyword">AS</span> `difference`</span><br><span class="line"><span class="keyword">FROM</span> students;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 需求：计算每人各科分数与对应科目最高分的占比</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    name,</span><br><span class="line">    course,</span><br><span class="line">    score,</span><br><span class="line">    <span class="comment">-- 处理每行数据时，计算相同科目成绩的最高分</span></span><br><span class="line">    <span class="built_in">MAX</span>(score) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> course) <span class="keyword">AS</span> `max`,</span><br><span class="line">    score <span class="operator">/</span> <span class="built_in">MAX</span>(score) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> course) <span class="keyword">AS</span> `ratio`</span><br><span class="line"><span class="keyword">FROM</span> tb_score;</span><br></pre></td></tr></table></figure>

<h3 id="窗口函数-排名函数使用"><a href="#窗口函数-排名函数使用" class="headerlink" title="窗口函数-排名函数使用"></a>窗口函数-排名函数使用</h3><p>如何将 tb_score 中的数据，按照分数从高到低产生一列排名序号？</p>
<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240328200534493.png" alt="image-20240328200534493"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    name,</span><br><span class="line">    course,</span><br><span class="line">    score,</span><br><span class="line">    <span class="comment">-- 此处 OVER() 中没有 PARTITION BY，所以整张表就是一个分区</span></span><br><span class="line">    <span class="comment">-- ORDER BY score DESC：按照 score 对每个分区内的数据降序排序</span></span><br><span class="line">    <span class="comment">-- RANK() 窗口函数的作用是对每个分区内的每一行产生一个排名序号</span></span><br><span class="line">    <span class="built_in">DENSE_RANK</span>()  <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> score <span class="keyword">DESC</span>) <span class="keyword">as</span> `rank`</span><br><span class="line"><span class="keyword">FROM</span> tb_score;</span><br></pre></td></tr></table></figure>

<p><strong>排名函数</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    字段,</span><br><span class="line">    ...,</span><br><span class="line">    <span class="operator">&lt;</span>ranking <span class="keyword">function</span><span class="operator">&gt;</span> <span class="keyword">OVER</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> 列名, ...)</span><br><span class="line"><span class="keyword">FROM</span> 表名;</span><br></pre></td></tr></table></figure>

<ul>
<li>OVER() 中可以指定 ORDER BY 按照指定列对每一行关联的分区数据进行排序，然后使用排名函数对分区内的每行数据产生一个排名序号</li>
</ul>
<blockquote>
<p>注意：RANK()产生的排名序号可能会不连续(<strong>当有并列情况时</strong>)</p>
</blockquote>
<p><strong>不同的排名函数</strong>：</p>
<ul>
<li><code>RANK()</code>：产生的排名序号 ，有并列的情况出现时序号不连续</li>
<li><code>DENSE_RANK()</code> ：产生的排名序号是连续的，有并列的情况时序号会重复</li>
<li><code>ROW_NUMBER()</code> ：返回连续唯一的行号，排名序号不会重复</li>
</ul>
<p>SQL举例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    name,</span><br><span class="line">    course,</span><br><span class="line">    score,</span><br><span class="line">    <span class="comment">-- 可能重复不连续</span></span><br><span class="line">    <span class="built_in">RANK</span>() <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> score <span class="keyword">DESC</span>) <span class="keyword">as</span> `rank`,</span><br><span class="line">    <span class="comment">-- 一定连续，可能重复</span></span><br><span class="line">    <span class="built_in">DENSE_RANK</span>() <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> score <span class="keyword">DESC</span>) <span class="keyword">as</span> `dense_rank`,</span><br><span class="line">    <span class="comment">-- 一定连续，且不重复</span></span><br><span class="line">    <span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> score <span class="keyword">DESC</span>) <span class="keyword">as</span> `row_number`</span><br><span class="line"><span class="keyword">FROM</span> tb_score;</span><br></pre></td></tr></table></figure>

<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240328201228210.png" alt="image-20240328201228210"></p>
<p><strong>PARTITION BY和排序函数配合使用</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 需求：按照不同科目，对学生的分数从高到低进行排名(要求：连续可重复)</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    name,</span><br><span class="line">    course,</span><br><span class="line">    score,</span><br><span class="line">    <span class="comment">-- 对每个分区内的每一行产生排名序号</span></span><br><span class="line">    <span class="built_in">DENSE_RANK</span>() <span class="keyword">OVER</span>(</span><br><span class="line">        <span class="comment">-- 将整张表的数据按照科目进行分区</span></span><br><span class="line">        <span class="keyword">PARTITION</span> <span class="keyword">BY</span> course</span><br><span class="line">        <span class="comment">-- 对每个分区内的数据按照score降序排列</span></span><br><span class="line">        <span class="keyword">ORDER</span> <span class="keyword">BY</span> score <span class="keyword">DESC</span></span><br><span class="line">    ) <span class="keyword">AS</span> `dense_rank`</span><br><span class="line"><span class="keyword">FROM</span> tb_score;</span><br></pre></td></tr></table></figure>

<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240328201240795.png" alt="image-20240328201240795"></p>
<p><strong>排名函数典型应用</strong>：</p>
<p>1）场景：<strong>获取指定排名的数据</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 需求：获取每个科目，排名第二的学生信息</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    name,</span><br><span class="line">    course,</span><br><span class="line">    score</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span></span><br><span class="line">        name,</span><br><span class="line">        course,</span><br><span class="line">        score,</span><br><span class="line">        <span class="built_in">DENSE_RANK</span>() <span class="keyword">OVER</span>(</span><br><span class="line">            <span class="keyword">PARTITION</span> <span class="keyword">BY</span> course</span><br><span class="line">            <span class="keyword">ORDER</span> <span class="keyword">BY</span> score <span class="keyword">DESC</span></span><br><span class="line">        ) <span class="keyword">AS</span> `dense_rank`</span><br><span class="line">    <span class="keyword">FROM</span> tb_score</span><br><span class="line">) s</span><br><span class="line"><span class="keyword">WHERE</span> `dense_rank` <span class="operator">=</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<p><strong>CTE公用表表达式</strong>：</p>
<p>CTE(公用表表达式)：Common Table Expresssion，类似于子查询，相当于一张临时表，可以在 CTE 结果的基础上，进行进一步的查询操作。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> some_name <span class="keyword">AS</span> (</span><br><span class="line">    <span class="comment">--- your CTE ---</span></span><br><span class="line">    <span class="comment">-- 完整的 SQL 语句</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    ... </span><br><span class="line"><span class="keyword">FROM</span> some_name</span><br></pre></td></tr></table></figure>

<ul>
<li>需要给CTE起一个名字（上面的例子中使用了<code>some_name</code>)，具体的查询语句写在括号中</li>
<li>在括号后面，就可以通过<code>SELECT</code> 将CTE的结果当作一张表来使用</li>
<li>将CTE称为“内部查询”，其后的部分称为“外部查询”</li>
<li>需要先定义CTE，即在外部查询的<code>SELECT</code>之前定义CTE</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 需求：获取每个科目，排名第二的学生信息</span></span><br><span class="line"><span class="keyword">WITH</span> ranking <span class="keyword">AS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span></span><br><span class="line">        name,</span><br><span class="line">        course,</span><br><span class="line">        score,</span><br><span class="line">        <span class="built_in">DENSE_RANK</span>() <span class="keyword">OVER</span>(</span><br><span class="line">            <span class="keyword">PARTITION</span> <span class="keyword">BY</span> course</span><br><span class="line">            <span class="keyword">ORDER</span> <span class="keyword">BY</span> score <span class="keyword">DESC</span></span><br><span class="line">        ) <span class="keyword">AS</span> `dense_rank`</span><br><span class="line">    <span class="keyword">FROM</span> tb_score</span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    name,</span><br><span class="line">    course,</span><br><span class="line">    score</span><br><span class="line"><span class="keyword">FROM</span> ranking</span><br><span class="line"><span class="keyword">WHERE</span> `dense_rank` <span class="operator">=</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<h3 id="窗口函数-自定义-window-frame"><a href="#窗口函数-自定义-window-frame" class="headerlink" title="窗口函数-自定义 window frame"></a>窗口函数-自定义 window frame</h3><p>现有一张某年度的月销量信息表 tb_sales，数据如下：</p>
<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240331194507672.png" alt="image-20240331194507672"></p>
<p><strong>分区数据范围和window frame数据范围</strong>：</p>
<p>在使用窗口函数处理表中的每行数据时，每行数据关联的数据有两种：</p>
<p>1）<strong>每行数据关联的分区数据</strong></p>
<ul>
<li>OVER()中什么都不写时，整张表默认是一个分区</li>
<li>OVER(PARTITION BY 列名, …)：整张表按照指定的列被进行了分区</li>
</ul>
<p>2）<strong>每行数据关联的window frame数据</strong></p>
<ul>
<li><code>每行关联的window frame数据范围 &lt;= 每行关联的分区数据范围</code></li>
<li><code>window frame数据范围是分区数据范围的子集</code></li>
</ul>
<p>目前我们所学的窗口函数中，有些窗口函数作用在分区上，有些函数作用在window frame上：</p>
<ul>
<li><strong>聚合函数(SUM、AVG、COUNT、MAX、MIN)作用于每行关联的window frame数据上</strong></li>
<li><strong>排名函数(RANK、DENSE_RANK、ROW_NUMBER)作用于每行关联的分区数据上</strong></li>
</ul>
<p><strong>自定义 window frame 范围</strong>：</p>
<blockquote>
<p>自定义 window frame 范围有两种方式： <code>ROWS</code> 和 <code>RANGE</code></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	字段,</span><br><span class="line">	...,</span><br><span class="line">    <span class="operator">&lt;</span><span class="keyword">window</span> <span class="keyword">function</span><span class="operator">&gt;</span> <span class="keyword">OVER</span> (</span><br><span class="line">      <span class="keyword">PARTITION</span> <span class="keyword">BY</span> 列名, ...</span><br><span class="line">      <span class="keyword">ORDER</span> <span class="keyword">BY</span> 列名, ...</span><br><span class="line">      [<span class="keyword">ROWS</span><span class="operator">|</span><span class="keyword">RANGE</span>] <span class="keyword">BETWEEN</span> 上限 <span class="keyword">AND</span> 下限</span><br><span class="line">    )</span><br><span class="line"><span class="keyword">FROM</span> 表名;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>PARTITION BY 列名, ...</code>：按照指定的列，对整张表的数据进行分区</li>
<li><code>ORDER BY 列名, ...</code>：按照指定的列，对每个分区内的数据进行排序</li>
<li><code>[ROWS|RANGE] BETWEEN 上限 AND 下限</code>：在排序之后的分区数据内，设置每行关联的window frame数据范围</li>
</ul>
<p><strong>上限和下限的设置</strong>：</p>
<ul>
<li><code>UNBOUNDED PRECEDING</code>：对上限无限制</li>
<li><code>PRECEDING</code>： 当前行之前的 <strong>n</strong> 行 （ <strong>n</strong> 表示具体数字如：5 <code>PRECEDING</code> ）</li>
<li><code>CURRENT ROW</code>：仅当前行</li>
<li><code>FOLLOWING</code>：当前行之后的 <strong>n</strong> 行 （ <strong>n</strong> 表示具体数字如：5 <code>FOLLOWING</code> ）</li>
<li><code>UNBOUNDED FOLLOWING</code>：对下限无限制</li>
<li>注意：<strong>上限需要在下限之前</strong>，比如：<code>ROWS BETWEEN CURRENT ROW AND UNBOUNDED PRECEDING</code> 是错误的</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 需求：计算截止到每个月的累计销量。1月：1月销量，2月：1月销量+2月销量，3月：1月销量+2月销量+3月销量，依次类推</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="keyword">month</span>,</span><br><span class="line">    sales,</span><br><span class="line">    <span class="built_in">SUM</span>(sales) <span class="keyword">OVER</span>(</span><br><span class="line">        # 按照 <span class="keyword">month</span> 对每个分区(注：此处就一个分区<span class="operator">-</span><span class="operator">&gt;</span>整张表)数据进行排序</span><br><span class="line">        <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">month</span></span><br><span class="line">        # 指定每行关联分区的 <span class="keyword">window</span> frame 范围</span><br><span class="line">        # UNBOUNDED PRECEDING：上限不限制</span><br><span class="line">        # <span class="keyword">CURRENT</span> <span class="type">ROW</span>：当前行</span><br><span class="line">        <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> UNBOUNDED PRECEDING <span class="keyword">AND</span> <span class="keyword">CURRENT</span> <span class="type">ROW</span></span><br><span class="line">    ) <span class="keyword">AS</span> `running_total`</span><br><span class="line"><span class="keyword">FROM</span> tb_sales;</span><br></pre></td></tr></table></figure>

<p><strong>window frame定义的简略写法</strong>：</p>
<p>自定义 window frame 的边界时，如果使用了<code>CURRENT ROW</code>作为上边界或者下边界，可以使用如下简略写法：</p>
<ul>
<li><code>ROWS UNBOUNDED PRECEDING</code> 等价于 <code>BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW</code></li>
<li><code>ROWS n PRECEDING</code> 等价于 <code>BETWEEN n PRECEDING AND CURRENT ROW</code></li>
<li><code>ROWS CURRENT ROW</code> 等价于 <code>BETWEEN CURRENT ROW AND CURRENT ROW</code></li>
<li>注意，简略写法不适合<code>FOLLOWING</code>的情况</li>
</ul>
<p><strong>ROWS和RANGE的区别</strong>：</p>
<p>ROWS和RANGE关键字，都可以用来自定义 windowframe 范围：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> 上限 <span class="keyword">AND</span> 下限</span><br><span class="line"><span class="keyword">RANGE</span> <span class="keyword">BETWEEN</span> 上限 <span class="keyword">AND</span> 下限</span><br></pre></td></tr></table></figure>

<p>但两者区别如下：</p>
<ul>
<li><p>ROWS是根据分区数据排序之后，每一行的 row_number 确定每行关联的 window frame 范围的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CURRENT</span> <span class="type">ROW</span>：仅代表当前行</span><br><span class="line"></span><br><span class="line"># 假设某一行数据的 row_number 为<span class="number">5</span>，<span class="keyword">ROWS</span>自定义<span class="keyword">window</span> frame如下：</span><br><span class="line"><span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> <span class="number">2</span> PRECEDING <span class="keyword">AND</span> <span class="number">2</span> FOLLOWING</span><br><span class="line"># 则这一行关联的<span class="keyword">window</span> frame是：<span class="number">5</span><span class="number">-2</span> <span class="operator">&lt;=</span> row_number <span class="operator">&lt;=</span> <span class="number">5</span><span class="operator">+</span><span class="number">2</span> 的数据</span><br></pre></td></tr></table></figure></li>
<li><p>RANGE是根据分区数据排序之后，每一行的排序列的值确实每行关联的 window frame 范围的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CURRENT</span> <span class="type">ROW</span>: 代表和当前行排序列的值相同的所有行</span><br><span class="line"></span><br><span class="line"># 假设某一行排序列的值为<span class="number">5</span>，RNAGE自定义<span class="keyword">window</span> frame如下：</span><br><span class="line"><span class="keyword">RANGE</span> <span class="keyword">BETWEEN</span> <span class="number">2</span> PRECEDING <span class="keyword">AND</span> <span class="number">2</span> FOLLOWING</span><br><span class="line"># 则这一行关联的<span class="keyword">window</span> frame是：<span class="number">5</span><span class="number">-2</span> <span class="operator">&lt;=</span> 排序列的值 <span class="operator">&lt;=</span> <span class="number">5</span><span class="operator">+</span><span class="number">2</span> 的数据</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>默认的window frame</strong>：</p>
<p>在 OVER 中只要添加了 ORDER BY，在没有写ROWS或RANGE的情况下，会有一个默认的 window frame范围：</p>
<ul>
<li>RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 需求：计算截止到每个月的累计销量。1月：1月销量，2月：1月销量+2月销量，3月：1月销量+2月销量+3月销量，依次类推</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="keyword">month</span>,</span><br><span class="line">    sales,</span><br><span class="line">    <span class="built_in">SUM</span>(sales) <span class="keyword">OVER</span>(</span><br><span class="line">        # 按照 <span class="keyword">month</span> 对每个分区(注：此处就一个分区<span class="operator">-</span><span class="operator">&gt;</span>整张表)数据进行排序</span><br><span class="line">        <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">month</span></span><br><span class="line">        # <span class="keyword">OVER</span> 中添加了 <span class="keyword">ORDER</span> <span class="keyword">BY</span> 之后，默认的 <span class="keyword">window</span> frame 范围</span><br><span class="line">        # <span class="keyword">RANGE</span> <span class="keyword">BETWEEN</span> UNBOUNDED PRECEDING <span class="keyword">AND</span> <span class="keyword">CURRENT</span> <span class="type">ROW</span></span><br><span class="line">    ) <span class="keyword">AS</span> `running_total`</span><br><span class="line"><span class="keyword">FROM</span> tb_sales;</span><br></pre></td></tr></table></figure>

<p><strong>PARTITION BY和自定义window frame</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 需求：利用tb_revenue表计算每个商店截止到每个月的累计销售额。1月：1月销量，2月：1月销量+2月销量，3月：1月销量+2月销量+3月销量，依次类推</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    store_id,</span><br><span class="line">    <span class="keyword">month</span>,</span><br><span class="line">    revenue,</span><br><span class="line">    <span class="built_in">SUM</span>(revenue) <span class="keyword">OVER</span>(</span><br><span class="line">        # 按照 store_id 对整张表的数据进行分区</span><br><span class="line">        <span class="keyword">PARTITION</span> <span class="keyword">BY</span> store_id</span><br><span class="line">        # 按照 <span class="keyword">month</span> 对每个分区内的数据排序</span><br><span class="line">        <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">month</span></span><br><span class="line">        # 设置 每行关联的分区 <span class="keyword">window</span> frame 范围</span><br><span class="line">        <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> UNBOUNDED PRECEDING <span class="keyword">AND</span> <span class="keyword">CURRENT</span> <span class="type">ROW</span></span><br><span class="line">    ) <span class="keyword">AS</span> `sum`</span><br><span class="line"><span class="keyword">FROM</span> tb_revenue;</span><br></pre></td></tr></table></figure>

<h3 id="SQL语句的执行顺序"><a href="#SQL语句的执行顺序" class="headerlink" title="SQL语句的执行顺序"></a>SQL语句的执行顺序</h3><p><strong>SQL语句的执行顺序如下</strong>：</p>
<blockquote>
<p>FROM &gt; JOIN &gt; ON &gt; WHERE &gt; GROUP BY &gt; 聚合函数 &gt; HAVING &gt; <strong>窗口函数</strong> &gt; SELECT &gt; DISTINCT  &gt; ORDER BY &gt; LIMIT</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">1) FROM</span><br><span class="line">2) JOIN</span><br><span class="line">3) ON</span><br><span class="line">4) WHERE</span><br><span class="line">5) GROUP BY</span><br><span class="line">6) 聚合函数</span><br><span class="line">7) HAVING</span><br><span class="line">8) 窗口函数</span><br><span class="line">9) SELECT</span><br><span class="line">10) DISTINCT【去重】</span><br><span class="line">11) ORDER BY</span><br><span class="line">12) LIMIT</span><br><span class="line"></span><br><span class="line">SELECT ⑨</span><br><span class="line">	[DISTINCT] 字段, ⑩</span><br><span class="line">	...,</span><br><span class="line">	聚合函数(字段), ⑥</span><br><span class="line">	窗口函数 ⑧</span><br><span class="line">FROM 表1 ①</span><br><span class="line">JOIN 表2 ②</span><br><span class="line">ON 关联条件 ③</span><br><span class="line">WHERE 条件 ④</span><br><span class="line">GROUP BY 分组字段, ... ⑤</span><br><span class="line">HAVING 条件 ⑦</span><br><span class="line">ORDER BY 排序字段, ... ⑪</span><br><span class="line">LIMIT M, N; ⑫</span><br></pre></td></tr></table></figure>

<h3 id="不能使用窗口函数的3种情况"><a href="#不能使用窗口函数的3种情况" class="headerlink" title="不能使用窗口函数的3种情况"></a>不能使用窗口函数的3种情况</h3><p><strong>情况1：不能在 WHRER 子句中使用窗口函数</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 需求：查询出所有拍卖中，最终成交价格高于平均成交价格的拍卖</span></span><br><span class="line"><span class="comment">-- 查询结果字段：</span></span><br><span class="line"><span class="comment">-- 	id、final_price(最终成交价格)</span></span><br><span class="line"></span><br><span class="line"># 错误示例</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	id,</span><br><span class="line">	final_price</span><br><span class="line"><span class="keyword">FROM</span> auction</span><br><span class="line"><span class="keyword">WHERE</span> final_price <span class="operator">&gt;</span> <span class="built_in">AVG</span>(final_price) <span class="keyword">OVER</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 子查询</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	id,</span><br><span class="line">	final_price</span><br><span class="line"><span class="keyword">FROM</span> auction</span><br><span class="line"><span class="keyword">WHERE</span> final_price <span class="operator">&gt;</span> (</span><br><span class="line">	<span class="keyword">SELECT</span></span><br><span class="line">		<span class="built_in">AVG</span>(final_price)</span><br><span class="line">	<span class="keyword">FROM</span> auction</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>情况2：不能在 HAVING 子句中使用窗口函数</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 需求：查询出国内平均成交价格高于所有拍卖平均成交价格的国家</span></span><br><span class="line"><span class="comment">-- 查询结果字段：</span></span><br><span class="line"><span class="comment">-- 	country(国家)、avg(该国家所有拍卖的平均成交价)</span></span><br><span class="line"></span><br><span class="line"># 错误示例</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  country,</span><br><span class="line">  <span class="built_in">AVG</span>(final_price)  <span class="keyword">AS</span> `avg`</span><br><span class="line"><span class="keyword">FROM</span> auction</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> country</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">AVG</span>(final_price) <span class="operator">&gt;</span> <span class="built_in">AVG</span>(final_price) <span class="keyword">OVER</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 正确写法(子查询)</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	country,</span><br><span class="line">	<span class="built_in">AVG</span>(final_price) <span class="keyword">AS</span> `avg`</span><br><span class="line"><span class="keyword">FROM</span> auction</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> country</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">AVG</span>(final_price) <span class="operator">&gt;</span> (</span><br><span class="line">	<span class="keyword">SELECT</span></span><br><span class="line">		<span class="built_in">AVG</span>(final_price)</span><br><span class="line">	<span class="keyword">FROM</span> auction</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>情况3：不能在 GROUP BY子句中使用窗口函数</strong></p>
<p>– 需求：将所有的拍卖信息按照浏览次数排序，并均匀分成4组，然后计算每组的最小和最大浏览量<br>– 查询结果字段：<br>–     quartile(分组序号)、min_views(当前组最小浏览量)、max_view(当前组最大浏览量)</p>
<p>错误示例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  <span class="built_in">NTILE</span>(<span class="number">4</span>) <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> views <span class="keyword">DESC</span>) <span class="keyword">AS</span> `quartile`,</span><br><span class="line">  <span class="built_in">MIN</span>(views) <span class="keyword">AS</span> `min_views`,</span><br><span class="line">  <span class="built_in">MAX</span>(views) <span class="keyword">AS</span> `max_views`</span><br><span class="line"><span class="keyword">FROM</span> auction</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="built_in">NTILE</span>(<span class="number">4</span>) <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> views <span class="keyword">DESC</span>);</span><br></pre></td></tr></table></figure>

<p>正确实现(子查询)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 需求：将所有的拍卖信息按照浏览次数排序，并均匀分成4组，然后计算每组的最小和最大浏览量</span></span><br><span class="line"><span class="comment">-- 查询结果字段：</span></span><br><span class="line"><span class="comment">-- 	quartile(分组序号)、min_views(当前组最小浏览量)、max_view(当前组最大浏览量)</span></span><br><span class="line"></span><br><span class="line"># 错误示例</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  <span class="built_in">NTILE</span>(<span class="number">4</span>) <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> views <span class="keyword">DESC</span>) <span class="keyword">AS</span> `quartile`,</span><br><span class="line">  <span class="built_in">MIN</span>(views) <span class="keyword">AS</span> `min_views`,</span><br><span class="line">  <span class="built_in">MAX</span>(views) <span class="keyword">AS</span> `max_views`</span><br><span class="line"><span class="keyword">FROM</span> auction</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="built_in">NTILE</span>(<span class="number">4</span>) <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> views <span class="keyword">DESC</span>);</span><br><span class="line"></span><br><span class="line"># 正确实现(子查询)</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	quartile,</span><br><span class="line">	<span class="built_in">MIN</span>(views) <span class="keyword">AS</span> `min_views`,</span><br><span class="line">	<span class="built_in">MAX</span>(views) <span class="keyword">AS</span> `max_views`</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">	<span class="keyword">SELECT</span></span><br><span class="line">		views,</span><br><span class="line">		<span class="built_in">NTILE</span>(<span class="number">4</span>) <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> views <span class="keyword">DESC</span>) <span class="keyword">AS</span> `quartile`</span><br><span class="line">	<span class="keyword">FROM</span> auction</span><br><span class="line">) c</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> quartile;</span><br></pre></td></tr></table></figure>

<h3 id="GROUP-BY和窗口函数配合使用"><a href="#GROUP-BY和窗口函数配合使用" class="headerlink" title="GROUP BY和窗口函数配合使用"></a>GROUP BY和窗口函数配合使用</h3><blockquote>
<p>GROUP BY和窗口函数配合使用时，<strong>窗口函数处理的分组聚合之后的结果</strong>，不再是原始的表数据。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 练习1</span></span><br><span class="line"><span class="comment">-- 需求：将拍卖数据按国家分组，返回如下信息</span></span><br><span class="line"><span class="comment">-- 查询结果字段：</span></span><br><span class="line"><span class="comment">-- 	country(国家)、min(每组最少参与人数)、avg(所有组最少参与人数的平均值)</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	country,</span><br><span class="line">	<span class="built_in">MIN</span>(participants) <span class="keyword">AS</span> `min`,</span><br><span class="line">	<span class="built_in">AVG</span>(<span class="built_in">MIN</span>(participants)) <span class="keyword">OVER</span>() <span class="keyword">AS</span> `avg`</span><br><span class="line"><span class="keyword">FROM</span> auction</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> country;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 下面的SQL效果等价于上面的SQL</span></span><br><span class="line"><span class="keyword">WITH</span> temp_tb <span class="keyword">AS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span></span><br><span class="line">        country,</span><br><span class="line">        <span class="built_in">MIN</span>(participants) <span class="keyword">AS</span> `min`</span><br><span class="line">    <span class="keyword">FROM</span> auction</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> country</span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	country,</span><br><span class="line">	`min`,</span><br><span class="line">	<span class="built_in">AVG</span>(`min`) <span class="keyword">OVER</span>() <span class="keyword">AS</span> `avg`</span><br><span class="line"><span class="keyword">FROM</span> temp_tb;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 排序函数使用聚合函数的结果</span></span><br><span class="line"><span class="comment">-- 练习2</span></span><br><span class="line"><span class="comment">-- 需求：按国家进行分组，计算了每个国家的拍卖次数，再根据拍卖次数对国家进行排名</span></span><br><span class="line"><span class="comment">-- 查询结果字段：</span></span><br><span class="line"><span class="comment">-- 	country(国家)、count(该国家的拍卖次数)、rank(按拍卖次数的排名)</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	country,</span><br><span class="line">	<span class="built_in">COUNT</span>(id) <span class="keyword">AS</span> `count`,</span><br><span class="line">	<span class="built_in">RANK</span>() <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="built_in">COUNT</span>(id) <span class="keyword">DESC</span>) <span class="keyword">AS</span> `rank`</span><br><span class="line"><span class="keyword">FROM</span> auction</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> country;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 对GROUP BY分组后的数据使用PARTITION BY</span></span><br><span class="line"><span class="comment">-- 练习3</span></span><br><span class="line"><span class="comment">-- 需求：将所有的数据按照国家和拍卖结束时间分组，返回如下信息</span></span><br><span class="line"><span class="comment">-- 查询结果字段：</span></span><br><span class="line"><span class="comment">-- 	country(国家)、ended(拍卖结束时间)、views_sum(该分组浏览量总和)、country_views_sum(分组聚合结果中不同国家拍卖的总浏览量)</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	country,</span><br><span class="line">	ended,</span><br><span class="line">	<span class="built_in">SUM</span>(views) <span class="keyword">AS</span> `views_sum`,</span><br><span class="line">	<span class="built_in">SUM</span>(<span class="built_in">SUM</span>(views)) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> country) <span class="keyword">AS</span> `country_views_sum`</span><br><span class="line"><span class="keyword">FROM</span> auction</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> country, ended;</span><br></pre></td></tr></table></figure>

<h2 id="SQL常用内置函数"><a href="#SQL常用内置函数" class="headerlink" title="SQL常用内置函数"></a>SQL常用内置函数</h2><h3 id="时间日期函数"><a href="#时间日期函数" class="headerlink" title="时间日期函数"></a>时间日期函数</h3><p>我们在做数据处理和开发的过程中，经常需要利用SQL在MySQL或HIVE、SPARK中使用一些SQL函数，对时间日期类型的数据进行操作。</p>
<p><strong>时间日期函数分类</strong>：</p>
<p>1）获取当前时间的函数，比如当前的年月日或时间戳</p>
<p>2）计算时间差的相关函数，比如两个日期之间相差多少天，一个日期90天后是几月几号</p>
<p>3）获取年月日的函数，从一个时间中提取具体的年份、月份</p>
<p>4）时间转换函数，比如将2021-10-05转换为时间戳</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 获取当前datetime类型的时间</span></span><br><span class="line"><span class="keyword">SELECT</span> NOW();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 计算指定间隔的时间日期</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_ADD(<span class="string">&#x27;2007-9-27&#x27;</span>, <span class="type">INTERVAL</span> <span class="number">90</span> <span class="keyword">DAY</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 示例：获取当前时间3个小时以前的时间</span></span><br><span class="line"><span class="keyword">SELECT</span> DATE_ADD(NOW(), <span class="type">INTERVAL</span> <span class="number">-3</span> <span class="keyword">HOUR</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 计算两个时间日期之间的天数差</span></span><br><span class="line"><span class="keyword">SELECT</span> DATEDIFF(<span class="string">&#x27;2021-03-22 09:00:00&#x27;</span>, <span class="string">&#x27;2018-03-20 07:00:00&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 提取时间日期中的年月日</span></span><br><span class="line"><span class="comment">-- 获取当前日期中的年份</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">YEAR</span>(NOW());</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 获取2021-10-02 09:00中月份</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MONTH</span>(<span class="string">&#x27;2021-10-02 09:00&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 获取时间日期中的日</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DAY</span>(<span class="string">&#x27;2021-10-02 09:00&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 时间戳转字符串</span></span><br><span class="line"><span class="keyword">select</span> FROM_UNIXTIME(<span class="number">1355932800</span>, <span class="string">&#x27;%Y-%m-%d %H:%i:%s&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> FROM_UNIXTIME(<span class="number">0</span>, <span class="string">&#x27;%Y-%m-%d %H:%i:%s&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h3><p>我们在做数据处理和开发的过程中，经常需要利用SQL在MySQL或HIVE、SPARK中使用一些SQL函数；和时间函数一样，也经常需要对字符串类型的数据进行处理操作。</p>
<p><strong>字符串函数分类</strong>：</p>
<p>1）大小写转换、反转</p>
<p>2）对字符串进行拼接、删除前后缀，或做局部替换</p>
<p>3）获取局部的子串，字符串的字符个数以及存储长度</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 字符串拼接</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="string">&#x27;马走日&#x27;</span>, <span class="string">&#x27;象飞田&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="number">10.15</span>, <span class="string">&#x27;%&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 从左或右截取n个字符</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LEFT</span>(<span class="string">&#x27;仙人指路，急进中兵&#x27;</span>, <span class="number">4</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">RIGHT</span>(<span class="string">&#x27;仙人指路，急进中兵&#x27;</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 指定截取范围，从第一个截取到第五个（包含第一个）</span></span><br><span class="line"><span class="keyword">SELECT</span> SUBSTR(<span class="string">&#x27;字符串&#x27;</span>,<span class="number">1</span>,<span class="number">5</span>)</span><br><span class="line"><span class="comment">-- 从第五个截取到最后</span></span><br><span class="line"><span class="keyword">SELECT</span> SUBSTR(<span class="string">&#x27;字符串&#x27;</span>,<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 指定分隔符拼接字符串</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT_WS(<span class="string">&#x27;^_^&#x27;</span>, <span class="string">&#x27;马走日&#x27;</span>, <span class="string">&#x27;象飞田&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="数学函数"><a href="#数学函数" class="headerlink" title="数学函数"></a>数学函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ROUND(X, n)：对 X 进行四舍五入，保留 n 位小数，默认n为0</span></span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">1.6</span>);</span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">1.333</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">2.689</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- MOD(X, Y)：求 X 除以 Y 的余数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MOD</span>(<span class="number">5</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MOD</span>(<span class="number">10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- FORMAT(X, n)：对 X 进行四舍五入，保留 n 位小数，以##,###,###.###格式显示</span></span><br><span class="line"><span class="keyword">SELECT</span> FORMAT(<span class="number">1001.6</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">SELECT</span> FORMAT(<span class="number">123456.333</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">SELECT</span> FORMAT(<span class="number">234567.689</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- FLOOR(x)：向下取整</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">FLOOR</span>(<span class="number">-1.5</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- CEIL(X)：向上取整</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CEIL</span>(<span class="number">2.1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- GREATEST(expr1, expr2, expr3, ...)：返回列表中的最大值</span></span><br><span class="line"><span class="keyword">SELECT</span> GREATEST(<span class="number">3</span>, <span class="number">12</span>, <span class="number">34</span>, <span class="number">8</span>, <span class="number">25</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- LEAST(expr1, expr2, expr3, ...)：返回列表中的最小值</span></span><br><span class="line"><span class="keyword">SELECT</span> LEAST(<span class="number">3</span>, <span class="number">12</span>, <span class="number">34</span>, <span class="number">8</span>, <span class="number">25</span>);</span><br></pre></td></tr></table></figure>

<h2 id="CASE-WHEN-IF语法"><a href="#CASE-WHEN-IF语法" class="headerlink" title="CASE WHEN,IF语法"></a>CASE WHEN,IF语法</h2><h3 id="简介和基本使用"><a href="#简介和基本使用" class="headerlink" title="简介和基本使用"></a>简介和基本使用</h3><p>CASE WHEN可以用于SQL查询时，进行条件判断操作。功能类似于Python中的if…elif…else判断。</p>
<p><strong>基础语法</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CASE</span><br><span class="line">	WHEN 条件1 THEN 值1</span><br><span class="line">	WHEN 条件2 THEN 值2</span><br><span class="line">	WHEN 条件3 THEN 值3</span><br><span class="line">	...</span><br><span class="line">	ELSE 值n</span><br><span class="line">END</span><br></pre></td></tr></table></figure>

<p><strong>查询示例</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 需求：查询所有学生的成绩信息，并将学生的成绩分成5个等级，查询结果中需要有一个学生的成绩等级列，</span></span><br><span class="line"><span class="comment">-- 成绩等级如下：</span></span><br><span class="line"><span class="comment">-- 优秀：90分及以上</span></span><br><span class="line"><span class="comment">-- 良好：80-90，包含80</span></span><br><span class="line"><span class="comment">-- 中等：70-80，包含70</span></span><br><span class="line"><span class="comment">-- 及格：60-70，包含60</span></span><br><span class="line"><span class="comment">-- 不及格：60分以下</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询结果字段：</span></span><br><span class="line"><span class="comment">-- 	name(姓名)、course(科目)、score(成绩)、grade(成绩等级)</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="operator">*</span>,</span><br><span class="line">    <span class="keyword">CASE</span></span><br><span class="line">        <span class="keyword">WHEN</span> score <span class="operator">&gt;=</span> <span class="number">90</span> <span class="keyword">THEN</span> <span class="string">&#x27;优秀&#x27;</span></span><br><span class="line">        <span class="keyword">WHEN</span> score <span class="operator">&gt;=</span> <span class="number">80</span> <span class="keyword">THEN</span> <span class="string">&#x27;良好&#x27;</span></span><br><span class="line">        <span class="keyword">WHEN</span> score <span class="operator">&gt;=</span> <span class="number">70</span> <span class="keyword">THEN</span> <span class="string">&#x27;中等&#x27;</span></span><br><span class="line">        <span class="keyword">WHEN</span> score <span class="operator">&gt;=</span> <span class="number">60</span> <span class="keyword">THEN</span> <span class="string">&#x27;及格&#x27;</span></span><br><span class="line">        <span class="keyword">ELSE</span> <span class="string">&#x27;不及格&#x27;</span></span><br><span class="line">    <span class="keyword">END</span> <span class="keyword">AS</span> `grade`</span><br><span class="line"><span class="keyword">FROM</span> tb_score;</span><br></pre></td></tr></table></figure>

<h3 id="CASE-WHEN配合GROUP-BY进行使用"><a href="#CASE-WHEN配合GROUP-BY进行使用" class="headerlink" title="CASE WHEN配合GROUP BY进行使用"></a>CASE WHEN配合GROUP BY进行使用</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询结果字段：</span></span><br><span class="line"><span class="comment">-- course(科目)、gte_90(该科目90分以上是学生人数)、lt_90(该科目90分以下的学生人数)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方式1</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    course,</span><br><span class="line">    <span class="built_in">COUNT</span>(<span class="keyword">CASE</span></span><br><span class="line">        <span class="keyword">WHEN</span> score <span class="operator">&gt;=</span> <span class="number">90</span> <span class="keyword">THEN</span> name</span><br><span class="line">    <span class="keyword">END</span>) <span class="keyword">AS</span> `gte_90`,</span><br><span class="line">    <span class="built_in">COUNT</span>(<span class="keyword">CASE</span></span><br><span class="line">        <span class="keyword">WHEN</span> score <span class="operator">&lt;</span> <span class="number">90</span> <span class="keyword">THEN</span> name</span><br><span class="line">    <span class="keyword">END</span>) <span class="keyword">AS</span> `lt_90`</span><br><span class="line"><span class="keyword">FROM</span> tb_score</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> course;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方式2</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    course,</span><br><span class="line">    <span class="built_in">SUM</span>(<span class="keyword">CASE</span></span><br><span class="line">        <span class="keyword">WHEN</span> score <span class="operator">&gt;=</span> <span class="number">90</span> <span class="keyword">THEN</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">ELSE</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">END</span>) <span class="keyword">AS</span> `gte_90`,</span><br><span class="line">    <span class="built_in">SUM</span>(<span class="keyword">CASE</span></span><br><span class="line">        <span class="keyword">WHEN</span> score <span class="operator">&lt;</span> <span class="number">90</span> <span class="keyword">THEN</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">ELSE</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">END</span>) <span class="keyword">AS</span> `lt_90`</span><br><span class="line"><span class="keyword">FROM</span> tb_score</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> course;</span><br></pre></td></tr></table></figure>

<h3 id="IF-语句使用"><a href="#IF-语句使用" class="headerlink" title="IF 语句使用"></a>IF 语句使用</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 语法：UPDATE 表名 SET 列名=值 [WHERE 条件];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 需求：实现一条update更新商品的价格，要求价格高于3000（包含）的降价10%，低于3000的上涨20%</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> product</span><br><span class="line"><span class="keyword">SET</span> Price<span class="operator">=</span>IF(Price <span class="operator">&gt;=</span> <span class="number">3000</span>, Price <span class="operator">*</span> <span class="number">0.9</span>, Price <span class="operator">*</span> <span class="number">1.2</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 需求：查询所有学生的成绩信息，并将学生的成绩分成5个等级，查询结果中需要有一个学生的成绩等级列，</span></span><br><span class="line"><span class="comment">-- 成绩等级如下：</span></span><br><span class="line"><span class="comment">-- 优秀：90分及以上</span></span><br><span class="line"><span class="comment">-- 良好：80-90，包含80</span></span><br><span class="line"><span class="comment">-- 中等：70-80，包含70</span></span><br><span class="line"><span class="comment">-- 及格：60-70，包含60</span></span><br><span class="line"><span class="comment">-- 不及格：60分以下</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span>,</span><br><span class="line">       IF(score <span class="operator">&gt;=</span> <span class="number">90</span>, <span class="string">&#x27;优秀&#x27;</span>,</span><br><span class="line">          IF(score <span class="operator">&gt;=</span> <span class="number">80</span>, <span class="string">&#x27;良好&#x27;</span>, IF(score <span class="operator">&gt;=</span> <span class="number">70</span>, <span class="string">&#x27;中等&#x27;</span>, IF(score <span class="operator">&gt;=</span> <span class="number">60</span>, <span class="string">&#x27;及格&#x27;</span>, <span class="string">&#x27;不及格&#x27;</span>)))) level</span><br><span class="line"><span class="keyword">FROM</span> tb_score;</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://gozei-blog.vercel.app">Gozei</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://gozei-blog.vercel.app/year/04/02/Sql%E4%BB%8E0%E5%88%B01/">https://gozei-blog.vercel.app/year/04/02/Sql%E4%BB%8E0%E5%88%B01/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://gozei-blog.vercel.app" target="_blank">Gozei's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><a class="post-meta__tags" href="/tags/mysql/">mysql</a></div><div class="post_share"><div class="social-share" data-image="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/toki.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/year/04/09/hadoop%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/" title="hadoop集群搭建"><img class="cover" src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20240416205754.jpg" onerror="onerror=null;src='/img/fa.png'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">hadoop集群搭建</div></div></a></div><div class="next-post pull-right"><a href="/year/03/27/spring%E4%BB%8E0%E5%88%B01/" title="Spring从0到1"><img class="cover" src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/mkl.jpg" onerror="onerror=null;src='/img/fa.png'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Spring从0到1</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/assert/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Gozei</div><div class="author-info__description">Hello</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Gozei"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="/2374280167lk@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2374280167&amp;site=qq&amp;menu=yes" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="https://steamcommunity.com/profiles/76561198421319454/" target="_blank" title="Steam"><i class="fa-brands fa-steam"></i></a><a class="social-icon" href="https://space.bilibili.com/356043221" target="_blank" title="Bililil"><i class="iconfont icon-bilibili-fill"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">welcome</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">MySQL数据库简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-number">2.</span> <span class="toc-text">MySQL客户端连接服务端</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.</span> <span class="toc-text">SQL语句</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFsql%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.1.</span> <span class="toc-text">什么是sql语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E8%AF%AD%E5%8F%A5%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">3.2.</span> <span class="toc-text">SQL语句的分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DDL%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89%E8%AF%AD%E8%A8%80-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="toc-number">3.2.1.</span> <span class="toc-text">DDL数据定义语言-数据库操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DDL%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89%E8%AF%AD%E8%A8%80-%E6%95%B0%E6%8D%AE%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">3.2.2.</span> <span class="toc-text">DDL数据定义语言-数据表操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DDL%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89%E8%AF%AD%E8%A8%80-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%92%8C%E7%BA%A6%E6%9D%9F"><span class="toc-number">3.2.3.</span> <span class="toc-text">DDL数据定义语言-数据类型和约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DDL%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89%E8%AF%AD%E8%A8%80-%E6%95%B0%E6%8D%AE%E7%BA%A6%E6%9D%9F%E8%BF%9B%E9%98%B6"><span class="toc-number">3.2.4.</span> <span class="toc-text">DDL数据定义语言-数据约束进阶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DDL%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89%E8%AF%AD%E8%A8%80-%E6%95%B0%E6%8D%AE%E8%A1%A8%E5%AD%97%E6%AE%B5%E6%93%8D%E4%BD%9C"><span class="toc-number">3.2.5.</span> <span class="toc-text">DDL数据定义语言-数据表字段操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DML%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%E8%AF%AD%E8%A8%80-%E8%A1%A8%E8%AE%B0%E5%BD%95%E5%A2%9E%E3%80%81%E6%94%B9%E3%80%81%E5%88%A0"><span class="toc-number">3.2.6.</span> <span class="toc-text">DML数据操作语言-表记录增、改、删</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DQL%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80-%E7%AE%80%E5%8D%95%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.2.7.</span> <span class="toc-text">DQL数据查询语言-简单查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DQL%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80-%E6%8E%92%E5%BA%8F%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.2.8.</span> <span class="toc-text">DQL数据查询语言-排序查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DQL%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80-%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="toc-number">3.2.9.</span> <span class="toc-text">DQL数据查询语言-聚合函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DQL%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80-%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.2.10.</span> <span class="toc-text">DQL数据查询语言-分组查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DQL%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80-%E5%8E%BB%E9%87%8D%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.2.11.</span> <span class="toc-text">DQL数据查询语言-去重查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DQL%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80-%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.2.12.</span> <span class="toc-text">DQL数据查询语言-分页查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E5%A4%8D%E6%9D%82%E8%AF%AD%E5%8F%A5%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.3.</span> <span class="toc-text">SQL复杂语句查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2-%E8%A1%A8%E4%B9%8B%E9%97%B4%E7%9A%843%E7%A7%8D%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB%E3%80%91"><span class="toc-number">3.3.1.</span> <span class="toc-text">多表关联查询-表之间的3种关联关系】</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2-%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">3.3.2.</span> <span class="toc-text">多表关联查询-外键约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2-%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2%E6%93%8D%E4%BD%9C"><span class="toc-number">3.3.3.</span> <span class="toc-text">多表关联查询-关联查询操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL%E6%9F%A5%E8%AF%A2%E6%97%B6%E4%BD%BF%E7%94%A8AS%E5%85%B3%E9%94%AE%E5%AD%97%E8%B5%B7%E5%88%AB%E5%90%8D"><span class="toc-number">3.3.4.</span> <span class="toc-text">SQL查询时使用AS关键字起别名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2-%E8%87%AA%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.3.5.</span> <span class="toc-text">多表关联查询-自关联查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL%E5%AD%90%E6%9F%A5%E8%AF%A2%E6%93%8D%E4%BD%9C"><span class="toc-number">3.3.6.</span> <span class="toc-text">SQL子查询操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0%E7%AE%80%E4%BB%8B"><span class="toc-number">3.3.7.</span> <span class="toc-text">SQL窗口函数简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0-%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-number">3.3.8.</span> <span class="toc-text">窗口函数-基本用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0-PARTITION-BY%E5%88%86%E5%8C%BA"><span class="toc-number">3.3.9.</span> <span class="toc-text">窗口函数-PARTITION BY分区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0-%E6%8E%92%E5%90%8D%E5%87%BD%E6%95%B0%E4%BD%BF%E7%94%A8"><span class="toc-number">3.3.10.</span> <span class="toc-text">窗口函数-排名函数使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0-%E8%87%AA%E5%AE%9A%E4%B9%89-window-frame"><span class="toc-number">3.3.11.</span> <span class="toc-text">窗口函数-自定义 window frame</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="toc-number">3.3.12.</span> <span class="toc-text">SQL语句的执行顺序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E8%83%BD%E4%BD%BF%E7%94%A8%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0%E7%9A%843%E7%A7%8D%E6%83%85%E5%86%B5"><span class="toc-number">3.3.13.</span> <span class="toc-text">不能使用窗口函数的3种情况</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GROUP-BY%E5%92%8C%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0%E9%85%8D%E5%90%88%E4%BD%BF%E7%94%A8"><span class="toc-number">3.3.14.</span> <span class="toc-text">GROUP BY和窗口函数配合使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E5%B8%B8%E7%94%A8%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0"><span class="toc-number">3.4.</span> <span class="toc-text">SQL常用内置函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="toc-number">3.4.1.</span> <span class="toc-text">时间日期函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="toc-number">3.4.2.</span> <span class="toc-text">字符串函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E5%AD%A6%E5%87%BD%E6%95%B0"><span class="toc-number">3.4.3.</span> <span class="toc-text">数学函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CASE-WHEN-IF%E8%AF%AD%E6%B3%95"><span class="toc-number">3.5.</span> <span class="toc-text">CASE WHEN,IF语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B%E5%92%8C%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">3.5.1.</span> <span class="toc-text">简介和基本使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CASE-WHEN%E9%85%8D%E5%90%88GROUP-BY%E8%BF%9B%E8%A1%8C%E4%BD%BF%E7%94%A8"><span class="toc-number">3.5.2.</span> <span class="toc-text">CASE WHEN配合GROUP BY进行使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IF-%E8%AF%AD%E5%8F%A5%E4%BD%BF%E7%94%A8"><span class="toc-number">3.5.3.</span> <span class="toc-text">IF 语句使用</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/year/04/09/hadoop%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/" title="hadoop集群搭建"><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20240416205754.jpg" onerror="this.onerror=null;this.src='/img/fa.png'" alt="hadoop集群搭建"/></a><div class="content"><a class="title" href="/year/04/09/hadoop%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/" title="hadoop集群搭建">hadoop集群搭建</a><time datetime="2024-04-09T14:23:12.000Z" title="发表于 2024-04-09 22:23:12">2024-04-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/year/04/02/Sql%E4%BB%8E0%E5%88%B01/" title="Sql从0到1"><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/toki.jpg" onerror="this.onerror=null;this.src='/img/fa.png'" alt="Sql从0到1"/></a><div class="content"><a class="title" href="/year/04/02/Sql%E4%BB%8E0%E5%88%B01/" title="Sql从0到1">Sql从0到1</a><time datetime="2024-04-02T05:23:12.000Z" title="发表于 2024-04-02 13:23:12">2024-04-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/year/03/27/spring%E4%BB%8E0%E5%88%B01/" title="Spring从0到1"><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/mkl.jpg" onerror="this.onerror=null;this.src='/img/fa.png'" alt="Spring从0到1"/></a><div class="content"><a class="title" href="/year/03/27/spring%E4%BB%8E0%E5%88%B01/" title="Spring从0到1">Spring从0到1</a><time datetime="2024-03-27T06:23:12.000Z" title="发表于 2024-03-27 14:23:12">2024-03-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/year/03/19/Java%E7%9A%84lambda/" title="Java的lambda"><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/2222.jpg" onerror="this.onerror=null;this.src='/img/fa.png'" alt="Java的lambda"/></a><div class="content"><a class="title" href="/year/03/19/Java%E7%9A%84lambda/" title="Java的lambda">Java的lambda</a><time datetime="2024-03-19T06:23:12.000Z" title="发表于 2024-03-19 14:23:12">2024-03-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/year/02/11/Maven%E4%BB%8E0%E5%88%B01/" title="maven从0到1"><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/C623B5C09ECB47E351398616E61B8991.jpg" onerror="this.onerror=null;this.src='/img/fa.png'" alt="maven从0到1"/></a><div class="content"><a class="title" href="/year/02/11/Maven%E4%BB%8E0%E5%88%B01/" title="maven从0到1">maven从0到1</a><time datetime="2024-02-11T05:23:12.000Z" title="发表于 2024-02-11 13:23:12">2024-02-11</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By Gozei</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>