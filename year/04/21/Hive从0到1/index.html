<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>hive从0到1 | Gozei's Blog</title><meta name="author" content="Gozei"><meta name="copyright" content="Gozei"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Hive入门官方wikiHome - Apache Hive - Apache Software Foundation SQL、Hive和MapReduce的关系MapReduce：分布式计算框架。 Hive：MapReduce的客户端。这种客户端可以运行用户直接编写SQL语句（而不是写MapReduce代码），Hive可以把这种SQL转换为MapReduce代码来执行，从而提升了开发效率。 也就">
<meta property="og:type" content="article">
<meta property="og:title" content="hive从0到1">
<meta property="og:url" content="https://gozei-blog.vercel.app/year/04/21/Hive%E4%BB%8E0%E5%88%B01/index.html">
<meta property="og:site_name" content="Gozei&#39;s Blog">
<meta property="og:description" content="Hive入门官方wikiHome - Apache Hive - Apache Software Foundation SQL、Hive和MapReduce的关系MapReduce：分布式计算框架。 Hive：MapReduce的客户端。这种客户端可以运行用户直接编写SQL语句（而不是写MapReduce代码），Hive可以把这种SQL转换为MapReduce代码来执行，从而提升了开发效率。 也就">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20240607210642.jpg">
<meta property="article:published_time" content="2024-04-21T12:23:12.000Z">
<meta property="article:modified_time" content="2024-06-07T13:08:10.000Z">
<meta property="article:author" content="Gozei">
<meta property="article:tag" content="bigdata">
<meta property="article:tag" content="hive">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20240607210642.jpg"><link rel="shortcut icon" href="/img/fa.png"><link rel="canonical" href="https://gozei-blog.vercel.app/year/04/21/Hive%E4%BB%8E0%E5%88%B01/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'hive从0到1',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-06-07 21:08:10'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/assert/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20240607210642.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Gozei's Blog"><span class="site-name">Gozei's Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">hive从0到1</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-04-21T12:23:12.000Z" title="发表于 2024-04-21 20:23:12">2024-04-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-06-07T13:08:10.000Z" title="更新于 2024-06-07 21:08:10">2024-06-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%99%E7%A8%8B/">教程</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%99%E7%A8%8B/%E4%BB%8E0%E5%88%B01/">从0到1</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">10.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>39分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="hive从0到1"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Hive入门"><a href="#Hive入门" class="headerlink" title="Hive入门"></a>Hive入门</h1><p>官方wiki<a target="_blank" rel="noopener" href="https://cwiki.apache.org/confluence/display/Hive/">Home - Apache Hive - Apache Software Foundation</a></p>
<h2 id="SQL、Hive和MapReduce的关系"><a href="#SQL、Hive和MapReduce的关系" class="headerlink" title="SQL、Hive和MapReduce的关系"></a>SQL、Hive和MapReduce的关系</h2><p>MapReduce：分布式计算框架。</p>
<p>Hive：MapReduce的客户端。这种客户端可以运行用户直接编写SQL语句（而不是写MapReduce代码），Hive可以把这种SQL转换为MapReduce代码来执行，从而提升了开发效率。</p>
<p>也就是说，如果没有Hive，用户只能写MapReduce代码来开发了。这样开发效率就会大大降低。</p>
<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240412201614101.png" alt="image-20240412201614101"></p>
<p>结论：用户在Hive上编写SQL语句，Hive把SQL语句转为MapReduce程序去执行。</p>
<h2 id="Hive架构映射流程"><a href="#Hive架构映射流程" class="headerlink" title="Hive架构映射流程"></a>Hive架构映射流程</h2><p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240412201651352.png" alt="image-20240412201651352"></p>
<ol>
<li>用户接口</li>
</ol>
<p>包括 CLI、JDBC/ODBC、WebGUI。其中，CLI(command line interface)为shell命令行；<br>Hive中的Thrift服务器允许外部客户端通过网络与Hive进行交互，类似于JDBC或ODBC协议。WebGUI是通过浏览器访问Hive。<br>Hive提供了 Hive Shell、 ThriftServer等服务进程向用户提供操作接口</p>
<ol start="2">
<li>Driver</li>
</ol>
<p>Driver包括语法解析器、计划编译器、优化器、执行器<br>作用：完成HQL查询语句从词法分析、语法分析、编译、优化以及查询计划的生成。<br>生成的查询计划存储在HDFS中，并在随后有MapReduce调用执行。<br>注意：这部分内容不是具体的服务进程，而是封装在Hive所依赖的Jar包中Java代码中。</p>
<ol start="3">
<li>元数据</li>
</ol>
<p>元数据包含：用Hive创建的database、table、表的字段等元信息。<br>元数据存储：存在关系型数据库中。如：hive内置的Derby数据库或者第三方MySQL数据库等，一般使用MySQL数据库。</p>
<ol start="4">
<li>metastore</li>
</ol>
<p>Metastore：即元数据存储服务，<br>作用：客户端连接metastore服务，metastore再去连接MySQL等数据库来存取元数据。<br>特点：有了metastore服务，就可以有多个客户端同时连接，而且这些客户端不需要知道MySQL等数据库的用户名和密码，只需要连接metastore 服务即可。</p>
<h2 id="MetaStore元数据管理三种模式"><a href="#MetaStore元数据管理三种模式" class="headerlink" title="MetaStore元数据管理三种模式"></a>MetaStore元数据管理三种模式</h2><p>metastore服务配置有3种模式: <strong>内嵌模式、本地模式、远程模式</strong></p>
<p><strong>推荐使用: 远程模式</strong></p>
<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240412201920942.png" alt="image-20240412201920942"></p>
<ol>
<li><p>内嵌模式<br>优点: 配置简单 hive命令直接可以使用<br>缺点: 不适用于生产环境,derby和Metastore服务都嵌入在主Hive Server进程中,一个服务只能被一个客户端连接(如果用两个客户端以上就非常浪费资源),且元数据不能共享</p>
</li>
<li><p>本地模式<br>优点：可以单独使用外部的数据库(mysql),元数据共享<br>缺点：相对浪费资源,metastore嵌入到了hive进程中,每启动一次hive服务，都内置启动了一个metastore。</p>
</li>
<li><p>远程模式<br>优点：可以单独使用外部库(mysql),可以共享元数据,本地可以连接metastore服务也可以连接hiveserver2服务,增加了扩展性(其他依赖hive的软件都可以通过Metastore访问hive)<br>缺点：需要注意的是如果想要启动hiveserver2服务需要先启动metastore服务</p>
</li>
</ol>
<h2 id="Hive服务操作"><a href="#Hive服务操作" class="headerlink" title="Hive服务操作"></a>Hive服务操作</h2><p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240412202613088.png" alt="image-20240412202613088"></p>
<h3 id="启动Hive服务"><a href="#启动Hive服务" class="headerlink" title="启动Hive服务"></a>启动Hive服务</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#0.切换路径</span></span><br><span class="line"><span class="built_in">cd</span> /export/server/hive</span><br><span class="line"></span><br><span class="line"><span class="comment">#1.启动metastore服务</span></span><br><span class="line"><span class="built_in">nohup</span> bin/hive --service metastore &amp;</span><br><span class="line"><span class="built_in">nohup</span> bin/hive --service metastore &gt; /tmp/hive-metastore.log &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.启动Hiveserver2服务</span></span><br><span class="line"><span class="built_in">nohup</span> bin/hive --service hiveserver2 &amp;</span><br><span class="line"><span class="built_in">nohup</span> bin/hive --service hiveserver2 &gt; /tmp/hive-hiveserver2.<span class="built_in">log</span> &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.校验Hive是否启动</span></span><br><span class="line">jps</span><br><span class="line"></span><br><span class="line"><span class="comment">#注意</span></span><br><span class="line">Hiveserver2服务的启动需要等待一段时间，也就是说，虽然上述jps命令校验能看到进程，但是不代表Hiveserver2就启动成功了。</span><br><span class="line">要想确保Hiveserver2已经启动OK，最稳妥的办法就是查看端口是否占用。</span><br><span class="line">metastore服务，如果正常运行，会占用9083端口，而Hiveserver2服务，如果正常运行，会占用10000端口。</span><br><span class="line">因此，也可以通过命令来校验这2个端口是否被占用，来进一步判断Hive是否启动OK。</span><br><span class="line">netstat -naltp | grep 9083</span><br><span class="line">netstat -naltp | grep 10000</span><br></pre></td></tr></table></figure>

<p>端口校验metastore服务：</p>
<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240412202635326.png" alt="image-20240412202635326"></p>
<p>端口校验Hiveserver2服务：</p>
<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240412202643979.png" alt="image-20240412202643979"></p>
<h3 id="关闭Hive服务"><a href="#关闭Hive服务" class="headerlink" title="关闭Hive服务"></a>关闭Hive服务</h3><p>Hive的关闭，没有提供优雅关闭命令，只能通过<code>kill -9</code>的方式杀死进程。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">1.找到Hive进程，进程名为RunJar</span></span><br><span class="line">jps</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">2.杀死Hive进程</span></span><br><span class="line">kill -9 进程号</span><br></pre></td></tr></table></figure>

<h3 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h3><p>编辑<code>/etc/profile</code>文件，添加如下配置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">HIVE_HOME</span></span><br><span class="line">export HIVE_HOME=/export/server/apache-hive-3.1.2-bin #你的hive/bin路径</span><br><span class="line">export PATH=$PATH:$HIVE_HOME/bin:$HIVE_HOME/sbin</span><br></pre></td></tr></table></figure>

<p>保存退出，然后source /etc/profile一下即可在任何地方访问Hive。</p>
<h2 id="客户端连接"><a href="#客户端连接" class="headerlink" title="客户端连接"></a>客户端连接</h2><h3 id="第一代客户端连接Hive"><a href="#第一代客户端连接Hive" class="headerlink" title="第一代客户端连接Hive"></a>第一代客户端连接Hive</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.切换路径</span></span><br><span class="line"><span class="built_in">cd</span> /export/server/hive</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.连接Hive</span></span><br><span class="line">bin/hive</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.输入Hive命令（和MySQL类似）</span></span><br><span class="line">show databases;</span><br><span class="line"></span><br><span class="line"><span class="comment">#4.退出Hive</span></span><br><span class="line"><span class="built_in">exit</span>; 或者 quit;</span><br></pre></td></tr></table></figure>

<p><strong>注意：第一代客户端连接Hive，只需要保证metastore服务启动即可</strong>。</p>
<h3 id="第二代客户端连接Hive"><a href="#第二代客户端连接Hive" class="headerlink" title="第二代客户端连接Hive"></a>第二代客户端连接Hive</h3><p><a target="_blank" rel="noopener" href="https://cwiki.apache.org/confluence/display/Hive/HiveServer2+Clients">HiveServer2 Clients - Apache Hive - Apache Software Foundation</a>,通过beeline连接HiveServer2</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.切换路径</span></span><br><span class="line"><span class="built_in">cd</span> /export/server/hive</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.连接Hive</span></span><br><span class="line">bin/beeline</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.输入连接串</span></span><br><span class="line">!connect jdbc:hive2://node1:10000</span><br><span class="line"></span><br><span class="line"><span class="comment">#4.输入用户名和密码</span></span><br><span class="line">用户名：root</span><br><span class="line">密码：无</span><br><span class="line"></span><br><span class="line"><span class="comment">#5.输入Hive命令（和MySQL类似）</span></span><br><span class="line">show databases;</span><br><span class="line"></span><br><span class="line"><span class="comment">#6.退出Hive</span></span><br><span class="line">:quit 或 :<span class="built_in">exit</span></span><br></pre></td></tr></table></figure>

<p><strong>注意：第二代客户端连接Hive，需要保证metastore服务和hiveserver2服务都启动才行。</strong></p>
<h3 id="第三方SQL客户端工具连接Hive服务"><a href="#第三方SQL客户端工具连接Hive服务" class="headerlink" title="第三方SQL客户端工具连接Hive服务"></a>第三方SQL客户端工具连接Hive服务</h3><p>第三方SQL客户端工具非常多，比如DataGrip，DBeaver等。在这里，我们可以使用业绩非常流行的DataGrip工具来连接Hive。</p>
<p>创建连接Hive</p>
<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240412202925579.png" alt="image-20240412202925579"></p>
<p>填写连接信息</p>
<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240412202940433.png" alt="image-20240412202940433"></p>
<p>配置驱动jar包</p>
<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240412203009960.png" alt="image-20240412203009960"></p>
<p>删除默认的Jar，点击<code>+</code>号配置驱动Jar，如下图：</p>
<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240412203029135.png" alt="image-20240412203029135"></p>
<p>配置完后，如下图所示：</p>
<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240412203311750.png" alt="image-20240412203311750"></p>
<p>测试连接</p>
<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240412203326761.png" alt="image-20240412203326761"></p>
<p>点击<code>Apply</code>，点击<code>OK</code>，到此，DataGrip连接Hive完成。</p>
<h2 id="简单操作一下"><a href="#简单操作一下" class="headerlink" title="简单操作一下"></a>简单操作一下</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">--创建表</span><br><span class="line">create table test(id int, name string, gender string);</span><br><span class="line"></span><br><span class="line">--插入数据,官方不建议这样插入数据所以会有一个小报错不要管，后面会用load来插入大量数据</span><br><span class="line">insert into test values(1, ‘王力红’, ‘男’), (2, ‘周杰轮’, ‘男’), (3, ‘林志灵’, ‘女’);</span><br><span class="line"></span><br><span class="line">--查询数据</span><br><span class="line">select gender, count(*) as cnt from test group by gender;</span><br><span class="line"></span><br><span class="line">---验证Hive的数据存储位置,数据存储在HDFS上，默认路径是：/user/hive/warehouse</span><br><span class="line"></span><br><span class="line">--验证SQL启动的MapReduce任务,打开YARN的WebUI，http://node1:8088，即可查看任务的运行情况</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="Hive表操作"><a href="#Hive表操作" class="headerlink" title="Hive表操作"></a>Hive表操作</h1><h2 id="Hive的内-外表创建"><a href="#Hive的内-外表创建" class="headerlink" title="Hive的内,外表创建"></a>Hive的内,外表创建</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> [<span class="keyword">external</span>] <span class="keyword">table</span> [if <span class="keyword">not</span> <span class="keyword">exists</span>] 表名(字段名 字段类型 , 字段名 字段类型 , ... ) #默认下是内部部，不加<span class="keyword">external</span>关键字</span><br><span class="line">[partitioned <span class="keyword">by</span> (分区字段名 分区字段类型)] #分区表固定格式</span><br><span class="line">[clustered <span class="keyword">by</span> (分桶字段名)  <span class="keyword">into</span> 桶个数 buckets]  #分桶表固定格式 注意: 可以排序[sorted <span class="keyword">by</span> (排序字段名 <span class="keyword">asc</span><span class="operator">|</span><span class="keyword">desc</span>)]</span><br><span class="line">[<span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;字段分隔符&#x27;</span>] #自定义字段分隔符固定格式</span><br><span class="line">[stored <span class="keyword">as</span> textfile]  #默认即可</span><br><span class="line">[location <span class="string">&#x27;hdfs://域名:8020/user/hive/warehouse/库名.db/表名&#x27;</span>] #默认即可</span><br><span class="line">; #注意: 最后一定加分号结尾</span><br><span class="line"></span><br><span class="line">#注意: 关键字顺序是从上到下从左到右，否则报错</span><br><span class="line">#<span class="keyword">default</span>默认库存储路径:  <span class="operator">/</span><span class="keyword">user</span><span class="operator">/</span>hive<span class="operator">/</span>warehouse   </span><br><span class="line">#自定义库在HDFS的默认存储路径:	<span class="operator">/</span><span class="keyword">user</span><span class="operator">/</span>hive<span class="operator">/</span>warehouse<span class="operator">/</span>库名.db</span><br><span class="line">#自定义表在HDFS的默认存储路径:	<span class="operator">/</span><span class="keyword">user</span><span class="operator">/</span>hive<span class="operator">/</span>warehouse<span class="operator">/</span>库名.db<span class="operator">/</span>表名</span><br><span class="line">#业务数据文件在HDFS的默认存储路径:	<span class="operator">/</span><span class="keyword">user</span><span class="operator">/</span>hive<span class="operator">/</span>warehouse<span class="operator">/</span>库名.db<span class="operator">/</span>表名<span class="operator">/</span>数据文件</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><ol>
<li><p><strong>基本数据类型</strong><br>整数：int<br>小数：float double<br>字符串：string varchar(长度)<br>日期：date timestamp</p>
</li>
<li><p><strong>复杂数据类型（很少使用）</strong><br>集合：array<br>映射：map<br>结构体：struct<br>联合体：union（不成熟，基本不用）</p>
</li>
</ol>
<h2 id="表分类"><a href="#表分类" class="headerlink" title="表分类"></a>表分类</h2><p>Hive中的表，可以分为两类：内部表和外部表。</p>
<ol>
<li><p><strong>内部表(管理表)</strong><br>又称为MANAGED_TABLE（管理表），它可以创建分区表或者分桶表。</p>
</li>
<li><p><strong>外部表</strong><br>也可以称为非管理表：EXTERNAL_TABLE，它同样可以创建分区表或者分桶表。</p>
</li>
<li><p><strong>区别</strong></p>
<p>内部表：未被external关键字修饰的即是内部表， 即普通表。 内部表又称管理表,还可以叫托管表<br>删除内部表:直接删除元数据（metadata）和存储数据本身外部表：被external关键字修饰的即是外部表， 即关联表。 还可以叫非管理表或非托管表<br>删除外部表:仅仅是删除元数据（metadata），不会删除存储数据本身</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">-- 内部表(又叫管理表或者托管表)</span><br><span class="line">create table stu1(</span><br><span class="line">    id int,</span><br><span class="line">    name string</span><br><span class="line">);</span><br><span class="line">-- 外部表(又叫非管理表,非托管表)</span><br><span class="line">create external table stu2(</span><br><span class="line">    id int,</span><br><span class="line">    name string</span><br><span class="line">);</span><br><span class="line">-- 查看表结构</span><br><span class="line">desc stu1;</span><br><span class="line">desc stu2;</span><br><span class="line">-- 查看表格式化信息</span><br><span class="line">desc formatted stu1; -- 内部表类型: managed_table</span><br><span class="line">desc formatted stu2; -- 外部表类型: external_table</span><br><span class="line"></span><br><span class="line">-- 演示内外部表的重点区别</span><br><span class="line">-- 删除内部表(管理表/托管表),会删除表相关的所有数据</span><br><span class="line">insert into stu1 values(1,&#x27;张三&#x27;);</span><br><span class="line">drop table stu1;</span><br><span class="line">-- 删除外部表,只删除了元数据,hdfs中业务数据保留</span><br><span class="line">insert into stu2 values(1,&#x27;张三&#x27;);</span><br><span class="line">drop table stu2;</span><br><span class="line">-- 再次建表后,可以使用location重新关联原来hdfs保留的业务数据</span><br><span class="line">create external table stu22(</span><br><span class="line">    id int,</span><br><span class="line">    name string</span><br><span class="line">)location &#x27;/user/hive/warehouse/hive1.db/stu2&#x27;;</span><br><span class="line">-- 验证数据</span><br><span class="line">select * from stu22 limit 10;</span><br></pre></td></tr></table></figure>

<h2 id="查看-修改表"><a href="#查看-修改表" class="headerlink" title="查看/修改表"></a>查看/修改表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#查看所有表</span><br><span class="line"><span class="keyword">show</span> tables;</span><br><span class="line"></span><br><span class="line">#查看建表语句</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> 表名;</span><br><span class="line"></span><br><span class="line">#查看表结构信息</span><br><span class="line"><span class="keyword">desc</span> 表名; </span><br><span class="line"></span><br><span class="line">#查看表格式化信息</span><br><span class="line"><span class="keyword">desc</span> formatted 表名;</span><br><span class="line">formatted能够展示详细信息</span><br><span class="line"></span><br><span class="line">#修改表名</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 旧表名 rename <span class="keyword">to</span> 新表名</span><br><span class="line"></span><br><span class="line">#字段的添加</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">add</span> columns (字段名 字段类型);</span><br><span class="line"></span><br><span class="line">#字段的替换</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 replace columns (字段名 字段类型 , ...);</span><br><span class="line"></span><br><span class="line">#字段名和字段类型同时修改</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 change 旧字段名 新字段名 新字段类型;</span><br><span class="line">字符串类型不能直接改数值类型</span><br><span class="line">	</span><br><span class="line">#修改表路径</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">set</span> location <span class="string">&#x27;hdfs中存储路径&#x27;</span>;</span><br><span class="line">建议使用默认路径。</span><br><span class="line">location有默认路径<span class="operator">/</span><span class="keyword">user</span><span class="operator">/</span>hive<span class="operator">/</span>warehouse<span class="operator">/</span>库名.db<span class="operator">/</span>表名。当然建表的时候也可以直接指定路径</span><br><span class="line"></span><br><span class="line">#修改表属性</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">set</span> tblproperties (<span class="string">&#x27;属性名&#x27;</span><span class="operator">=</span><span class="string">&#x27;属性值&#x27;</span>);     注意: 经常用于内外部表切换</span><br><span class="line"></span><br><span class="line">#内外部表类型切换</span><br><span class="line">外部表属性：<span class="string">&#x27;EXTERNAL&#x27;</span><span class="operator">=</span><span class="string">&#x27;TRUE&#x27;</span></span><br><span class="line">内部表属性：<span class="string">&#x27;EXTERNAL&#x27;</span><span class="operator">=</span><span class="string">&#x27;FALSE&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="分隔符"><a href="#分隔符" class="headerlink" title="分隔符"></a>分隔符</h2><p>创建表的时候，如果不指定分隔符，以后表只能识别默认的分隔符，键盘不好打印，展示形式一般为:\0001,SOH,^A,□</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 默认分隔符: 创建表的时候不指定就代表使用默认分隔符</span></span><br><span class="line"><span class="comment">-- 1.创建表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> stu(</span><br><span class="line">    id <span class="type">int</span>,</span><br><span class="line">    name string</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- insert方式插入数据,会自动使用默认分隔符把数据连接起来</span></span><br><span class="line"><span class="comment">-- 2.插入数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> stu <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;zhangsan&#x27;</span>);</span><br><span class="line"><span class="comment">-- 3.验证数据</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> stu limit <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 当然也可以通过在hdfs中查看,默认分隔符是\0001,其他工具中也会展示为SOH,^A,口</span></span><br></pre></td></tr></table></figure>

<h3 id="快速映射表"><a href="#快速映射表" class="headerlink" title="快速映射表"></a>快速映射表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">创建表的时候指定分隔符: <span class="keyword">create</span> [<span class="keyword">external</span>] <span class="keyword">table</span> 表名(字段名 字段类型)<span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> 符号;</span><br><span class="line"></span><br><span class="line">加载数据: load data [<span class="keyword">local</span>] inpath <span class="string">&#x27;结构化数据文件&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> 表名;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> products(</span><br><span class="line">    id <span class="type">int</span>,</span><br><span class="line">    name string,</span><br><span class="line">    price <span class="keyword">double</span>,</span><br><span class="line">    cid string</span><br><span class="line">)<span class="type">row</span> format delimited</span><br><span class="line">fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span>;</span><br><span class="line"><span class="comment">-- 加载数据</span></span><br><span class="line"><span class="comment">-- 注意: 如果从hdfs中加载文件,本质就是移动文件到对应表路径下</span></span><br><span class="line">load data inpath <span class="string">&#x27;/source/products.txt&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> products;</span><br><span class="line"><span class="comment">-- 验证数据</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> products limit <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h3 id="hvie的SerDe机制"><a href="#hvie的SerDe机制" class="headerlink" title="hvie的SerDe机制"></a>hvie的SerDe机制</h3><p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240416194628161.png" alt="image-20240416194628161"></p>
<p>其中ROW FORMAT是语法关键字，DELIMITED和SERDE二选其一。</p>
<p>如果使用delimited: 表示底层默认使用的Serde类:LazySimpleSerDe类来处理数据。<br>如果使用serde:表示指定其他的Serde类来处理数据,支持用户自定义SerDe类。</p>
<h4 id="Delimited"><a href="#Delimited" class="headerlink" title="Delimited"></a>Delimited</h4><p>Hive默认的序列化类: LazySimpleSerDe<br>包含4种子语法，分别用于指定字段之间、集合元素之间、map映射 kv之间、换行的分隔符号。<br>在建表的时候可以根据数据的类型特点灵活搭配使用。<br>COLLECTION ITEMS TERMINATED BY ‘分隔符’ : 指定集合类型（array）/结构类型(struct)元素的分隔符<br>MAP KEYS TERMINATED BY ‘分隔符’ : 表示映射类型(map)键值对之间用的分隔</p>
<h4 id="SERDE"><a href="#SERDE" class="headerlink" title="SERDE"></a>SERDE</h4><p>serde给用户提供了自定义分隔符的功能，具体细节给出官网。<a target="_blank" rel="noopener" href="https://cwiki.apache.org/confluence/display/Hive/SerDe">SerDe - Apache Hive - Apache Software Foundation</a></p>
<p>这里仅仅介绍正则序列化</p>
<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240416195342147.png" alt="image-20240416195342147"></p>
<p>load数据</p>
<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/5089c4ac8fe08d7ca614042d366c16c.png" alt="5089c4ac8fe08d7ca614042d366c16c"></p>
<p>可以看出如果这里用”-“分割，那么后面的时间字段就会被分割成三个。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 采用正则解决</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> my_table</span><br><span class="line">(</span><br><span class="line">    id          STRING,</span><br><span class="line">    code        STRING,</span><br><span class="line">    BORROW_DATE STRING</span><br><span class="line">)</span><br><span class="line">    <span class="type">ROW</span> FORMAT SERDE <span class="string">&#x27;org.apache.hadoop.hive.serde2.RegexSerDe&#x27;</span></span><br><span class="line">        <span class="keyword">WITH</span> SERDEPROPERTIES (</span><br><span class="line">        &quot;input.regex&quot; <span class="operator">=</span> &quot;(\\d+)-(\\d+)-(\\d+-\\d+-\\d+)&quot; # 每个括号代表一个取值字段</span><br><span class="line">        )</span><br><span class="line">    STORED <span class="keyword">AS</span> TEXTFILE;</span><br><span class="line"></span><br><span class="line">load data <span class="keyword">local</span> inpath <span class="string">&#x27;/home/lk_1/borrow_log.txt&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> my_table;</span><br></pre></td></tr></table></figure>

<p>在如果你想以多字符来当分割符，那么也可以采用正则。又或者使用多分隔符序列化类来</p>
<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240416200415215.png" alt="image-20240416200415215"></p>
<p>‘org.apache.hadoop.hive.contrib.serde2.MultiDelimitSerDe’</p>
<h2 id="文件数据导入"><a href="#文件数据导入" class="headerlink" title="文件数据导入"></a>文件数据导入</h2><h3 id="load导入数据到hive表"><a href="#load导入数据到hive表" class="headerlink" title="load导入数据到hive表"></a>load导入数据到hive表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>从HDFS上传文件到对应路径</span><br><span class="line">load data inpath <span class="string">&#x27;HDFS文件路径&#x27;</span> [overwrite] <span class="keyword">into</span> <span class="keyword">table</span> 表名;</span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>从linux本地上传到表对应存储路径</span><br><span class="line">load data <span class="keyword">local</span> inpath <span class="string">&#x27;Linux文件路径&#x27;</span> [overwrite] <span class="keyword">into</span> <span class="keyword">table</span> 表名;</span><br></pre></td></tr></table></figure>

<h3 id="insert插入数据"><a href="#insert插入数据" class="headerlink" title="insert插入数据"></a>insert插入数据</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#从其他表查询数据<span class="string">&#x27;追加&#x27;</span>插入到当前表中: </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> [<span class="keyword">table</span>] 表名 <span class="keyword">select</span> 语句;</span><br><span class="line"></span><br><span class="line">#从其他表查询数据<span class="string">&#x27;覆盖&#x27;</span>插入到当前表中: </span><br><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">table</span> 表名 <span class="keyword">select</span> 语句;</span><br></pre></td></tr></table></figure>

<h2 id="文件数据导出"><a href="#文件数据导出" class="headerlink" title="文件数据导出"></a>文件数据导出</h2><h3 id="直接下载文件"><a href="#直接下载文件" class="headerlink" title="直接下载文件"></a>直接下载文件</h3><p>web页面下载</p>
<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240416191418070.png" alt="image-20240416191418070"></p>
<h3 id="get命令下载文件"><a href="#get命令下载文件" class="headerlink" title="get命令下载文件"></a>get命令下载文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 binzi]# hdfs dfs -get /user/hive/warehouse/hive02.db/search_log/search_log.txt /localpath</span><br></pre></td></tr></table></figure>

<h3 id="insert导出数据"><a href="#insert导出数据" class="headerlink" title="insert导出数据"></a>insert导出数据</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#查询数据导出到hdfs其他路径: </span><br><span class="line"><span class="keyword">insert</span> overwrite directory <span class="string">&#x27;hfds存储该数据路径&#x27;</span> <span class="keyword">select</span>语句;</span><br><span class="line"></span><br><span class="line">#查询数据导出到linux本地中: </span><br><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">local</span> directory <span class="string">&#x27;linux存储该数据路径&#x27;</span> <span class="keyword">select</span>语句;</span><br><span class="line"></span><br><span class="line">#注意:  overwrite默认是覆盖重写,所以在指定存储该数据路径的时候尽量指定一个空的目录</span><br><span class="line"></span><br><span class="line">#注意: 导出数据的时候不指定分隔符采用默认分隔符SOH,<span class="number">0001</span>,?...</span><br><span class="line"></span><br><span class="line">#导出数据指定分隔符添加: </span><br><span class="line"></span><br><span class="line"><span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;分隔符&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 指定分隔符</span></span><br><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">local</span> directory <span class="string">&#x27;/output&#x27;</span></span><br><span class="line">    <span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> search_log1;</span><br></pre></td></tr></table></figure>

<h3 id="hive-shell命令导出"><a href="#hive-shell命令导出" class="headerlink" title="hive shell命令导出"></a>hive shell命令导出</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hive命令执行sql语句:  hive -e &quot;sql语句&quot; &gt; 存储该结果数据的文件路径</span><br><span class="line"></span><br><span class="line">hive命令执行sql脚本:  hive -f sql脚本文件 &gt; 存储该结果数据的文件路径</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以下命令都是在linux的shell命令行执行</span></span><br><span class="line"><span class="comment"># 3.1使用hive -e sql语句方式导出数据</span></span><br><span class="line">[root@node1 ~]<span class="comment"># hive -e &#x27;select * from hive02.search_log;&#x27; &gt; /home/hs1.txt</span></span><br><span class="line">[root@node1 ~]<span class="comment"># cat hs1.txt</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3.2使用hive -f 脚本文件方式导出数据</span></span><br><span class="line">[root@node1 ~]<span class="comment"># echo &#x27;select * from hive02.search_log;&#x27; &gt; /home/export.sql</span></span><br><span class="line">[root@node1 ~]<span class="comment"># hive -f export.sql &gt; /home/hs2.txt</span></span><br><span class="line">[root@node1 ~]<span class="comment"># cat hs2.txt</span></span><br></pre></td></tr></table></figure>

<h2 id="分区表"><a href="#分区表" class="headerlink" title="分区表"></a>分区表</h2><p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240416192110780.png" alt="image-20240416192110780"></p>
<p><strong>分区表特点/好处：</strong>需要产生分区目录，查询的时候使用分区字段筛选数据，避免全表扫描从而提升查询效率。</p>
<p><strong>效率上注意</strong>：如果分区表，在查询数据的时候，如果没有使用分区字段去筛选数据，效率不会提升。</p>
<p><strong>分区字段名注意</strong>：分区字段名不能和原有字段名重复，因为分区字段名要作为字段拼接到表后。</p>
<h3 id="一级分区"><a href="#一级分区" class="headerlink" title="一级分区"></a>一级分区</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>创建分区表</span><br><span class="line"><span class="keyword">create</span> [<span class="keyword">external</span>] <span class="keyword">table</span> [if <span class="keyword">not</span> <span class="keyword">exists</span>] 表名(字段名 字段类型 , 字段名 字段类型 , ... )partitioned <span class="keyword">by</span> (分区字段名 分区字段类型)... ; </span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>自动生成分区目录并插入数据</span><br><span class="line">load data [<span class="keyword">local</span>] inpath <span class="string">&#x27;文件路径&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> 分区表名 <span class="keyword">partition</span> (分区字段名<span class="operator">=</span><span class="string">&#x27;值&#x27;</span>);</span><br><span class="line"></span><br><span class="line">#注意: 如果加<span class="keyword">local</span>后面文件路径应该是linux本地路径,如果没有加那么就是hdfs文件路径</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 演示分区表</span></span><br><span class="line"><span class="comment">-- 1.一级分区表</span></span><br><span class="line"><span class="comment">-- 建表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> one_part_order(</span><br><span class="line">    oid string,</span><br><span class="line">    name string,</span><br><span class="line">    price <span class="keyword">double</span>,</span><br><span class="line">    num <span class="type">int</span></span><br><span class="line">)partitioned <span class="keyword">by</span> (<span class="keyword">year</span> string)</span><br><span class="line">    <span class="type">row</span> format delimited</span><br><span class="line">fields terminated <span class="keyword">by</span> <span class="string">&#x27; &#x27;</span>;</span><br><span class="line"><span class="comment">-- 加载数据</span></span><br><span class="line"><span class="comment">-- 先在hdfs的source目录下准备好订单相关数据文件</span></span><br><span class="line"><span class="comment">-- 使用load加载数据到分区表中</span></span><br><span class="line">load data inpath <span class="string">&#x27;/input/order202251.txt&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> one_part_order <span class="keyword">partition</span> (<span class="keyword">year</span><span class="operator">=</span><span class="number">2022</span>);</span><br><span class="line">load data inpath <span class="string">&#x27;/input/order2023415.txt&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> one_part_order <span class="keyword">partition</span> (<span class="keyword">year</span><span class="operator">=</span><span class="string">&#x27;2023&#x27;</span>);</span><br><span class="line">load data inpath <span class="string">&#x27;/input/order202351.txt&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> one_part_order <span class="keyword">partition</span> (<span class="keyword">year</span><span class="operator">=</span><span class="string">&#x27;2023&#x27;</span>);</span><br><span class="line">load data inpath <span class="string">&#x27;/input/order202352.txt&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> one_part_order <span class="keyword">partition</span> (<span class="keyword">year</span><span class="operator">=</span><span class="string">&#x27;2023&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240416193041609.png" alt="image-20240416193041609"></p>
<h3 id="多级分区"><a href="#多级分区" class="headerlink" title="多级分区"></a>多级分区</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#创建分区表: </span><br><span class="line"><span class="keyword">create</span> [<span class="keyword">external</span>] <span class="keyword">table</span> [if <span class="keyword">not</span> <span class="keyword">exists</span>] 表名(字段名 字段类型 , 字段名 字段类型 , ... )partitioned <span class="keyword">by</span> (一级分区字段名 分区字段类型, 二级分区字段名 分区字段类型 , ...) ; </span><br><span class="line"></span><br><span class="line">#自动生成分区目录并插入数据: </span><br><span class="line">load data [<span class="keyword">local</span>] inpath <span class="string">&#x27;文件路径&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> 分区表名 <span class="keyword">partition</span> (一级分区字段名<span class="operator">=</span><span class="string">&#x27;值&#x27;</span>,二级分区字段名<span class="operator">=</span><span class="string">&#x27;值&#x27;</span> , ...);</span><br><span class="line"></span><br><span class="line">#注意: 如果加<span class="keyword">local</span>后面文件路径应该是linux本地路径,如果没有加那么就是hdfs文件路径</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 2.多级分区表</span></span><br><span class="line"><span class="comment">-- 创建表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> multi_part_order(</span><br><span class="line">    oid string,</span><br><span class="line">    name string,</span><br><span class="line">    price <span class="type">float</span>,</span><br><span class="line">    num <span class="type">int</span></span><br><span class="line">)partitioned <span class="keyword">by</span> (<span class="keyword">year</span> string,<span class="keyword">month</span> string,<span class="keyword">day</span> string)</span><br><span class="line">    <span class="type">row</span> format delimited</span><br><span class="line">fields terminated <span class="keyword">by</span> <span class="string">&#x27; &#x27;</span>;</span><br><span class="line"><span class="comment">-- 加载数据</span></span><br><span class="line"><span class="comment">-- 思考数据文件在哪里?如果想从hdfs加载,怎么操作?上传到hdfs指定位置</span></span><br><span class="line">load data inpath <span class="string">&#x27;/source/order202251.txt&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> multi_part_order <span class="keyword">partition</span> (<span class="keyword">year</span><span class="operator">=</span><span class="number">2022</span>,<span class="keyword">month</span><span class="operator">=</span><span class="number">05</span>,<span class="keyword">day</span><span class="operator">=</span><span class="number">01</span>);</span><br><span class="line">load data inpath <span class="string">&#x27;/source/order202351.txt&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> multi_part_order <span class="keyword">partition</span> (<span class="keyword">year</span><span class="operator">=</span><span class="number">2023</span>,<span class="keyword">month</span><span class="operator">=</span><span class="number">05</span>,<span class="keyword">day</span><span class="operator">=</span><span class="number">01</span>);</span><br><span class="line">load data inpath <span class="string">&#x27;/source/order202352.txt&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> multi_part_order <span class="keyword">partition</span> (<span class="keyword">year</span><span class="operator">=</span><span class="number">2023</span>,<span class="keyword">month</span><span class="operator">=</span><span class="number">05</span>,<span class="keyword">day</span><span class="operator">=</span><span class="number">02</span>);</span><br><span class="line">load data inpath <span class="string">&#x27;/source/order2023415.txt&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> multi_part_order <span class="keyword">partition</span> (<span class="keyword">year</span><span class="operator">=</span><span class="number">2023</span>,<span class="keyword">month</span><span class="operator">=</span><span class="number">04</span>,<span class="keyword">day</span><span class="operator">=</span><span class="number">15</span>);</span><br></pre></td></tr></table></figure>

<p>并不建议分区字段太多，太多反而更麻烦，可以直接用一个字段代替多个分区形式，比如</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">partitioned <span class="keyword">by</span> (<span class="keyword">year</span> string,<span class="keyword">month</span> string,<span class="keyword">day</span> string)</span><br><span class="line">#替换成</span><br><span class="line">partitioned <span class="keyword">by</span> (year_month_day string)</span><br></pre></td></tr></table></figure>

<h3 id="分区操作"><a href="#分区操作" class="headerlink" title="分区操作"></a>分区操作</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>添加分区</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 分区表名 <span class="keyword">add</span> <span class="keyword">partition</span> (分区字段名<span class="operator">=</span><span class="string">&#x27;值&#x27;</span> , ...);</span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>删除分区</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 分区表名 <span class="keyword">drop</span> <span class="keyword">partition</span> (分区字段名<span class="operator">=</span><span class="string">&#x27;值&#x27;</span> , ...);</span><br><span class="line"></span><br><span class="line">#<span class="number">3.</span>修改分区名</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 分区表名 <span class="keyword">partition</span> (分区字段名<span class="operator">=</span><span class="string">&#x27;旧值&#x27;</span> , ...) rename <span class="keyword">to</span> <span class="keyword">partition</span> (分区字段名<span class="operator">=</span><span class="string">&#x27;新值&#x27;</span> , ...);</span><br><span class="line"></span><br><span class="line">#<span class="number">4.</span>查看所有分区</span><br><span class="line"><span class="keyword">show</span> partitons 分区表名;</span><br><span class="line"></span><br><span class="line">#<span class="number">5.</span>同步<span class="operator">/</span>修复分区</span><br><span class="line">msck repair <span class="keyword">table</span> 分区表名;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 如果在hdfs上创建符合分区目录格式的文件夹,可以使用msck repair修复</span></span><br><span class="line"><span class="comment">-- 举例:手动创建一个year=2033目录</span></span><br><span class="line">msck repair <span class="keyword">table</span> one_part_order;</span><br></pre></td></tr></table></figure>

<h2 id="分桶表"><a href="#分桶表" class="headerlink" title="分桶表"></a>分桶表</h2><p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240416193339909.png" alt="image-20240416193339909"></p>
<p><strong>分桶表特点/好处：</strong>需要产生分桶文件，查询的时候特定操作上提升效率(过滤、join分组以及抽样)</p>
<p><strong>效率上注意：如果分桶表，在查询数据的时候，如果没有使用分桶字段去筛选数据，效率不变提升。</strong></p>
<p><strong>分桶字段名注意：</strong>分桶字段名必须是原有字段名，因为分桶需要根据对应字段值取余数把余数相同的数据放到同一个分桶文件中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">-- 创建基础分桶表</span><br><span class="line">create [external] table [if not exists] 表名(</span><br><span class="line">	字段名 字段类型 </span><br><span class="line">)</span><br><span class="line">clustered by (分桶字段名) </span><br><span class="line">into 桶数量 buckets ;</span><br><span class="line"></span><br><span class="line">-- 1.创建基础分桶表,要求分3个桶</span><br><span class="line">create table course_base (</span><br><span class="line">    cid int,</span><br><span class="line">    cname string,</span><br><span class="line">    sname string</span><br><span class="line">)</span><br><span class="line">clustered by(cid) into 3 buckets</span><br><span class="line">row format delimited fields terminated by &#x27;\t&#x27;;</span><br><span class="line"></span><br><span class="line">-- 2.load方式加载数据</span><br><span class="line">-- 前提: 已经上传course.txt文件到hdfs的/source目录下</span><br><span class="line">load data inpath &#x27;/source/course.txt&#x27; into table course_base;</span><br></pre></td></tr></table></figure>

<h3 id="分桶表排序"><a href="#分桶表排序" class="headerlink" title="分桶表排序"></a>分桶表排序</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">--创建基础分桶表,然后桶内排序:   </span><br><span class="line">create [external] table [if not exists] 表名(</span><br><span class="line">	字段名 字段类型 </span><br><span class="line">)</span><br><span class="line">clustered by (分桶字段名) </span><br><span class="line">sorted by(排序字段名 asc|desc) #注意:asc升序(默认) desc降序</span><br><span class="line">into 桶数量 buckets ;</span><br><span class="line"></span><br><span class="line">create table course_sort (</span><br><span class="line">    cid int,</span><br><span class="line">    cname string,</span><br><span class="line">    sname string</span><br><span class="line">)</span><br><span class="line">clustered by(cid) sorted by (cid desc) into 3 buckets</span><br><span class="line">row format delimited fields terminated by &#x27;\t&#x27;;</span><br><span class="line"></span><br><span class="line">-- 2.加载数据</span><br><span class="line">-- 还是使用/source/course.txt数据文件</span><br><span class="line">load data inpath &#x27;/source/course.txt&#x27; into table course_sort;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>数据倾斜问题:</strong> 分桶字段值如果大量重复,相同的会分到同一个桶内,导致数据倾斜</p>
</blockquote>
<h3 id="分桶原理"><a href="#分桶原理" class="headerlink" title="分桶原理"></a>分桶原理</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">如果是数值类型分桶字段: 直接使用数值对桶数量取模   </span><br><span class="line">如果是字符串类型分桶字段: 底层会使用hash算法计算出一个数字然后再对桶数量取模</span><br><span class="line"></span><br><span class="line">Hash: Hash是一种数据加密算法，其原理我们不去详细讨论，我们只需要知道其主要特征：同样的值被Hash加密后的结果是一致的</span><br><span class="line"></span><br><span class="line">举例: 字符串“binzi”被Hash后的结果是93742710（仅作为示意），那么无论计算多少次，字符串“binzi”的结果都会是93742710。</span><br><span class="line">计算余数: hash(&#x27;binzi&#x27;)%3==0</span><br><span class="line"></span><br><span class="line">注意: 同样的数据得到的结果一致，如’binzi’ hash取模结果是0，无论计算多少次，它的取模结果都是0</span><br></pre></td></tr></table></figure>

<h3 id="分区表和分桶表区别"><a href="#分区表和分桶表区别" class="headerlink" title="分区表和分桶表区别"></a>分区表和分桶表区别</h3><ol>
<li><p><strong>分区表</strong><br>创建表的时候使用关键字: partition by (分区字段名 分区字段类型)<br>分区字段名注意事项: 是一个新的字段,需要指定类型,且不能和其他字段重名<br>分区表好处: 使用分区字段作为条件的时候,底层直接找到对应的分区目录,能够避免全表扫描,提升查询效率<br>分区表最直接的效果: 在hfds表目录下,分成多个分区目录(year=xxxx,month=xx,day=xx)<br>不建议直接上传文件在hdfs表根路径下: 分区表直接不能识别对应文件中数据,因为分区表会找分区目录下的数据文件<br>使用load方式加载hdfs中文件: 本质是移动文件到对应分区目录下</p>
</li>
<li><p><strong>分桶表</strong><br>创建表的时候使用关键字: clustered by (分桶字段名) into 桶数量 buckets<br>分桶字段名注意事项: 是指定一个已存在的字段,不需要指定类型<br>分桶表好处: 使用分桶字段做抽样等特定操作的时候,也能提升性能效率<br>分桶表最直接的效果: 在hdfs表目录或者分区目录下,分成多个分桶文件(000000_0,000001_0,000002_0…)<br>不建议直接上传文件在hdfs表根路径下: 分桶表可以识别对应文件中数据,但是并没有分桶效果,也是不建议的<br>使用load方式加载hdfs中文件: 本质是复制数据到各个分桶文件中</p>
</li>
</ol>
<h2 id="复杂类型"><a href="#复杂类型" class="headerlink" title="复杂类型"></a>复杂类型</h2><p>实际开发并不常用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#1.复杂类型建表格式</span><br><span class="line">...</span><br><span class="line">[row format delimited] # hive的serde机制</span><br><span class="line">    [fields terminated by &#x27;字段分隔符&#x27;] # 自定义字段分隔符固定格式</span><br><span class="line">    [collection ITEMS terminated by &#x27;集合分隔符&#x27;] # 自定义array同类型集合和struct不同类型集合</span><br><span class="line">    [map KEYS terminated by &#x27;键值对分隔符&#x27;] # 自定义map映射kv类型</span><br><span class="line">    [lines terminated by &#x27;\n&#x27;] # # 默认即可</span><br><span class="line">...;</span><br><span class="line"></span><br><span class="line">#2.hive复杂类型</span><br><span class="line">array、struct、map</span><br><span class="line"></span><br><span class="line">#3.array类型</span><br><span class="line">又叫数组类型，存储同类型的单数据的集合</span><br><span class="line">建表指定类型：array&lt;数据类型&gt;</span><br><span class="line">取值：字段名[索引]，索引从0开始</span><br><span class="line">获取长度：size(字段名)</span><br><span class="line">判断是否包含某个数据：array_contains(字段名,某数据)</span><br><span class="line"></span><br><span class="line">#4.struct类型</span><br><span class="line">又叫结构类型，可以存储不同类型单数据的集合</span><br><span class="line">建表指定类型：struct&lt;子字段名1:数据类型1, 子字段名2:数据类型2 , ...&gt;</span><br><span class="line">取值：字段名.子字段名n</span><br><span class="line">	</span><br><span class="line">#5.map类型</span><br><span class="line">又叫映射类型，存储键值对数据的映射(根据key找value)</span><br><span class="line">建表指定类型：map&lt;key类型,value类型&gt;</span><br><span class="line">取值：字段名[key]</span><br><span class="line">获取长度：size(字段名)</span><br><span class="line">获取所有key：map_keys()</span><br><span class="line">获取所有value：map_values()</span><br></pre></td></tr></table></figure>

<p>示例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 演示使用array类型映射数据</span></span><br><span class="line"><span class="comment">-- 创建表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test_array2(</span><br><span class="line">    name string,</span><br><span class="line">    location <span class="keyword">array</span><span class="operator">&lt;</span>string<span class="operator">&gt;</span></span><br><span class="line">)<span class="type">row</span> format delimited</span><br><span class="line">fields terminated <span class="keyword">by</span> <span class="string">&#x27;\t&#x27;</span></span><br><span class="line">collection items terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 演示struct类型映射数据</span></span><br><span class="line"><span class="comment">-- 创建表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test_struct2(</span><br><span class="line">    id <span class="type">int</span>,</span><br><span class="line">    info struct<span class="operator">&lt;</span>name:string,age:<span class="type">int</span><span class="operator">&gt;</span></span><br><span class="line">)<span class="type">row</span> format delimited</span><br><span class="line">fields terminated <span class="keyword">by</span> <span class="string">&#x27;#&#x27;</span></span><br><span class="line">collection items terminated <span class="keyword">by</span> <span class="string">&#x27;:&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 演示map类型的应用</span></span><br><span class="line"><span class="comment">-- 创建表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test_map2(</span><br><span class="line">    id <span class="type">int</span>,</span><br><span class="line">    name string,</span><br><span class="line">    info map<span class="operator">&lt;</span>string,string<span class="operator">&gt;</span>,</span><br><span class="line">    age <span class="type">int</span></span><br><span class="line">)<span class="type">row</span> format delimited</span><br><span class="line">fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span></span><br><span class="line">collection items terminated <span class="keyword">by</span> <span class="string">&#x27;#&#x27;</span></span><br><span class="line">map keys terminated <span class="keyword">by</span> <span class="string">&#x27;:&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h1 id="Hive查询"><a href="#Hive查询" class="headerlink" title="Hive查询"></a>Hive查询</h1><h2 id="语法结构"><a href="#语法结构" class="headerlink" title="语法结构"></a>语法结构</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT [ALL | DISTINCT] 字段名, 字段名, ...</span><br><span class="line">FROM 表名 [inner | left outer | right outer | full outer | left semi JOIN 表名 ON 关联条件 ]</span><br><span class="line">[WHERE 非聚合条件]</span><br><span class="line">[GROUP BY 分组字段名]</span><br><span class="line">[HAVING 聚合条件]</span><br><span class="line">[ORDER BY 排序字段名 asc | desc]</span><br><span class="line">[CLUSTER  BY 字段名 | [DISTRIBUTE BY 字段名 SORT BY 字段名]]</span><br><span class="line">[LIMIT x,y]</span><br></pre></td></tr></table></figure>

<h2 id="类SQL基本查询"><a href="#类SQL基本查询" class="headerlink" title="类SQL基本查询"></a>类SQL基本查询</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>基础查询格式</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> 字段名 <span class="keyword">from</span> 表名;      </span><br><span class="line"><span class="operator">*</span>代表所有字段  <span class="keyword">distinct</span>去重  <span class="keyword">as</span>给表或者字段起别名</span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>条件查询格式</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> 字段名 <span class="keyword">from</span> 表名 <span class="keyword">where</span> 条件;</span><br><span class="line">比较运算符: <span class="operator">&gt;</span> <span class="operator">&lt;</span> <span class="operator">&gt;=</span> <span class="operator">&lt;=</span> <span class="operator">!=</span> <span class="operator">&lt;&gt;</span></span><br><span class="line">逻辑运算符: <span class="keyword">and</span> <span class="keyword">or</span> <span class="keyword">not</span></span><br><span class="line">模糊查询: <span class="operator">%</span>代表任意<span class="number">0</span>个或者多个字符   _代表任意<span class="number">1</span>个字符</span><br><span class="line">空判断: 为空<span class="keyword">is</span> <span class="keyword">null</span>   不为空<span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">范围查询: x到y的连续范围:<span class="keyword">between</span> x <span class="keyword">and</span> y    x或者y或者z类的非连续范围: <span class="keyword">in</span>(x,y,z)</span><br><span class="line"></span><br><span class="line">#<span class="number">3.</span>排序查询格式</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> 字段名 <span class="keyword">from</span> 表名 [<span class="keyword">where</span> 条件] <span class="keyword">order</span> <span class="keyword">by</span> 排序字段名 <span class="keyword">asc</span><span class="operator">|</span><span class="keyword">desc</span> ;</span><br><span class="line"><span class="keyword">asc</span> : 升序 默认升序</span><br><span class="line"><span class="keyword">desc</span>: 降序</span><br><span class="line"></span><br><span class="line">#<span class="number">4.</span>聚合查询格式</span><br><span class="line"><span class="keyword">select</span> 聚合函数(字段名) <span class="keyword">from</span> 表名;</span><br><span class="line">聚合函数: 又叫分组函数或者统计函数</span><br><span class="line">聚合函数: <span class="built_in">count</span>()  <span class="built_in">sum</span>()  <span class="built_in">avg</span>()  <span class="built_in">max</span>()  <span class="built_in">min</span>()</span><br><span class="line"></span><br><span class="line">#<span class="number">5.</span>分组查询格式</span><br><span class="line"><span class="keyword">select</span> 分组字段名,聚合函数(字段名) <span class="keyword">from</span> 表名 [<span class="keyword">where</span> 非聚合条件] <span class="keyword">group</span> <span class="keyword">by</span> 分组字段名 [<span class="keyword">having</span> 聚合条件];</span><br><span class="line">注意: 当分组查询的时候,<span class="keyword">select</span>后的字段名要么在groupby后出现过,要么放在聚合函数内,否则报错</span><br><span class="line"><span class="keyword">where</span>和<span class="keyword">having</span>区别? </span><br><span class="line">区别<span class="number">1</span>: 书写顺序不同,<span class="keyword">where</span>在<span class="keyword">group</span> <span class="keyword">by</span>关键字前,<span class="keyword">having</span>在<span class="keyword">group</span> <span class="keyword">by</span>关键字后</span><br><span class="line">区别<span class="number">2</span>: 执行顺序不同,<span class="keyword">where</span>在分组之前过滤数据,<span class="keyword">having</span>在分组之后过滤数据</span><br><span class="line">区别<span class="number">3</span>: 筛选数据不同,<span class="keyword">where</span>只能在分组之前过滤非聚合数据,<span class="keyword">having</span>在分组之后主要过滤聚合数据</span><br><span class="line">区别<span class="number">4</span>: 操作对象不同,<span class="keyword">where</span>底层操作伪表,<span class="keyword">having</span>底层操作运算区</span><br><span class="line"></span><br><span class="line">#<span class="number">6.</span>分页查询格式</span><br><span class="line"><span class="keyword">select</span> 字段名 <span class="keyword">from</span> 表名 [ <span class="keyword">order</span> <span class="keyword">by</span> 排序字段名 <span class="keyword">asc</span><span class="operator">|</span><span class="keyword">desc</span>] limit x,y;</span><br><span class="line">x: 起始索引 默认从<span class="number">0</span>开始,如果x为<span class="number">0</span>可以省略    计算格式: x<span class="operator">=</span>(页数<span class="number">-1</span>)<span class="operator">*</span>y</span><br><span class="line">y: 本次查询记录数	</span><br></pre></td></tr></table></figure>

<h2 id="类SQL多表查询"><a href="#类SQL多表查询" class="headerlink" title="类SQL多表查询"></a>类SQL多表查询</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>交叉连接格式</span><br><span class="line"><span class="keyword">select</span> 字段名 <span class="keyword">from</span> 左表 <span class="keyword">cross</span> <span class="keyword">join</span> 右表;</span><br><span class="line">注意: 交叉连接产生的结果叫笛卡尔积,此种方式慎用<span class="operator">!</span><span class="operator">!</span><span class="operator">!</span></span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>内连接格式</span><br><span class="line"><span class="keyword">select</span> 字段名 <span class="keyword">from</span> 左表 <span class="keyword">inner</span> <span class="keyword">join</span> 右表 <span class="keyword">on</span> 左右表关联条件;</span><br><span class="line">特点: 相当于只取两个表的交集</span><br><span class="line"></span><br><span class="line">#<span class="number">3.</span>左外连接格式</span><br><span class="line"><span class="keyword">select</span> 字段名 <span class="keyword">from</span> 左表 <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> 右表 <span class="keyword">on</span> 左右表关联条件;</span><br><span class="line">特点: 以左表为主,左表数据全部保留,右表只保留和左表有交集的部分</span><br><span class="line"></span><br><span class="line">#<span class="number">4.</span>右外连接格式</span><br><span class="line"><span class="keyword">select</span> 字段名 <span class="keyword">from</span> 左表 <span class="keyword">right</span> <span class="keyword">outer</span> <span class="keyword">join</span> 右表 <span class="keyword">on</span> 左右表关联条件;</span><br><span class="line">特点: 以右表为主,右表数据全部保留,左表只保留和右表有交集的部分</span><br><span class="line"></span><br><span class="line">#<span class="number">5.</span>自连接</span><br><span class="line">本质是一个特殊的内外连接,最大特点就是左右表是同一个表</span><br><span class="line">应用场景: 比较局限,场景<span class="number">1</span>: 存储省市县三级数据的区域表   场景<span class="number">2</span>: 存储上下级信息的员工表</span><br><span class="line"></span><br><span class="line">#<span class="number">6.</span>子查询</span><br><span class="line">本质是一个<span class="keyword">select</span>语句作为另外一个<span class="keyword">select</span>语句的一部分(表或者条件)</span><br><span class="line">注意: 子查询作为表使用的话必须取别名</span><br></pre></td></tr></table></figure>

<h2 id="Hive其他join操作"><a href="#Hive其他join操作" class="headerlink" title="Hive其他join操作"></a>Hive其他join操作</h2><p>在Hive中除了支持cross join（交叉连接，也叫做笛卡尔积）,inner join（内连接）、left outer join（左外连接）、</p>
<p>right outer  join（右外连接）<strong>还支持full outer join（全外连接）、left semi join（左半开连接）</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>全外连接</span><br><span class="line">左表 <span class="keyword">full</span> [<span class="keyword">outer</span>] <span class="keyword">join</span> 右表 <span class="keyword">on</span> 条件</span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>左半开连接</span><br><span class="line">左表 <span class="keyword">left</span> semi <span class="keyword">join</span> 右表 <span class="keyword">on</span> 条件</span><br><span class="line"></span><br><span class="line"><span class="comment">-- hive不同于mysql的join操作</span></span><br><span class="line"><span class="comment">-- 全外连接(左表 full outer join 右表 on 条件) 大白话就是左外和右外结果合并同时去重</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users u <span class="keyword">full</span> <span class="keyword">outer</span> <span class="keyword">join</span> orders o <span class="keyword">on</span> u.userId <span class="operator">=</span> o.userId;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 左半开连接(左表 left semi join 右表 on 条件) 大白话就是内连接的一半</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users u <span class="keyword">left</span> semi <span class="keyword">join</span> orders o <span class="keyword">on</span> u.userId <span class="operator">=</span> o.userId;</span><br></pre></td></tr></table></figure>

<h2 id="Hive其他排序操作"><a href="#Hive其他排序操作" class="headerlink" title="Hive其他排序操作"></a>Hive其他排序操作</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> mapreduce.job.reduces:  查看当前设置的reduce数量 默认结果是<span class="number">-1</span>,代表自动匹配reduce数量和桶数量一致</span><br><span class="line"><span class="keyword">set</span> mapreduce.job.reduces <span class="operator">=</span> 数量 : <span class="comment">-- 修改reduces数量</span></span><br><span class="line"></span><br><span class="line">#<span class="number">1.</span>cluster <span class="keyword">by</span> 字段名</span><br><span class="line">分桶且正序排序。</span><br><span class="line">弊端：分和排序是同一个字段，相对不灵活</span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>distribute <span class="keyword">by</span> 字段名 sort <span class="keyword">by</span> 字段名</span><br><span class="line">distribute <span class="keyword">by</span>负责分</span><br><span class="line">sort <span class="keyword">by</span>负责排序，相对比较灵活</span><br><span class="line"></span><br><span class="line">#<span class="number">3.</span><span class="keyword">order</span> <span class="keyword">by</span> 字段名 永远都是全局排序,不受reduces数量影响,每次只用<span class="number">1</span>个reduces</span><br><span class="line">全局排序</span><br><span class="line"></span><br><span class="line">#<span class="number">4.</span>注意事项</span><br><span class="line">cluster <span class="keyword">by</span>和distribute <span class="keyword">by</span>字段名sort <span class="keyword">by</span>字段名：受当前设置的reduces数量影响,但是设置的reduces数量对<span class="keyword">order</span> <span class="keyword">by</span>无影响,因为orderby就是全局排序,就是一个reduce</span><br><span class="line"></span><br><span class="line">建表的时候指定分桶字段和排序字段：clustered <span class="keyword">by</span> (字段名) sorted <span class="keyword">by</span> (字段名) <span class="keyword">into</span> 桶数量 buckets</span><br><span class="line">注意: 如果建表的时候设置了桶数量,那么reduces建议设置值<span class="number">-1</span>或者值大于桶数量</span><br></pre></td></tr></table></figure>

<h2 id="抽样查询"><a href="#抽样查询" class="headerlink" title="抽样查询"></a>抽样查询</h2><p>TABLESAMPLE抽样好处：当表数据特别大的时候，就算只是select * limit 语句也会非常慢，因此，如何从表中获取少量数据校验进行数据的准确性校验时就显得非常重要。tablesample就可以满足这个需求。</p>
<p>tablesample会尽可能实现随机抽样，并且不走MR，查询效率相对较快。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>基于随机分桶抽样格式</span><br><span class="line"><span class="keyword">SELECT</span> 字段名 <span class="keyword">FROM</span> tbl <span class="keyword">TABLESAMPLE</span>(BUCKET x <span class="keyword">OUT</span> <span class="keyword">OF</span> y <span class="keyword">ON</span>(字段名 <span class="operator">|</span> rand()))</span><br><span class="line">y：表示将表数据随机划分成y份（y个桶）</span><br><span class="line">x：表示从y里面随机抽取第x份数据作为取样</span><br><span class="line"><span class="operator">|</span>：或者</span><br><span class="line">字段名：表示随机的依据基于某个列的值，每次按相关规则取样结果都是一致。</span><br><span class="line">rand()：表示随机的依据基于整行，每次取样结果不同。</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 随机抽样函数 tablesample</span></span><br><span class="line"><span class="comment">-- 参考字段分桶抽样,快且随机</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> orders <span class="keyword">tablesample</span> ( bucket <span class="number">1</span> <span class="keyword">out</span> <span class="keyword">of</span> <span class="number">10</span> <span class="keyword">on</span> orderid);</span><br><span class="line"><span class="comment">-- 参考rand()随机数,快且真正达到随机</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> orders <span class="keyword">tablesample</span> ( bucket <span class="number">1</span> <span class="keyword">out</span> <span class="keyword">of</span> <span class="number">10</span> <span class="keyword">on</span> rand());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 快速取前面部分数据 : 快但没有随机</span></span><br><span class="line"><span class="comment">-- 前100条</span></span><br><span class="line"><span class="keyword">select</span>  <span class="operator">*</span> <span class="keyword">from</span> orders <span class="keyword">tablesample</span> ( <span class="number">100</span> <span class="keyword">rows</span> );</span><br><span class="line"><span class="comment">-- 前10%数据</span></span><br><span class="line"><span class="keyword">select</span>  <span class="operator">*</span> <span class="keyword">from</span> orders <span class="keyword">tablesample</span> ( <span class="number">10</span> <span class="keyword">percent</span> );</span><br><span class="line"><span class="comment">-- 取1k或者1m的数据</span></span><br><span class="line"><span class="keyword">select</span>  <span class="operator">*</span> <span class="keyword">from</span> orders <span class="keyword">tablesample</span> ( <span class="number">16</span>k );</span><br><span class="line"><span class="keyword">select</span>  <span class="operator">*</span> <span class="keyword">from</span> orders <span class="keyword">tablesample</span> ( <span class="number">167</span>k );</span><br><span class="line"><span class="keyword">select</span>  <span class="operator">*</span> <span class="keyword">from</span> orders <span class="keyword">tablesample</span> ( <span class="number">1</span>m );</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 随机取100条: 随机但是不快</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> orders distribute <span class="keyword">by</span> rand() sort <span class="keyword">by</span> rand() limit <span class="number">100</span>;</span><br></pre></td></tr></table></figure>

<h2 id="正则模糊查询"><a href="#正则模糊查询" class="headerlink" title="正则模糊查询"></a>正则模糊查询</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span><span class="keyword">sql</span>模糊查询关键字：<span class="keyword">like</span></span><br><span class="line">任意<span class="number">0</span>个或者多个：<span class="operator">%</span></span><br><span class="line">任意<span class="number">1</span>个：_    </span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>正则模糊查询关键字rlike</span><br><span class="line">任意<span class="number">0</span>个或者多个：.<span class="operator">*</span></span><br><span class="line">任意<span class="number">1</span>个：.</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 正则表达式查询</span></span><br><span class="line"><span class="comment">-- 1.查询广东省数据</span></span><br><span class="line"><span class="comment">-- sql模糊查询</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> orders <span class="keyword">where</span> userAddress <span class="keyword">like</span> <span class="string">&#x27;广东省%&#x27;</span>;</span><br><span class="line"><span class="comment">-- 正则模糊查询</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> orders <span class="keyword">where</span> userAddress rlike <span class="string">&#x27;广东省.*&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 查询满足&#x27;xx省 xx市 xx区&#x27;格式的信息</span></span><br><span class="line"><span class="comment">-- sql模糊查询</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> orders <span class="keyword">where</span> userAddress <span class="keyword">like</span> <span class="string">&#x27;__省 __市 __区&#x27;</span>;</span><br><span class="line"><span class="comment">-- 正则模糊查询</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> orders <span class="keyword">where</span> userAddress rlike <span class="string">&#x27;..省 ..市 ..区&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3.查询所有姓张王邓的用户信息</span></span><br><span class="line"><span class="comment">-- sql模糊查询</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> orders <span class="keyword">where</span> username <span class="keyword">like</span> <span class="string">&#x27;张%&#x27;</span> <span class="keyword">or</span> username <span class="keyword">like</span> <span class="string">&#x27;王%&#x27;</span> <span class="keyword">or</span> username <span class="keyword">like</span> <span class="string">&#x27;邓%&#x27;</span> ;</span><br><span class="line"><span class="comment">-- 正则模糊查询</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> orders <span class="keyword">where</span> username rlike <span class="string">&#x27;[张王邓].*&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> orders <span class="keyword">where</span> username rlike &quot;[张王邓].+&quot;;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4.查找所有188开头的手机号</span></span><br><span class="line"><span class="comment">-- sql模糊查询</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> orders <span class="keyword">where</span> userPhone <span class="keyword">like</span> <span class="string">&#x27;188________&#x27;</span> ;</span><br><span class="line"><span class="comment">-- 正则模糊查询</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> orders <span class="keyword">where</span> userPhone rlike <span class="string">&#x27;188........&#x27;</span> ;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> orders <span class="keyword">where</span> userPhone rlike <span class="string">&#x27;188.&#123;8&#125;&#x27;</span> ;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> orders <span class="keyword">where</span> userPhone rlike <span class="string">&#x27;188\\*&#123;4&#125;[0-9]&#123;4&#125;&#x27;</span> ;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> orders <span class="keyword">where</span> userPhone rlike <span class="string">&#x27;188\\*&#123;4&#125;\\d&#123;4&#125;&#x27;</span> ;</span><br><span class="line"># 正则语法还有很多。不细说</span><br></pre></td></tr></table></figure>

<h2 id="union联合查询"><a href="#union联合查询" class="headerlink" title="union联合查询"></a>union联合查询</h2><p>union联合查询：就是把两个select语句结果合并成一个临时结果集，整体可以用于其他SQL操作。</p>
<p>union可以根据是否去重，有两种写法，如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">1.union [distinct]</span></span><br><span class="line">去重，只是省略了distinct</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">2.union all</span></span><br><span class="line">不去重</span><br></pre></td></tr></table></figure>

<h2 id="CTE表达式"><a href="#CTE表达式" class="headerlink" title="CTE表达式"></a>CTE表达式</h2><p>公用表表达式，原名为Common Table Expression，简称CTE语句，是一种复杂SQL的优化写法，本质上就是子查询。</p>
<p>其语法如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> 临时表名称<span class="number">1</span> <span class="keyword">as</span> (</span><br><span class="line">	子查询语句<span class="number">1</span></span><br><span class="line">),临时表名称<span class="number">2</span> <span class="keyword">as</span> (</span><br><span class="line">	子查询语句<span class="number">2</span></span><br><span class="line">),临时表名称<span class="number">3</span> <span class="keyword">as</span> (</span><br><span class="line">	子查询语句<span class="number">3</span></span><br><span class="line">)...</span><br><span class="line"> <span class="keyword">select</span> 字段名 <span class="keyword">from</span> 临时表名称N;</span><br></pre></td></tr></table></figure>

<h2 id="内置虚拟列"><a href="#内置虚拟列" class="headerlink" title="内置虚拟列"></a>内置虚拟列</h2><p>虚拟列是Hive内置的可以在查询语句中使用的特殊标记，可以查询数据本身的详细参数。</p>
<p>Hive目前可用3个虚拟列：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">1.INPUT__FILE__NAME</span></span><br><span class="line">显示数据行所在的具体文件</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">2.BLOCK__OFFSET__INSIDE__FILE</span></span><br><span class="line">显示数据行所在文件的偏移量</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">3.ROW__OFFSET__INSIDE__BLOCK</span></span><br><span class="line">显示数据所在HDFS块的偏移量。</span><br><span class="line">注意: 此虚拟列需要设置：SET hive.exec.rowoffset=true 才可使用</span><br></pre></td></tr></table></figure>

<h1 id="Hive函数"><a href="#Hive函数" class="headerlink" title="Hive函数"></a>Hive函数</h1><p>Hive的函数分为两大类：<strong>内置函数</strong>（Built-in Functions）、<strong>用户定义函数</strong>（User-Defined Functions）</p>
<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240417194205171.png" alt="image-20240417194205171"></p>
<p>本来，UDF 、UDAF、UDTF3个标准是针对用户自定义函数分类的；但是，现在可以将这个分类标准扩大到hive中所有的函数，包括内置函数和自定义函数;</p>
<p>1、<strong>UDF</strong>（User-Defined-Function）<strong>普通函数: 一进一出 输入一行数据输出一行数据</strong>    </p>
<p>举例: split</p>
<p>2、<strong>UDAF</strong>（User-Defined Aggregation Function）<strong>聚合函数: 多进一出 输入多行输出一行</strong>   </p>
<p>举例: count sum max min avg</p>
<p>3、<strong>UDTF</strong>（User-Defined Table-Generating Functions）<strong>表生成函数: 一进多出 输入一行输出多行</strong> </p>
<p>举例: explode</p>
<p>详细的函数使用可以参阅：<a target="_blank" rel="noopener" href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF#LanguageManualUDF-MathematicalFunctions">LanguageManual UDF - Apache Hive - Apache Software Foundation</a></p>
<p>大部分函数都和标准sql，了解过mysql的绝大部分操作都可以直接照搬。并且hive和mysql一样可以通过命令查看用法手册</p>
<p>1.使用<strong>show functions</strong>查看当下可用的所有函数；</p>
<p>2.通过<strong>describe function extended</strong> <strong>函数名</strong>来查看函数的使用方式。</p>
<p>所以仅仅介绍常用函数</p>
<h2 id="内建函数"><a href="#内建函数" class="headerlink" title="内建函数"></a>内建函数</h2><h3 id="字符串操作"><a href="#字符串操作" class="headerlink" title="字符串操作"></a>字符串操作</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">--concat</span><br><span class="line">select concat(&#x27;a&#x27;,&#x27;b&#x27;);</span><br><span class="line">--concat_ws</span><br><span class="line">select concat_ws(&#x27;-&#x27;,&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;);--a,b,c</span><br><span class="line">select concat_ws(&#x27;,&#x27;,&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;);--a,b,c</span><br><span class="line">select length(&#x27;facebook&#x27;);--8</span><br><span class="line">select lower(&#x27;AbCdEfg&#x27;);--abcdefg</span><br><span class="line">select upper(&#x27;AbCdEfg&#x27;);--ABCDEFG</span><br><span class="line">select trim(&#x27;   abc &#x27;);--&#x27;abc&#x27;</span><br><span class="line">select split(&#x27;a,b,c&#x27;,&#x27;,&#x27;);--&#x27;a,b,c&#x27; -&gt; [&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;]，把一个字符串切换后的结果是：array（数组）</span><br><span class="line">select array(&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;);--[&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;]</span><br><span class="line">--substr：字符串切割函数</span><br><span class="line">--参数一：字符串</span><br><span class="line">--参数二：起始位置</span><br><span class="line">--参数三：可省略，默认切割到最后</span><br><span class="line">select substr(&#x27;facebook&#x27;,3);</span><br><span class="line">select substr(&#x27;facebook&#x27;,3,1);</span><br><span class="line"></span><br><span class="line">-- 正则替换</span><br><span class="line">SELECT regexp_replace(&#x27;100-200&#x27;, &#x27;(\\d+)&#x27;, &#x27;xxxx&#x27;);</span><br><span class="line">-- 正则提取</span><br><span class="line">SELECT regexp_extract(&#x27;100-200&#x27;, &#x27;(\\d+)-(\\d+)&#x27;, 1);</span><br><span class="line"></span><br><span class="line">--URL解析函数：parse_url 注意要想一次解析出多个 可以使用parse_url_tuple这个UDTF函数</span><br><span class="line">SELECT parse_url(&#x27;http://facebook.com/path/p1.php?query=1&#x27;, &#x27;HOST&#x27;);</span><br><span class="line">SELECT parse_url(&#x27;http://facebook.com/path/p1.php?query=1&#x27;, &#x27;PROTOCOL&#x27;);</span><br></pre></td></tr></table></figure>

<h3 id="日期时间"><a href="#日期时间" class="headerlink" title="日期时间"></a>日期时间</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">--日期函数</span><br><span class="line">select unix_timestamp(); --获取当前时间戳：1713325366</span><br><span class="line">select unix_timestamp(&#x27;2024-03-17 03:28:54&#x27;); --获取当前时间戳,可以传入时间</span><br><span class="line">select from_unixtime(1713324534); -- 把时间戳转换为时间格式</span><br><span class="line">select from_unixtime(1713324534,&#x27;yyyy-MM-dd&#x27;); -- 把时间戳转换为时间格式，可以指定格式</span><br><span class="line">select `current_timestamp`();--查看当前时间戳：2024-04-17 11:42:30.125000000</span><br><span class="line">select current_user();--查看当前用户</span><br><span class="line">select to_date(&#x27;2024-03-17 03:28:54&#x27;);--把时间戳转换为日期（不带时分秒）</span><br><span class="line">select year(&#x27;2024-03-17 03:28:54&#x27;);--2024</span><br><span class="line">SELECT date_add(&#x27;2009-07-30&#x27;, 1);--日期操作函数，可以在日期上进行相加操作</span><br><span class="line">SELECT date_sub(&#x27;2009-07-30&#x27;, 1);--日期操作函数，可以在日期上进行相减操作</span><br><span class="line">SELECT datediff(&#x27;2024-04-20&#x27;, &#x27;2024-04-17&#x27;);--日期操作函数，判断两个日期之间相隔的天数</span><br><span class="line">SELECT abs(datediff(&#x27;2009-07-30&#x27;, &#x27;2024-04-17&#x27;));--日期操作函数，判断两个日期之间相隔的天数</span><br></pre></td></tr></table></figure>

<h3 id="数学函数"><a href="#数学函数" class="headerlink" title="数学函数"></a>数学函数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">--数学函数</span><br><span class="line">select round(3.141592653);--默认取整</span><br><span class="line">select round(3.141592653,2);--保留2位小数，3.14，小数后就是四舍五入</span><br><span class="line">select round(3.141592653,3);--保留2位小数，3.142，小数后就是四舍五入</span><br><span class="line">select floor(3.141592653);--3</span><br><span class="line">select floor(-3.141592653);-- -4</span><br><span class="line">select ceil(-3.141592653);-- -3</span><br><span class="line">select rand();--随机</span><br><span class="line">select rand(10);--给一个随机种子后，这个值就固定了</span><br></pre></td></tr></table></figure>

<h3 id="条件函数"><a href="#条件函数" class="headerlink" title="条件函数"></a>条件函数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">--条件函数</span><br><span class="line">--if(条件，返回值1，返回值2)</span><br><span class="line">--当条件成立，则返回 返回值1，否则返回 返回值2</span><br><span class="line">select if(1=1,&#x27;@&#x27;,&#x27;#&#x27;);--@</span><br><span class="line">select if(1=2,3,4);--4</span><br><span class="line">select case when 1=1 then &#x27;@&#x27; else &#x27;#&#x27; end;</span><br><span class="line">select isnull(&#x27;a&#x27;);--false</span><br><span class="line">select isnull(&#x27;b&#x27;);--false</span><br><span class="line">select isnull(&#x27;&#x27;);--false</span><br><span class="line">select isnull(null);--true</span><br><span class="line">--nvl(值，默认值)：如果值为空，则返回默认值，否则返回值本身</span><br><span class="line">select nvl(true,false);--true</span><br><span class="line">select nvl(&#x27;abc&#x27;,null);--abc</span><br><span class="line">select nvl(null,&#x27;abc&#x27;);--abc</span><br><span class="line">select nvl(null,&#x27;null&#x27;);--&#x27;null&#x27;</span><br><span class="line">select nvl(null,null);--&lt;null&gt;</span><br><span class="line">--coalesce(a1,a2...)，返回第一个不为空的值</span><br><span class="line">select coalesce(1,null);--1</span><br><span class="line">select coalesce(1,2,null);--1</span><br><span class="line">select coalesce(null,1,2);--1</span><br><span class="line">select coalesce(null,null,2);--2</span><br><span class="line">select coalesce(null,null,2,null);--2</span><br><span class="line">select coalesce(null, null, null, 3);--3</span><br><span class="line">select coalesce(null,null,null,null);--&lt;null&gt;</span><br></pre></td></tr></table></figure>

<h3 id="类型转换函数"><a href="#类型转换函数" class="headerlink" title="类型转换函数"></a>类型转换函数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--类型转换函数</span><br><span class="line">--cast(value as type)</span><br><span class="line">select cast(1 as string);--&quot;1&quot;</span><br><span class="line">select cast(&quot;1&quot; as int);--1</span><br><span class="line">select cast(&#x27;abc&#x27; as int);--无法识别，&lt;null&gt;</span><br></pre></td></tr></table></figure>

<h3 id="脱敏函数"><a href="#脱敏函数" class="headerlink" title="脱敏函数"></a>脱敏函数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">--脱敏函数</span><br><span class="line">select mask(&#x27;ABCdef123&#x27;);--XXXxxxnnn</span><br><span class="line">select mask_hash(&#x27;ABCdef123&#x27;);</span><br><span class="line">select mask_first_n(&#x27;ABCdef123&#x27;,4);--对前4个进行脱敏：XXXxef123</span><br><span class="line">select mask_last_n(&#x27;ABCdef123&#x27;,4);--对后4个进行脱敏：ABCdexnnn</span><br><span class="line">select mask_show_first_n(&#x27;ABCdef123&#x27;,4);--z展示前4个，其余的脱敏：ABCdxxnnn</span><br><span class="line">select mask_show_last_n(&#x27;ABCdef123&#x27;,4);--z展示后4个，其余的脱敏：XXXxxf123</span><br></pre></td></tr></table></figure>

<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">--其他函数</span><br><span class="line">select hash(1234);--1234</span><br><span class="line">select hash(&#x27;1234&#x27;);--1509442</span><br><span class="line">select current_user();--root</span><br><span class="line">select current_database();--hive04</span><br><span class="line">select version();--3.1.2 r8190d2be7b7165effa62bd21b7d60ef81fb0e4af</span><br><span class="line">select md5(&#x27;abc&#x27;);--900150983cd24fb0d6963f7d28e17f72</span><br><span class="line">select &#x27;zhangsan&#x27;,&#x27;123456&#x27;;</span><br><span class="line">select &#x27;zhangsan&#x27;,md5(&#x27;123456&#x27;);</span><br><span class="line">select size(array(&#x27;1234&#x27;,&#x27;abc&#x27;,&#x27;123&#x27;));--3</span><br></pre></td></tr></table></figure>

<h2 id="用户定义函数"><a href="#用户定义函数" class="headerlink" title="用户定义函数"></a>用户定义函数</h2><h3 id="explode-爆炸函数"><a href="#explode-爆炸函数" class="headerlink" title="explode-爆炸函数"></a>explode-爆炸函数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--explode：参数必须是map或者array，一般是array类型，它的结果是一张表，所以它叫表生成函数</span><br><span class="line">select explode(array(1,2,3,4,5));</span><br><span class="line">--string:&quot;hadoop,hive,zookeeper,HDFS&quot;</span><br><span class="line">select split(&quot;hadoop,hive,zookeeper,HDFS&quot;,&quot;,&quot;);</span><br><span class="line">select explode(split(&#x27;hadoop,hive,zookeeper,HDFS&#x27;,&#x27;,&#x27;));</span><br></pre></td></tr></table></figure>

<img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240417202000149.png" alt="image-20240417202000149" style="zoom:50%;" />

<p>可以看出讲一条array数据转成了一列</p>
<p>现在给出需求和数据来详细谈谈用法，将NBA总冠军球队数据使用explode进行拆分，并且根据夺冠年份进行倒序排序。使用explode函数对champion_year进行拆分 俗称炸开</p>
<img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240417202533646.png" alt="image-20240417202533646" style="zoom:67%;" />

<p>查询sql如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">with champion_year_tb as (select explode(champion_year) champion_year from the_nba_championship)</span><br><span class="line">select *</span><br><span class="line">from the_nba_championship</span><br><span class="line">         join champion_year_tb on array_contains(the_nba_championship.champion_year, champion_year_tb.champion_year)</span><br><span class="line">order by champion_year_tb.champion_year desc;</span><br></pre></td></tr></table></figure>

<img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240417202844127.png" alt="image-20240417202844127" style="zoom:67%;" />

<blockquote>
<p><strong>错误写法 ：select team_name,explode(champion_year) from the_nba_championship;</strong></p>
</blockquote>
<p>UDTF函数生成的结果可以当成一张虚拟的表，但是无法和原始表进行组合查询，所以hive专门推出了lateral view侧视图的语句，可以直接将上面的join查询替换成：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">select *</span><br><span class="line">from the_nba_championship;</span><br><span class="line">select team_name, years</span><br><span class="line">from the_nba_championship lateral view explode(champion_year) t1 as years</span><br><span class="line">order by years desc;</span><br><span class="line"></span><br><span class="line">--lateral view侧视图基本语法如下</span><br><span class="line">select …… from tabelA lateral view UDTF(xxx) 别名 as col1,col2,col3……;</span><br></pre></td></tr></table></figure>

<p><strong>所以用此函数也相当于列转行</strong></p>
<h3 id="collect-数据收集函数"><a href="#collect-数据收集函数" class="headerlink" title="collect-数据收集函数"></a>collect-数据收集函数</h3><p>collect_set –把多行数据收集为一行 返回set集合 去重无序</p>
<p>collect_list –把多行数据收集为一行 返回list集合 不去重有序</p>
<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240417203634222.png" alt="image-20240417203634222"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> collect_list(col3) <span class="keyword">from</span> row2col2 <span class="keyword">group</span> <span class="keyword">by</span> col2,col1;</span><br></pre></td></tr></table></figure>

<p><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240417210621784.png" alt="image-20240417210621784"></p>
<h3 id="json-处理"><a href="#json-处理" class="headerlink" title="json-处理"></a>json-处理</h3><p>在hive中，没有json类的存在，一般使用string类型来修饰，叫做json字符串，简称json串。并且使用JsonSerDe 类解析，在加载json数据到表中的时候完成解析动作</p>
<p>在hive中，处理json数据的两种方式</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_json_test2 (</span><br><span class="line">                               device string,</span><br><span class="line">                               deviceType string,</span><br><span class="line">                               signal <span class="keyword">double</span>,</span><br><span class="line">                               `<span class="type">time</span>` string</span><br><span class="line">)<span class="type">ROW</span> FORMAT SERDE <span class="string">&#x27;org.apache.hive.hcatalog.data.JsonSerDe&#x27;</span> STORED <span class="keyword">AS</span> TEXTFILE;</span><br><span class="line"><span class="comment">-- 处理json数据,load自动分析赋值字段</span></span><br></pre></td></tr></table></figure>

<p><strong>json_tuple</strong></p>
<p>是UDTF 表生成函数 输入一行，输出多行 一次提取读个值 可以单独使用 也可以配合lateral view侧视图使用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> get_json_object(<span class="string">&#x27;&#123;&quot;name&quot;:&quot;lk&quot;,&quot;address&quot;:&#123;&quot;city&quot;:[&quot;hubei&quot;,&quot;wuhan&quot;]&#125;&#125;&#x27;</span>, <span class="string">&#x27;$.address.city[0]&#x27;</span>); <span class="comment">--hubei</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">describe function extended get_json_object; --查看取值符号$等等</span><br></pre></td></tr></table></figure>

<img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/image-20240417221706942.png" alt="image-20240417221706942" style="zoom:67%;" />

<p><strong>get_json_object</strong></p>
<p>是UDF普通函数，输入一行 输出一行 一次只能提取一个值 多次提取多次使用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> json_tuple(<span class="string">&#x27;&#123;&quot;name&quot;:&quot;lk&quot;,&quot;address&quot;:&#123;&quot;city&quot;:[&quot;hubei&quot;,&quot;wuhan&quot;]&#125;&#125;&#x27;</span>,<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;address&#x27;</span>) <span class="keyword">as</span> (name,address); <span class="comment">-- lk  &#123;&quot;city&quot;:[&quot;hubei&quot;,&quot;wuhan&quot;]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 搭配侧视图使用</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">    json,device,deviceType,signal,stime</span><br><span class="line"><span class="keyword">from</span> tb_json_test1</span><br><span class="line">         <span class="keyword">lateral</span> <span class="keyword">view</span> json_tuple(json,&quot;device&quot;,&quot;deviceType&quot;,&quot;signal&quot;,&quot;time&quot;) b</span><br><span class="line">         <span class="keyword">as</span> device,deviceType,signal,stime;</span><br></pre></td></tr></table></figure>

<h3 id="开窗函数"><a href="#开窗函数" class="headerlink" title="开窗函数"></a>开窗函数</h3><p>Hive中的窗口函数可以分为几类，主要用于执行各种复杂的数据分析任务。以下是Hive窗口函数的分类及其简要说明：</p>
<ol>
<li><strong>排名函数（Ranking Functions）</strong>：<ul>
<li><code>RANK()</code>：为每一行分配一个排名，相同值会得到相同的排名，排名之间会有间隔。</li>
<li><code>DENSE_RANK()</code>：与<code>RANK()</code>相似，但相同值会得到相同的排名，排名之间不会有间隔。</li>
<li><code>ROW_NUMBER()</code>：为每一行分配一个唯一的连续整数编号。</li>
</ul>
</li>
<li><strong>聚合函数（Aggregate Functions）</strong>：<ul>
<li><code>SUM()</code>, <code>AVG()</code>, <code>MIN()</code>, <code>MAX()</code>：在定义的窗口内计算数值的总和、平均、最小值和最大值。</li>
</ul>
</li>
<li><strong>偏移函数（Offset Functions）</strong>：<ul>
<li><code>LEAD()</code>：返回当前行后一行的值。</li>
<li><code>LAG()</code>：返回当前行前一行的值。</li>
</ul>
</li>
<li><strong>窗口聚合函数（Window Aggregate Functions）</strong>：<ul>
<li><code>FIRST_VALUE()</code>：返回窗口中的第一行值。</li>
<li><code>LAST_VALUE()</code>：返回窗口的最后一行值。</li>
</ul>
</li>
<li><strong>分布函数（Distribution Functions）</strong>：<ul>
<li><code>PERCENT_RANK()</code>：计算每一行在窗口中的百分比排名。</li>
<li><code>CUME_DIST()</code>：计算小于等于当前行的行数占窗口总行数的比例。</li>
</ul>
</li>
<li><strong>分桶函数（Bucketing Functions）</strong>：<ul>
<li><code>NTILE()</code>：将窗口中的行分发到指定数量的桶中。</li>
</ul>
</li>
<li><strong>其他特殊函数</strong>：<ul>
<li><code>GROUPING()</code>：与<code>GROUP BY</code>结合使用，标识分组集合的结果。</li>
</ul>
</li>
</ol>
<p>此篇不在过多概述，而且除1，2，3条外大多数函数即使有用也很难用到，常用函数具体用法可以查看<a target="_blank" rel="noopener" href="https://gozei.github.io/year/04/02/Sql%E4%BB%8E0%E5%88%B01/#SQL%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0%E7%AE%80%E4%BB%8B">Sql 从 0 到 1 | Gozei’s Blog</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://gozei-blog.vercel.app">Gozei</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://gozei-blog.vercel.app/year/04/21/Hive%E4%BB%8E0%E5%88%B01/">https://gozei-blog.vercel.app/year/04/21/Hive%E4%BB%8E0%E5%88%B01/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://gozei-blog.vercel.app" target="_blank">Gozei's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/bigdata/">bigdata</a><a class="post-meta__tags" href="/tags/hive/">hive</a></div><div class="post_share"><div class="social-share" data-image="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20240607210642.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/year/06/13/%E8%A3%85%E9%A5%B0%E5%99%A8/" title="PYTHON装饰器如何用"><img class="cover" src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/toki2.jpg" onerror="onerror=null;src='/img/fa.png'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">PYTHON装饰器如何用</div></div></a></div><div class="next-post pull-right"><a href="/year/04/09/hadoop%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/" title="hadoop集群搭建"><img class="cover" src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20240416205754.jpg" onerror="onerror=null;src='/img/fa.png'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">hadoop集群搭建</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/year/07/03/%E8%A3%85%E9%A5%B0%E5%99%A8%E6%B3%A8%E5%86%8Cudf%E5%87%BD%E6%95%B0/" title="sparksql装饰器函数注册"><img class="cover" src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/xiaochun.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-07-03</div><div class="title">sparksql装饰器函数注册</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/assert/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Gozei</div><div class="author-info__description">Hello</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Gozei"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="/2374280167lk@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2374280167&amp;site=qq&amp;menu=yes" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="https://steamcommunity.com/profiles/76561198421319454/" target="_blank" title="Steam"><i class="fa-brands fa-steam"></i></a><a class="social-icon" href="https://space.bilibili.com/356043221" target="_blank" title="Bililil"><i class="iconfont icon-bilibili-fill"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">welcome</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Hive%E5%85%A5%E9%97%A8"><span class="toc-number">1.</span> <span class="toc-text">Hive入门</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E3%80%81Hive%E5%92%8CMapReduce%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">1.1.</span> <span class="toc-text">SQL、Hive和MapReduce的关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hive%E6%9E%B6%E6%9E%84%E6%98%A0%E5%B0%84%E6%B5%81%E7%A8%8B"><span class="toc-number">1.2.</span> <span class="toc-text">Hive架构映射流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MetaStore%E5%85%83%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E4%B8%89%E7%A7%8D%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.3.</span> <span class="toc-text">MetaStore元数据管理三种模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hive%E6%9C%8D%E5%8A%A1%E6%93%8D%E4%BD%9C"><span class="toc-number">1.4.</span> <span class="toc-text">Hive服务操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8Hive%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.4.1.</span> <span class="toc-text">启动Hive服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%97%ADHive%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.4.2.</span> <span class="toc-text">关闭Hive服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">1.4.3.</span> <span class="toc-text">环境变量</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.5.</span> <span class="toc-text">客户端连接</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%BB%A3%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5Hive"><span class="toc-number">1.5.1.</span> <span class="toc-text">第一代客户端连接Hive</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E4%BB%A3%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5Hive"><span class="toc-number">1.5.2.</span> <span class="toc-text">第二代客户端连接Hive</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%96%B9SQL%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%B7%A5%E5%85%B7%E8%BF%9E%E6%8E%A5Hive%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.5.3.</span> <span class="toc-text">第三方SQL客户端工具连接Hive服务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C%E4%B8%80%E4%B8%8B"><span class="toc-number">1.6.</span> <span class="toc-text">简单操作一下</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Hive%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">2.</span> <span class="toc-text">Hive表操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Hive%E7%9A%84%E5%86%85-%E5%A4%96%E8%A1%A8%E5%88%9B%E5%BB%BA"><span class="toc-number">2.1.</span> <span class="toc-text">Hive的内,外表创建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.</span> <span class="toc-text">数据类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A8%E5%88%86%E7%B1%BB"><span class="toc-number">2.3.</span> <span class="toc-text">表分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B-%E4%BF%AE%E6%94%B9%E8%A1%A8"><span class="toc-number">2.4.</span> <span class="toc-text">查看&#x2F;修改表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E9%9A%94%E7%AC%A6"><span class="toc-number">2.5.</span> <span class="toc-text">分隔符</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E6%98%A0%E5%B0%84%E8%A1%A8"><span class="toc-number">2.5.1.</span> <span class="toc-text">快速映射表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hvie%E7%9A%84SerDe%E6%9C%BA%E5%88%B6"><span class="toc-number">2.5.2.</span> <span class="toc-text">hvie的SerDe机制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Delimited"><span class="toc-number">2.5.2.1.</span> <span class="toc-text">Delimited</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SERDE"><span class="toc-number">2.5.2.2.</span> <span class="toc-text">SERDE</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5"><span class="toc-number">2.6.</span> <span class="toc-text">文件数据导入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#load%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE%E5%88%B0hive%E8%A1%A8"><span class="toc-number">2.6.1.</span> <span class="toc-text">load导入数据到hive表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#insert%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">2.6.2.</span> <span class="toc-text">insert插入数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%87%BA"><span class="toc-number">2.7.</span> <span class="toc-text">文件数据导出</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6"><span class="toc-number">2.7.1.</span> <span class="toc-text">直接下载文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#get%E5%91%BD%E4%BB%A4%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6"><span class="toc-number">2.7.2.</span> <span class="toc-text">get命令下载文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#insert%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE"><span class="toc-number">2.7.3.</span> <span class="toc-text">insert导出数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hive-shell%E5%91%BD%E4%BB%A4%E5%AF%BC%E5%87%BA"><span class="toc-number">2.7.4.</span> <span class="toc-text">hive shell命令导出</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%8C%BA%E8%A1%A8"><span class="toc-number">2.8.</span> <span class="toc-text">分区表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E7%BA%A7%E5%88%86%E5%8C%BA"><span class="toc-number">2.8.1.</span> <span class="toc-text">一级分区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E7%BA%A7%E5%88%86%E5%8C%BA"><span class="toc-number">2.8.2.</span> <span class="toc-text">多级分区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%8C%BA%E6%93%8D%E4%BD%9C"><span class="toc-number">2.8.3.</span> <span class="toc-text">分区操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E6%A1%B6%E8%A1%A8"><span class="toc-number">2.9.</span> <span class="toc-text">分桶表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%A1%B6%E8%A1%A8%E6%8E%92%E5%BA%8F"><span class="toc-number">2.9.1.</span> <span class="toc-text">分桶表排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%A1%B6%E5%8E%9F%E7%90%86"><span class="toc-number">2.9.2.</span> <span class="toc-text">分桶原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%8C%BA%E8%A1%A8%E5%92%8C%E5%88%86%E6%A1%B6%E8%A1%A8%E5%8C%BA%E5%88%AB"><span class="toc-number">2.9.3.</span> <span class="toc-text">分区表和分桶表区别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%8D%E6%9D%82%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.10.</span> <span class="toc-text">复杂类型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Hive%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.</span> <span class="toc-text">Hive查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E7%BB%93%E6%9E%84"><span class="toc-number">3.1.</span> <span class="toc-text">语法结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BBSQL%E5%9F%BA%E6%9C%AC%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.2.</span> <span class="toc-text">类SQL基本查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BBSQL%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.3.</span> <span class="toc-text">类SQL多表查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hive%E5%85%B6%E4%BB%96join%E6%93%8D%E4%BD%9C"><span class="toc-number">3.4.</span> <span class="toc-text">Hive其他join操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hive%E5%85%B6%E4%BB%96%E6%8E%92%E5%BA%8F%E6%93%8D%E4%BD%9C"><span class="toc-number">3.5.</span> <span class="toc-text">Hive其他排序操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%BD%E6%A0%B7%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.6.</span> <span class="toc-text">抽样查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A3%E5%88%99%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.7.</span> <span class="toc-text">正则模糊查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#union%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.8.</span> <span class="toc-text">union联合查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CTE%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">3.9.</span> <span class="toc-text">CTE表达式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E8%99%9A%E6%8B%9F%E5%88%97"><span class="toc-number">3.10.</span> <span class="toc-text">内置虚拟列</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Hive%E5%87%BD%E6%95%B0"><span class="toc-number">4.</span> <span class="toc-text">Hive函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E5%BB%BA%E5%87%BD%E6%95%B0"><span class="toc-number">4.1.</span> <span class="toc-text">内建函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C"><span class="toc-number">4.1.1.</span> <span class="toc-text">字符串操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4"><span class="toc-number">4.1.2.</span> <span class="toc-text">日期时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E5%AD%A6%E5%87%BD%E6%95%B0"><span class="toc-number">4.1.3.</span> <span class="toc-text">数学函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E5%87%BD%E6%95%B0"><span class="toc-number">4.1.4.</span> <span class="toc-text">条件函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E5%87%BD%E6%95%B0"><span class="toc-number">4.1.5.</span> <span class="toc-text">类型转换函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%84%B1%E6%95%8F%E5%87%BD%E6%95%B0"><span class="toc-number">4.1.6.</span> <span class="toc-text">脱敏函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-number">4.1.7.</span> <span class="toc-text">其他</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0"><span class="toc-number">4.2.</span> <span class="toc-text">用户定义函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#explode-%E7%88%86%E7%82%B8%E5%87%BD%E6%95%B0"><span class="toc-number">4.2.1.</span> <span class="toc-text">explode-爆炸函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#collect-%E6%95%B0%E6%8D%AE%E6%94%B6%E9%9B%86%E5%87%BD%E6%95%B0"><span class="toc-number">4.2.2.</span> <span class="toc-text">collect-数据收集函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#json-%E5%A4%84%E7%90%86"><span class="toc-number">4.2.3.</span> <span class="toc-text">json-处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E7%AA%97%E5%87%BD%E6%95%B0"><span class="toc-number">4.2.4.</span> <span class="toc-text">开窗函数</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/year/07/14/%E6%8E%A8%E5%AF%BC%E5%BC%8F%E4%B8%8E%E7%94%9F%E6%88%90%E5%99%A8/" title="推导式与生成器表达式"><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/hosiro.jpg" onerror="this.onerror=null;this.src='/img/fa.png'" alt="推导式与生成器表达式"/></a><div class="content"><a class="title" href="/year/07/14/%E6%8E%A8%E5%AF%BC%E5%BC%8F%E4%B8%8E%E7%94%9F%E6%88%90%E5%99%A8/" title="推导式与生成器表达式">推导式与生成器表达式</a><time datetime="2024-07-14T02:27:12.000Z" title="发表于 2024-07-14 10:27:12">2024-07-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/year/07/03/%E8%A3%85%E9%A5%B0%E5%99%A8%E6%B3%A8%E5%86%8Cudf%E5%87%BD%E6%95%B0/" title="sparksql装饰器函数注册"><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/xiaochun.png" onerror="this.onerror=null;this.src='/img/fa.png'" alt="sparksql装饰器函数注册"/></a><div class="content"><a class="title" href="/year/07/03/%E8%A3%85%E9%A5%B0%E5%99%A8%E6%B3%A8%E5%86%8Cudf%E5%87%BD%E6%95%B0/" title="sparksql装饰器函数注册">sparksql装饰器函数注册</a><time datetime="2024-07-03T14:27:12.000Z" title="发表于 2024-07-03 22:27:12">2024-07-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/year/06/13/%E8%A3%85%E9%A5%B0%E5%99%A8/" title="PYTHON装饰器如何用"><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/toki2.jpg" onerror="this.onerror=null;this.src='/img/fa.png'" alt="PYTHON装饰器如何用"/></a><div class="content"><a class="title" href="/year/06/13/%E8%A3%85%E9%A5%B0%E5%99%A8/" title="PYTHON装饰器如何用">PYTHON装饰器如何用</a><time datetime="2024-06-13T10:23:12.000Z" title="发表于 2024-06-13 18:23:12">2024-06-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/year/04/21/Hive%E4%BB%8E0%E5%88%B01/" title="hive从0到1"><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20240607210642.jpg" onerror="this.onerror=null;this.src='/img/fa.png'" alt="hive从0到1"/></a><div class="content"><a class="title" href="/year/04/21/Hive%E4%BB%8E0%E5%88%B01/" title="hive从0到1">hive从0到1</a><time datetime="2024-04-21T12:23:12.000Z" title="发表于 2024-04-21 20:23:12">2024-04-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/year/04/09/hadoop%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/" title="hadoop集群搭建"><img src="https://picgo-1301595386.cos.ap-nanjing.myqcloud.com/picGo/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20240416205754.jpg" onerror="this.onerror=null;this.src='/img/fa.png'" alt="hadoop集群搭建"/></a><div class="content"><a class="title" href="/year/04/09/hadoop%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/" title="hadoop集群搭建">hadoop集群搭建</a><time datetime="2024-04-09T14:23:12.000Z" title="发表于 2024-04-09 22:23:12">2024-04-09</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By Gozei</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>